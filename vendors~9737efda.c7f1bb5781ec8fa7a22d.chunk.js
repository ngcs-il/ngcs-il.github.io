(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["vendors~9737efda"],{

/***/ "CyDa":
/*!************************************************************************************************!*\
  !*** ./node_modules/aurelia-authentication/dist/native-modules/authenticatedValueConverter.js ***!
  \************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.__esModule = true;\nexports.AuthenticatedValueConverter = undefined;\n\nvar _dec, _class;\n\nvar _aureliaDependencyInjection = __webpack_require__(/*! aurelia-dependency-injection */ \"3U8n\");\n\nvar _aureliaAuthentication = __webpack_require__(/*! ./aurelia-authentication */ \"aurelia-authentication\");\n\n\n\nvar AuthenticatedValueConverter = exports.AuthenticatedValueConverter = (_dec = (0, _aureliaDependencyInjection.inject)(_aureliaAuthentication.AuthService), _dec(_class = function () {\n  function AuthenticatedValueConverter(authService) {\n    \n\n    this.authService = authService;\n  }\n\n  AuthenticatedValueConverter.prototype.toView = function toView() {\n    return this.authService.authenticated;\n  };\n\n  return AuthenticatedValueConverter;\n}()) || _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3lEYS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9hdXJlbGlhLWF1dGhlbnRpY2F0aW9uL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXV0aGVudGljYXRlZFZhbHVlQ29udmVydGVyLmpzPzBiMjAiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5BdXRoZW50aWNhdGVkVmFsdWVDb252ZXJ0ZXIgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfY2xhc3M7XG5cbnZhciBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24gPSByZXF1aXJlKCdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJyk7XG5cbnZhciBfYXVyZWxpYUF1dGhlbnRpY2F0aW9uID0gcmVxdWlyZSgnLi9hdXJlbGlhLWF1dGhlbnRpY2F0aW9uJyk7XG5cblxuXG52YXIgQXV0aGVudGljYXRlZFZhbHVlQ29udmVydGVyID0gZXhwb3J0cy5BdXRoZW50aWNhdGVkVmFsdWVDb252ZXJ0ZXIgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYUF1dGhlbnRpY2F0aW9uLkF1dGhTZXJ2aWNlKSwgX2RlYyhfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dGhlbnRpY2F0ZWRWYWx1ZUNvbnZlcnRlcihhdXRoU2VydmljZSkge1xuICAgIFxuXG4gICAgdGhpcy5hdXRoU2VydmljZSA9IGF1dGhTZXJ2aWNlO1xuICB9XG5cbiAgQXV0aGVudGljYXRlZFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS50b1ZpZXcgPSBmdW5jdGlvbiB0b1ZpZXcoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXV0aFNlcnZpY2UuYXV0aGVudGljYXRlZDtcbiAgfTtcblxuICByZXR1cm4gQXV0aGVudGljYXRlZFZhbHVlQ29udmVydGVyO1xufSgpKSB8fCBfY2xhc3MpOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///CyDa\n");

/***/ }),

/***/ "Med+":
/*!******************************************************************************************************!*\
  !*** ./node_modules/aurelia-authentication/dist/native-modules/authenticatedFilterValueConverter.js ***!
  \******************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.__esModule = true;\nexports.AuthenticatedFilterValueConverter = undefined;\n\nvar _dec, _class;\n\nvar _aureliaDependencyInjection = __webpack_require__(/*! aurelia-dependency-injection */ \"3U8n\");\n\nvar _aureliaAuthentication = __webpack_require__(/*! ./aurelia-authentication */ \"aurelia-authentication\");\n\nvar _aureliaRouter = __webpack_require__(/*! aurelia-router */ \"4ysu\");\n\n\n\nvar AuthenticatedFilterValueConverter = exports.AuthenticatedFilterValueConverter = (_dec = (0, _aureliaDependencyInjection.inject)(_aureliaAuthentication.AuthService), _dec(_class = function () {\n  function AuthenticatedFilterValueConverter(authService) {\n    \n\n    this.authService = authService;\n  }\n\n  AuthenticatedFilterValueConverter.prototype.toView = function toView(routes) {\n    var isAuthenticated = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.authService.authenticated;\n\n    return routes.filter(function (route) {\n      return typeof route.config.auth !== 'boolean' || route.config.auth === isAuthenticated;\n    });\n  };\n\n  return AuthenticatedFilterValueConverter;\n}()) || _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVkKy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9hdXJlbGlhLWF1dGhlbnRpY2F0aW9uL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXV0aGVudGljYXRlZEZpbHRlclZhbHVlQ29udmVydGVyLmpzPzMxZTciXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5BdXRoZW50aWNhdGVkRmlsdGVyVmFsdWVDb252ZXJ0ZXIgPSB1bmRlZmluZWQ7XG5cbnZhciBfZGVjLCBfY2xhc3M7XG5cbnZhciBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24gPSByZXF1aXJlKCdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJyk7XG5cbnZhciBfYXVyZWxpYUF1dGhlbnRpY2F0aW9uID0gcmVxdWlyZSgnLi9hdXJlbGlhLWF1dGhlbnRpY2F0aW9uJyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cblxuXG52YXIgQXV0aGVudGljYXRlZEZpbHRlclZhbHVlQ29udmVydGVyID0gZXhwb3J0cy5BdXRoZW50aWNhdGVkRmlsdGVyVmFsdWVDb252ZXJ0ZXIgPSAoX2RlYyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYUF1dGhlbnRpY2F0aW9uLkF1dGhTZXJ2aWNlKSwgX2RlYyhfY2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dGhlbnRpY2F0ZWRGaWx0ZXJWYWx1ZUNvbnZlcnRlcihhdXRoU2VydmljZSkge1xuICAgIFxuXG4gICAgdGhpcy5hdXRoU2VydmljZSA9IGF1dGhTZXJ2aWNlO1xuICB9XG5cbiAgQXV0aGVudGljYXRlZEZpbHRlclZhbHVlQ29udmVydGVyLnByb3RvdHlwZS50b1ZpZXcgPSBmdW5jdGlvbiB0b1ZpZXcocm91dGVzKSB7XG4gICAgdmFyIGlzQXV0aGVudGljYXRlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdGhpcy5hdXRoU2VydmljZS5hdXRoZW50aWNhdGVkO1xuXG4gICAgcmV0dXJuIHJvdXRlcy5maWx0ZXIoZnVuY3Rpb24gKHJvdXRlKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIHJvdXRlLmNvbmZpZy5hdXRoICE9PSAnYm9vbGVhbicgfHwgcm91dGUuY29uZmlnLmF1dGggPT09IGlzQXV0aGVudGljYXRlZDtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gQXV0aGVudGljYXRlZEZpbHRlclZhbHVlQ29udmVydGVyO1xufSgpKSB8fCBfY2xhc3MpOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///Med+\n");

/***/ }),

/***/ "aurelia-api":
/*!*********************************************************************!*\
  !*** ./node_modules/aurelia-api/dist/native-modules/aurelia-api.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.__esModule = true;\nexports.Endpoint = exports.Config = exports.Rest = undefined;\n\nvar _dec, _class3;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.configure = configure;\n\nvar _extend = __webpack_require__(/*! extend */ \"6dBs\");\n\nvar _extend2 = _interopRequireDefault(_extend);\n\nvar _aureliaPath = __webpack_require__(/*! aurelia-path */ \"iD3O\");\n\nvar _aureliaFetchClient = __webpack_require__(/*! aurelia-fetch-client */ \"aurelia-fetch-client\");\n\nvar _aureliaDependencyInjection = __webpack_require__(/*! aurelia-dependency-injection */ \"3U8n\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\n\nvar Rest = exports.Rest = function () {\n  function Rest(httpClient, endpoint, useTraditionalUriTemplates) {\n    \n\n    this.defaults = {\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    };\n\n    this.client = httpClient;\n    this.endpoint = endpoint;\n    this.useTraditionalUriTemplates = !!useTraditionalUriTemplates;\n  }\n\n  Rest.prototype.request = function request(method, path, body, options, responseOutput) {\n    var requestOptions = (0, _extend2.default)(true, { headers: {} }, this.defaults || {}, options || {}, { method: method, body: body });\n    var contentType = requestOptions.headers['Content-Type'] || requestOptions.headers['content-type'];\n\n    if ((typeof body === 'undefined' ? 'undefined' : _typeof(body)) === 'object' && body !== null && contentType) {\n      requestOptions.body = /^application\\/(.+\\+)?json/.test(contentType.toLowerCase()) ? JSON.stringify(body) : (0, _aureliaPath.buildQueryString)(body);\n    }\n\n    return this.client.fetch(path, requestOptions).then(function (response) {\n      if (response.status >= 200 && response.status < 400) {\n        if (responseOutput) {\n          responseOutput.response = response;\n        }\n\n        return response.json().catch(function () {\n          return null;\n        });\n      }\n\n      throw response;\n    });\n  };\n\n  Rest.prototype.find = function find(resource, idOrCriteria, options, responseOutput) {\n    return this.request('GET', getRequestPath(resource, this.useTraditionalUriTemplates, idOrCriteria), undefined, options, responseOutput);\n  };\n\n  Rest.prototype.findOne = function findOne(resource, id, criteria, options, responseOutput) {\n    return this.request('GET', getRequestPath(resource, this.useTraditionalUriTemplates, id, criteria), undefined, options, responseOutput);\n  };\n\n  Rest.prototype.post = function post(resource, body, options, responseOutput) {\n    return this.request('POST', resource, body, options, responseOutput);\n  };\n\n  Rest.prototype.update = function update(resource, idOrCriteria, body, options, responseOutput) {\n    return this.request('PUT', getRequestPath(resource, this.useTraditionalUriTemplates, idOrCriteria), body, options, responseOutput);\n  };\n\n  Rest.prototype.updateOne = function updateOne(resource, id, criteria, body, options, responseOutput) {\n    return this.request('PUT', getRequestPath(resource, this.useTraditionalUriTemplates, id, criteria), body, options, responseOutput);\n  };\n\n  Rest.prototype.patch = function patch(resource, idOrCriteria, body, options, responseOutput) {\n    return this.request('PATCH', getRequestPath(resource, this.useTraditionalUriTemplates, idOrCriteria), body, options, responseOutput);\n  };\n\n  Rest.prototype.patchOne = function patchOne(resource, id, criteria, body, options, responseOutput) {\n    return this.request('PATCH', getRequestPath(resource, this.useTraditionalUriTemplates, id, criteria), body, options, responseOutput);\n  };\n\n  Rest.prototype.destroy = function destroy(resource, idOrCriteria, options, responseOutput) {\n    return this.request('DELETE', getRequestPath(resource, this.useTraditionalUriTemplates, idOrCriteria), undefined, options, responseOutput);\n  };\n\n  Rest.prototype.destroyOne = function destroyOne(resource, id, criteria, options, responseOutput) {\n    return this.request('DELETE', getRequestPath(resource, this.useTraditionalUriTemplates, id, criteria), undefined, options, responseOutput);\n  };\n\n  Rest.prototype.create = function create(resource, body, options, responseOutput) {\n    return this.post(resource, body, options, responseOutput);\n  };\n\n  return Rest;\n}();\n\nfunction getRequestPath(resource, traditional, idOrCriteria, criteria) {\n  var hasSlash = resource.slice(-1) === '/';\n\n  if (typeof idOrCriteria === 'string' || typeof idOrCriteria === 'number') {\n    resource = '' + (0, _aureliaPath.join)(resource, String(idOrCriteria)) + (hasSlash ? '/' : '');\n  } else {\n    criteria = idOrCriteria;\n  }\n\n  if ((typeof criteria === 'undefined' ? 'undefined' : _typeof(criteria)) === 'object' && criteria !== null) {\n    resource += '?' + (0, _aureliaPath.buildQueryString)(criteria, traditional);\n  } else if (criteria) {\n    resource += '' + (hasSlash ? '' : '/') + criteria + (hasSlash ? '/' : '');\n  }\n\n  return resource;\n}\n\nvar Config = exports.Config = function () {\n  function Config() {\n    \n\n    this.endpoints = {};\n  }\n\n  Config.prototype.registerEndpoint = function registerEndpoint(name, configureMethod, defaults, restOptions) {\n    var _this = this;\n\n    var newClient = new _aureliaFetchClient.HttpClient();\n    var useTraditionalUriTemplates = void 0;\n\n    if (restOptions !== undefined) {\n      useTraditionalUriTemplates = restOptions.useTraditionalUriTemplates;\n    }\n    this.endpoints[name] = new Rest(newClient, name, useTraditionalUriTemplates);\n\n    if (defaults !== undefined) {\n      this.endpoints[name].defaults = defaults;\n    }\n\n    if (typeof configureMethod === 'function') {\n      newClient.configure(function (newClientConfig) {\n        return configureMethod(newClientConfig.withDefaults(_this.endpoints[name].defaults));\n      });\n\n      this.endpoints[name].defaults = newClient.defaults;\n\n      return this;\n    }\n\n    if (typeof configureMethod !== 'string' && !this.defaultBaseUrl) {\n      return this;\n    }\n\n    if (this.defaultBaseUrl && typeof configureMethod !== 'string' && typeof configureMethod !== 'function') {\n      newClient.configure(function (configure) {\n        configure.withBaseUrl(_this.defaultBaseUrl);\n      });\n\n      return this;\n    }\n\n    newClient.configure(function (configure) {\n      configure.withBaseUrl(configureMethod);\n    });\n\n    return this;\n  };\n\n  Config.prototype.getEndpoint = function getEndpoint(name) {\n    if (!name) {\n      return this.defaultEndpoint || null;\n    }\n\n    return this.endpoints[name] || null;\n  };\n\n  Config.prototype.endpointExists = function endpointExists(name) {\n    return !!this.endpoints[name];\n  };\n\n  Config.prototype.setDefaultEndpoint = function setDefaultEndpoint(name) {\n    this.defaultEndpoint = this.getEndpoint(name);\n\n    return this;\n  };\n\n  Config.prototype.setDefaultBaseUrl = function setDefaultBaseUrl(baseUrl) {\n    this.defaultBaseUrl = baseUrl;\n\n    return this;\n  };\n\n  Config.prototype.configure = function configure(config) {\n    var _this2 = this;\n\n    if (config.defaultBaseUrl) {\n      this.defaultBaseUrl = config.defaultBaseUrl;\n    }\n\n    config.endpoints.forEach(function (endpoint) {\n      _this2.registerEndpoint(endpoint.name, endpoint.endpoint, endpoint.config);\n\n      if (endpoint.default) {\n        _this2.setDefaultEndpoint(endpoint.name);\n      }\n    });\n\n    if (config.defaultEndpoint) {\n      this.setDefaultEndpoint(config.defaultEndpoint);\n    }\n\n    return this;\n  };\n\n  return Config;\n}();\n\nfunction configure(frameworkConfig, configOrConfigure) {\n  var config = frameworkConfig.container.get(Config);\n\n  if (typeof configOrConfigure === 'function') {\n    configOrConfigure(config);\n\n    return;\n  }\n\n  config.configure(configOrConfigure);\n}\n\nvar Endpoint = exports.Endpoint = (_dec = (0, _aureliaDependencyInjection.resolver)(), _dec(_class3 = function () {\n  function Endpoint(key) {\n    \n\n    this._key = key;\n  }\n\n  Endpoint.prototype.get = function get(container) {\n    return container.get(Config).getEndpoint(this._key);\n  };\n\n  Endpoint.of = function of(key) {\n    return new Endpoint(key);\n  };\n\n  return Endpoint;\n}()) || _class3);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyZWxpYS1hcGkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYXVyZWxpYS1hcGkvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWFwaS5qcz9lMTY5Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuRW5kcG9pbnQgPSBleHBvcnRzLkNvbmZpZyA9IGV4cG9ydHMuUmVzdCA9IHVuZGVmaW5lZDtcblxudmFyIF9kZWMsIF9jbGFzczM7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxuZXhwb3J0cy5jb25maWd1cmUgPSBjb25maWd1cmU7XG5cbnZhciBfZXh0ZW5kID0gcmVxdWlyZSgnZXh0ZW5kJyk7XG5cbnZhciBfZXh0ZW5kMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2V4dGVuZCk7XG5cbnZhciBfYXVyZWxpYVBhdGggPSByZXF1aXJlKCdhdXJlbGlhLXBhdGgnKTtcblxudmFyIF9hdXJlbGlhRmV0Y2hDbGllbnQgPSByZXF1aXJlKCdhdXJlbGlhLWZldGNoLWNsaWVudCcpO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5cblxudmFyIFJlc3QgPSBleHBvcnRzLlJlc3QgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlc3QoaHR0cENsaWVudCwgZW5kcG9pbnQsIHVzZVRyYWRpdGlvbmFsVXJpVGVtcGxhdGVzKSB7XG4gICAgXG5cbiAgICB0aGlzLmRlZmF1bHRzID0ge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuY2xpZW50ID0gaHR0cENsaWVudDtcbiAgICB0aGlzLmVuZHBvaW50ID0gZW5kcG9pbnQ7XG4gICAgdGhpcy51c2VUcmFkaXRpb25hbFVyaVRlbXBsYXRlcyA9ICEhdXNlVHJhZGl0aW9uYWxVcmlUZW1wbGF0ZXM7XG4gIH1cblxuICBSZXN0LnByb3RvdHlwZS5yZXF1ZXN0ID0gZnVuY3Rpb24gcmVxdWVzdChtZXRob2QsIHBhdGgsIGJvZHksIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KSB7XG4gICAgdmFyIHJlcXVlc3RPcHRpb25zID0gKDAsIF9leHRlbmQyLmRlZmF1bHQpKHRydWUsIHsgaGVhZGVyczoge30gfSwgdGhpcy5kZWZhdWx0cyB8fCB7fSwgb3B0aW9ucyB8fCB7fSwgeyBtZXRob2Q6IG1ldGhvZCwgYm9keTogYm9keSB9KTtcbiAgICB2YXIgY29udGVudFR5cGUgPSByZXF1ZXN0T3B0aW9ucy5oZWFkZXJzWydDb250ZW50LVR5cGUnXSB8fCByZXF1ZXN0T3B0aW9ucy5oZWFkZXJzWydjb250ZW50LXR5cGUnXTtcblxuICAgIGlmICgodHlwZW9mIGJvZHkgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGJvZHkpKSA9PT0gJ29iamVjdCcgJiYgYm9keSAhPT0gbnVsbCAmJiBjb250ZW50VHlwZSkge1xuICAgICAgcmVxdWVzdE9wdGlvbnMuYm9keSA9IC9eYXBwbGljYXRpb25cXC8oLitcXCspP2pzb24vLnRlc3QoY29udGVudFR5cGUudG9Mb3dlckNhc2UoKSkgPyBKU09OLnN0cmluZ2lmeShib2R5KSA6ICgwLCBfYXVyZWxpYVBhdGguYnVpbGRRdWVyeVN0cmluZykoYm9keSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY2xpZW50LmZldGNoKHBhdGgsIHJlcXVlc3RPcHRpb25zKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA+PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzIDwgNDAwKSB7XG4gICAgICAgIGlmIChyZXNwb25zZU91dHB1dCkge1xuICAgICAgICAgIHJlc3BvbnNlT3V0cHV0LnJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRocm93IHJlc3BvbnNlO1xuICAgIH0pO1xuICB9O1xuXG4gIFJlc3QucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiBmaW5kKHJlc291cmNlLCBpZE9yQ3JpdGVyaWEsIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgZ2V0UmVxdWVzdFBhdGgocmVzb3VyY2UsIHRoaXMudXNlVHJhZGl0aW9uYWxVcmlUZW1wbGF0ZXMsIGlkT3JDcml0ZXJpYSksIHVuZGVmaW5lZCwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpO1xuICB9O1xuXG4gIFJlc3QucHJvdG90eXBlLmZpbmRPbmUgPSBmdW5jdGlvbiBmaW5kT25lKHJlc291cmNlLCBpZCwgY3JpdGVyaWEsIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnR0VUJywgZ2V0UmVxdWVzdFBhdGgocmVzb3VyY2UsIHRoaXMudXNlVHJhZGl0aW9uYWxVcmlUZW1wbGF0ZXMsIGlkLCBjcml0ZXJpYSksIHVuZGVmaW5lZCwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpO1xuICB9O1xuXG4gIFJlc3QucHJvdG90eXBlLnBvc3QgPSBmdW5jdGlvbiBwb3N0KHJlc291cmNlLCBib2R5LCBvcHRpb25zLCByZXNwb25zZU91dHB1dCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ1BPU1QnLCByZXNvdXJjZSwgYm9keSwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpO1xuICB9O1xuXG4gIFJlc3QucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZShyZXNvdXJjZSwgaWRPckNyaXRlcmlhLCBib2R5LCBvcHRpb25zLCByZXNwb25zZU91dHB1dCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoJ1BVVCcsIGdldFJlcXVlc3RQYXRoKHJlc291cmNlLCB0aGlzLnVzZVRyYWRpdGlvbmFsVXJpVGVtcGxhdGVzLCBpZE9yQ3JpdGVyaWEpLCBib2R5LCBvcHRpb25zLCByZXNwb25zZU91dHB1dCk7XG4gIH07XG5cbiAgUmVzdC5wcm90b3R5cGUudXBkYXRlT25lID0gZnVuY3Rpb24gdXBkYXRlT25lKHJlc291cmNlLCBpZCwgY3JpdGVyaWEsIGJvZHksIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnUFVUJywgZ2V0UmVxdWVzdFBhdGgocmVzb3VyY2UsIHRoaXMudXNlVHJhZGl0aW9uYWxVcmlUZW1wbGF0ZXMsIGlkLCBjcml0ZXJpYSksIGJvZHksIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KTtcbiAgfTtcblxuICBSZXN0LnByb3RvdHlwZS5wYXRjaCA9IGZ1bmN0aW9uIHBhdGNoKHJlc291cmNlLCBpZE9yQ3JpdGVyaWEsIGJvZHksIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdCgnUEFUQ0gnLCBnZXRSZXF1ZXN0UGF0aChyZXNvdXJjZSwgdGhpcy51c2VUcmFkaXRpb25hbFVyaVRlbXBsYXRlcywgaWRPckNyaXRlcmlhKSwgYm9keSwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpO1xuICB9O1xuXG4gIFJlc3QucHJvdG90eXBlLnBhdGNoT25lID0gZnVuY3Rpb24gcGF0Y2hPbmUocmVzb3VyY2UsIGlkLCBjcml0ZXJpYSwgYm9keSwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdQQVRDSCcsIGdldFJlcXVlc3RQYXRoKHJlc291cmNlLCB0aGlzLnVzZVRyYWRpdGlvbmFsVXJpVGVtcGxhdGVzLCBpZCwgY3JpdGVyaWEpLCBib2R5LCBvcHRpb25zLCByZXNwb25zZU91dHB1dCk7XG4gIH07XG5cbiAgUmVzdC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3kocmVzb3VyY2UsIGlkT3JDcml0ZXJpYSwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdERUxFVEUnLCBnZXRSZXF1ZXN0UGF0aChyZXNvdXJjZSwgdGhpcy51c2VUcmFkaXRpb25hbFVyaVRlbXBsYXRlcywgaWRPckNyaXRlcmlhKSwgdW5kZWZpbmVkLCBvcHRpb25zLCByZXNwb25zZU91dHB1dCk7XG4gIH07XG5cbiAgUmVzdC5wcm90b3R5cGUuZGVzdHJveU9uZSA9IGZ1bmN0aW9uIGRlc3Ryb3lPbmUocmVzb3VyY2UsIGlkLCBjcml0ZXJpYSwgb3B0aW9ucywgcmVzcG9uc2VPdXRwdXQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdERUxFVEUnLCBnZXRSZXF1ZXN0UGF0aChyZXNvdXJjZSwgdGhpcy51c2VUcmFkaXRpb25hbFVyaVRlbXBsYXRlcywgaWQsIGNyaXRlcmlhKSwgdW5kZWZpbmVkLCBvcHRpb25zLCByZXNwb25zZU91dHB1dCk7XG4gIH07XG5cbiAgUmVzdC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHJlc291cmNlLCBib2R5LCBvcHRpb25zLCByZXNwb25zZU91dHB1dCkge1xuICAgIHJldHVybiB0aGlzLnBvc3QocmVzb3VyY2UsIGJvZHksIG9wdGlvbnMsIHJlc3BvbnNlT3V0cHV0KTtcbiAgfTtcblxuICByZXR1cm4gUmVzdDtcbn0oKTtcblxuZnVuY3Rpb24gZ2V0UmVxdWVzdFBhdGgocmVzb3VyY2UsIHRyYWRpdGlvbmFsLCBpZE9yQ3JpdGVyaWEsIGNyaXRlcmlhKSB7XG4gIHZhciBoYXNTbGFzaCA9IHJlc291cmNlLnNsaWNlKC0xKSA9PT0gJy8nO1xuXG4gIGlmICh0eXBlb2YgaWRPckNyaXRlcmlhID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgaWRPckNyaXRlcmlhID09PSAnbnVtYmVyJykge1xuICAgIHJlc291cmNlID0gJycgKyAoMCwgX2F1cmVsaWFQYXRoLmpvaW4pKHJlc291cmNlLCBTdHJpbmcoaWRPckNyaXRlcmlhKSkgKyAoaGFzU2xhc2ggPyAnLycgOiAnJyk7XG4gIH0gZWxzZSB7XG4gICAgY3JpdGVyaWEgPSBpZE9yQ3JpdGVyaWE7XG4gIH1cblxuICBpZiAoKHR5cGVvZiBjcml0ZXJpYSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoY3JpdGVyaWEpKSA9PT0gJ29iamVjdCcgJiYgY3JpdGVyaWEgIT09IG51bGwpIHtcbiAgICByZXNvdXJjZSArPSAnPycgKyAoMCwgX2F1cmVsaWFQYXRoLmJ1aWxkUXVlcnlTdHJpbmcpKGNyaXRlcmlhLCB0cmFkaXRpb25hbCk7XG4gIH0gZWxzZSBpZiAoY3JpdGVyaWEpIHtcbiAgICByZXNvdXJjZSArPSAnJyArIChoYXNTbGFzaCA/ICcnIDogJy8nKSArIGNyaXRlcmlhICsgKGhhc1NsYXNoID8gJy8nIDogJycpO1xuICB9XG5cbiAgcmV0dXJuIHJlc291cmNlO1xufVxuXG52YXIgQ29uZmlnID0gZXhwb3J0cy5Db25maWcgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbmZpZygpIHtcbiAgICBcblxuICAgIHRoaXMuZW5kcG9pbnRzID0ge307XG4gIH1cblxuICBDb25maWcucHJvdG90eXBlLnJlZ2lzdGVyRW5kcG9pbnQgPSBmdW5jdGlvbiByZWdpc3RlckVuZHBvaW50KG5hbWUsIGNvbmZpZ3VyZU1ldGhvZCwgZGVmYXVsdHMsIHJlc3RPcHRpb25zKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHZhciBuZXdDbGllbnQgPSBuZXcgX2F1cmVsaWFGZXRjaENsaWVudC5IdHRwQ2xpZW50KCk7XG4gICAgdmFyIHVzZVRyYWRpdGlvbmFsVXJpVGVtcGxhdGVzID0gdm9pZCAwO1xuXG4gICAgaWYgKHJlc3RPcHRpb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHVzZVRyYWRpdGlvbmFsVXJpVGVtcGxhdGVzID0gcmVzdE9wdGlvbnMudXNlVHJhZGl0aW9uYWxVcmlUZW1wbGF0ZXM7XG4gICAgfVxuICAgIHRoaXMuZW5kcG9pbnRzW25hbWVdID0gbmV3IFJlc3QobmV3Q2xpZW50LCBuYW1lLCB1c2VUcmFkaXRpb25hbFVyaVRlbXBsYXRlcyk7XG5cbiAgICBpZiAoZGVmYXVsdHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5lbmRwb2ludHNbbmFtZV0uZGVmYXVsdHMgPSBkZWZhdWx0cztcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGNvbmZpZ3VyZU1ldGhvZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbmV3Q2xpZW50LmNvbmZpZ3VyZShmdW5jdGlvbiAobmV3Q2xpZW50Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiBjb25maWd1cmVNZXRob2QobmV3Q2xpZW50Q29uZmlnLndpdGhEZWZhdWx0cyhfdGhpcy5lbmRwb2ludHNbbmFtZV0uZGVmYXVsdHMpKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmVuZHBvaW50c1tuYW1lXS5kZWZhdWx0cyA9IG5ld0NsaWVudC5kZWZhdWx0cztcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBjb25maWd1cmVNZXRob2QgIT09ICdzdHJpbmcnICYmICF0aGlzLmRlZmF1bHRCYXNlVXJsKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kZWZhdWx0QmFzZVVybCAmJiB0eXBlb2YgY29uZmlndXJlTWV0aG9kICE9PSAnc3RyaW5nJyAmJiB0eXBlb2YgY29uZmlndXJlTWV0aG9kICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBuZXdDbGllbnQuY29uZmlndXJlKGZ1bmN0aW9uIChjb25maWd1cmUpIHtcbiAgICAgICAgY29uZmlndXJlLndpdGhCYXNlVXJsKF90aGlzLmRlZmF1bHRCYXNlVXJsKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBuZXdDbGllbnQuY29uZmlndXJlKGZ1bmN0aW9uIChjb25maWd1cmUpIHtcbiAgICAgIGNvbmZpZ3VyZS53aXRoQmFzZVVybChjb25maWd1cmVNZXRob2QpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgQ29uZmlnLnByb3RvdHlwZS5nZXRFbmRwb2ludCA9IGZ1bmN0aW9uIGdldEVuZHBvaW50KG5hbWUpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRFbmRwb2ludCB8fCBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmVuZHBvaW50c1tuYW1lXSB8fCBudWxsO1xuICB9O1xuXG4gIENvbmZpZy5wcm90b3R5cGUuZW5kcG9pbnRFeGlzdHMgPSBmdW5jdGlvbiBlbmRwb2ludEV4aXN0cyhuYW1lKSB7XG4gICAgcmV0dXJuICEhdGhpcy5lbmRwb2ludHNbbmFtZV07XG4gIH07XG5cbiAgQ29uZmlnLnByb3RvdHlwZS5zZXREZWZhdWx0RW5kcG9pbnQgPSBmdW5jdGlvbiBzZXREZWZhdWx0RW5kcG9pbnQobmFtZSkge1xuICAgIHRoaXMuZGVmYXVsdEVuZHBvaW50ID0gdGhpcy5nZXRFbmRwb2ludChuYW1lKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIENvbmZpZy5wcm90b3R5cGUuc2V0RGVmYXVsdEJhc2VVcmwgPSBmdW5jdGlvbiBzZXREZWZhdWx0QmFzZVVybChiYXNlVXJsKSB7XG4gICAgdGhpcy5kZWZhdWx0QmFzZVVybCA9IGJhc2VVcmw7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBDb25maWcucHJvdG90eXBlLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcbiAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgIGlmIChjb25maWcuZGVmYXVsdEJhc2VVcmwpIHtcbiAgICAgIHRoaXMuZGVmYXVsdEJhc2VVcmwgPSBjb25maWcuZGVmYXVsdEJhc2VVcmw7XG4gICAgfVxuXG4gICAgY29uZmlnLmVuZHBvaW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbmRwb2ludCkge1xuICAgICAgX3RoaXMyLnJlZ2lzdGVyRW5kcG9pbnQoZW5kcG9pbnQubmFtZSwgZW5kcG9pbnQuZW5kcG9pbnQsIGVuZHBvaW50LmNvbmZpZyk7XG5cbiAgICAgIGlmIChlbmRwb2ludC5kZWZhdWx0KSB7XG4gICAgICAgIF90aGlzMi5zZXREZWZhdWx0RW5kcG9pbnQoZW5kcG9pbnQubmFtZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoY29uZmlnLmRlZmF1bHRFbmRwb2ludCkge1xuICAgICAgdGhpcy5zZXREZWZhdWx0RW5kcG9pbnQoY29uZmlnLmRlZmF1bHRFbmRwb2ludCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgcmV0dXJuIENvbmZpZztcbn0oKTtcblxuZnVuY3Rpb24gY29uZmlndXJlKGZyYW1ld29ya0NvbmZpZywgY29uZmlnT3JDb25maWd1cmUpIHtcbiAgdmFyIGNvbmZpZyA9IGZyYW1ld29ya0NvbmZpZy5jb250YWluZXIuZ2V0KENvbmZpZyk7XG5cbiAgaWYgKHR5cGVvZiBjb25maWdPckNvbmZpZ3VyZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbmZpZ09yQ29uZmlndXJlKGNvbmZpZyk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBjb25maWcuY29uZmlndXJlKGNvbmZpZ09yQ29uZmlndXJlKTtcbn1cblxudmFyIEVuZHBvaW50ID0gZXhwb3J0cy5FbmRwb2ludCA9IChfZGVjID0gKDAsIF9hdXJlbGlhRGVwZW5kZW5jeUluamVjdGlvbi5yZXNvbHZlcikoKSwgX2RlYyhfY2xhc3MzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFbmRwb2ludChrZXkpIHtcbiAgICBcblxuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgfVxuXG4gIEVuZHBvaW50LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoY29udGFpbmVyKSB7XG4gICAgcmV0dXJuIGNvbnRhaW5lci5nZXQoQ29uZmlnKS5nZXRFbmRwb2ludCh0aGlzLl9rZXkpO1xuICB9O1xuXG4gIEVuZHBvaW50Lm9mID0gZnVuY3Rpb24gb2Yoa2V5KSB7XG4gICAgcmV0dXJuIG5ldyBFbmRwb2ludChrZXkpO1xuICB9O1xuXG4gIHJldHVybiBFbmRwb2ludDtcbn0oKSkgfHwgX2NsYXNzMyk7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///aurelia-api\n");

/***/ }),

/***/ "aurelia-authentication":
/*!*******************************************************************************************!*\
  !*** ./node_modules/aurelia-authentication/dist/native-modules/aurelia-authentication.js ***!
  \*******************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.__esModule = true;\nexports.FetchConfig = exports.AuthorizeStep = exports.AuthenticateStep = exports.AuthService = exports.Authentication = exports.OAuth2 = exports.OAuth1 = exports.AuthLock = exports.Storage = exports.BaseConfig = exports.logger = exports.Popup = undefined;\n\nvar _dec, _class2, _dec2, _class3, _dec3, _class4, _dec4, _class5, _dec5, _dec6, _dec7, _dec8, _dec9, _dec10, _dec11, _class6, _desc, _value, _class7, _dec12, _dec13, _class8, _desc2, _value2, _class9, _dec14, _class11, _dec15, _class12, _dec16, _class13;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.configure = configure;\n\nvar _extend = __webpack_require__(/*! extend */ \"6dBs\");\n\nvar _extend2 = _interopRequireDefault(_extend);\n\nvar _jwtDecode = __webpack_require__(/*! jwt-decode */ \"BOF4\");\n\nvar _jwtDecode2 = _interopRequireDefault(_jwtDecode);\n\nvar _aureliaPal = __webpack_require__(/*! aurelia-pal */ \"70NS\");\n\nvar _aureliaPath = __webpack_require__(/*! aurelia-path */ \"iD3O\");\n\nvar _aureliaLogging = __webpack_require__(/*! aurelia-logging */ \"MP1E\");\n\nvar _aureliaDependencyInjection = __webpack_require__(/*! aurelia-dependency-injection */ \"3U8n\");\n\nvar _aureliaMetadata = __webpack_require__(/*! aurelia-metadata */ \"qrcG\");\n\nvar _aureliaEventAggregator = __webpack_require__(/*! aurelia-event-aggregator */ \"aurelia-event-aggregator\");\n\nvar _aureliaTemplatingResources = __webpack_require__(/*! aurelia-templating-resources */ \"aurelia-templating-resources\");\n\nvar _aureliaApi = __webpack_require__(/*! aurelia-api */ \"aurelia-api\");\n\nvar _aureliaRouter = __webpack_require__(/*! aurelia-router */ \"4ysu\");\n\nvar _aureliaFetchClient = __webpack_require__(/*! aurelia-fetch-client */ \"aurelia-fetch-client\");\n\nvar _authFilterValueConverter = __webpack_require__(/*! ./authFilterValueConverter */ \"aurelia-authentication/authFilterValueConverter\");\n\nvar _authenticatedValueConverter = __webpack_require__(/*! ./authenticatedValueConverter */ \"CyDa\");\n\nvar _authenticatedFilterValueConverter = __webpack_require__(/*! ./authenticatedFilterValueConverter */ \"Med+\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\n\n\nvar Popup = exports.Popup = function () {\n  function Popup() {\n    \n\n    this.popupWindow = null;\n    this.polling = null;\n    this.url = '';\n  }\n\n  Popup.prototype.open = function open(url, windowName, options) {\n    this.url = url;\n    var optionsString = buildPopupWindowOptions(options || {});\n\n    this.popupWindow = _aureliaPal.PLATFORM.global.open(url, windowName, optionsString);\n\n    if (this.popupWindow && this.popupWindow.focus) {\n      this.popupWindow.focus();\n    }\n\n    return this;\n  };\n\n  Popup.prototype.eventListener = function eventListener(redirectUri) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      _this.popupWindow.addEventListener('loadstart', function (event) {\n        if (event.url.indexOf(redirectUri) !== 0) {\n          return;\n        }\n\n        var parser = _aureliaPal.DOM.createElement('a');\n\n        parser.href = event.url;\n\n        if (parser.search || parser.hash) {\n          var qs = parseUrl(parser);\n\n          if (qs.error) {\n            reject({ error: qs.error });\n          } else {\n            resolve(qs);\n          }\n\n          _this.popupWindow.close();\n        }\n      });\n\n      _this.popupWindow.addEventListener('exit', function () {\n        reject({ data: 'Provider Popup was closed' });\n      });\n\n      _this.popupWindow.addEventListener('loaderror', function () {\n        reject({ data: 'Authorization Failed' });\n      });\n    });\n  };\n\n  Popup.prototype.pollPopup = function pollPopup() {\n    var _this2 = this;\n\n    return new Promise(function (resolve, reject) {\n      _this2.polling = _aureliaPal.PLATFORM.global.setInterval(function () {\n        var errorData = void 0;\n\n        try {\n          if (_this2.popupWindow.location.host === _aureliaPal.PLATFORM.global.document.location.host && (_this2.popupWindow.location.search || _this2.popupWindow.location.hash)) {\n            var qs = parseUrl(_this2.popupWindow.location);\n\n            if (qs.error) {\n              reject({ error: qs.error });\n            } else {\n              resolve(qs);\n            }\n\n            _this2.popupWindow.close();\n            _aureliaPal.PLATFORM.global.clearInterval(_this2.polling);\n          }\n        } catch (error) {\n          errorData = error;\n        }\n\n        if (!_this2.popupWindow) {\n          _aureliaPal.PLATFORM.global.clearInterval(_this2.polling);\n          reject({\n            error: errorData,\n            data: 'Provider Popup Blocked'\n          });\n        } else if (_this2.popupWindow.closed) {\n          _aureliaPal.PLATFORM.global.clearInterval(_this2.polling);\n          reject({\n            error: errorData,\n            data: 'Problem poll popup'\n          });\n        }\n      }, 35);\n    });\n  };\n\n  return Popup;\n}();\n\nvar buildPopupWindowOptions = function buildPopupWindowOptions(options) {\n  var width = options.width || 500;\n  var height = options.height || 500;\n\n  var extended = (0, _extend2.default)({\n    width: width,\n    height: height,\n    left: _aureliaPal.PLATFORM.global.screenX + (_aureliaPal.PLATFORM.global.outerWidth - width) / 2,\n    top: _aureliaPal.PLATFORM.global.screenY + (_aureliaPal.PLATFORM.global.outerHeight - height) / 2.5\n  }, options);\n\n  var parts = [];\n\n  Object.keys(extended).map(function (key) {\n    return parts.push(key + '=' + extended[key]);\n  });\n\n  return parts.join(',');\n};\n\nvar parseUrl = function parseUrl(url) {\n  var hash = url.hash.charAt(0) === '#' ? url.hash.substr(1) : url.hash;\n\n  return (0, _extend2.default)(true, {}, (0, _aureliaPath.parseQueryString)(url.search), (0, _aureliaPath.parseQueryString)(hash));\n};\n\nvar logger = exports.logger = (0, _aureliaLogging.getLogger)('aurelia-authentication');\n\nvar BaseConfig = exports.BaseConfig = function () {\n  function BaseConfig() {\n    \n\n    this.client = null;\n    this.endpoint = null;\n    this.configureEndpoints = null;\n    this.loginRedirect = '#/';\n    this.logoutRedirect = '#/';\n    this.loginRoute = '/login';\n    this.loginOnSignup = true;\n    this.signupRedirect = '#/login';\n    this.expiredRedirect = '#/';\n    this.storageChangedRedirect = '#/';\n    this.baseUrl = '';\n    this.loginUrl = '/auth/login';\n    this.logoutUrl = null;\n    this.logoutMethod = 'get';\n    this.signupUrl = '/auth/signup';\n    this.profileUrl = '/auth/me';\n    this.profileMethod = 'put';\n    this.unlinkUrl = '/auth/unlink/';\n    this.unlinkMethod = 'get';\n    this.refreshTokenUrl = null;\n    this.authHeader = 'Authorization';\n    this.authTokenType = 'Bearer';\n    this.logoutOnInvalidToken = false;\n    this.accessTokenProp = 'access_token';\n    this.accessTokenName = 'token';\n    this.accessTokenRoot = false;\n    this.useRefreshToken = false;\n    this.autoUpdateToken = true;\n    this.clientId = false;\n    this.clientSecret = null;\n    this.refreshTokenProp = 'refresh_token';\n    this.refreshTokenSubmitProp = 'refresh_token';\n    this.keepOldResponseProperties = false;\n    this.refreshTokenName = 'token';\n    this.refreshTokenRoot = false;\n    this.idTokenProp = 'id_token';\n    this.idTokenName = 'token';\n    this.idTokenRoot = false;\n    this.httpInterceptor = true;\n    this.withCredentials = true;\n    this.platform = 'browser';\n    this.storage = 'localStorage';\n    this.storageKey = 'aurelia_authentication';\n    this.storageChangedReload = false;\n    this.getExpirationDateFromResponse = null;\n    this.getAccessTokenFromResponse = null;\n    this.getRefreshTokenFromResponse = null;\n    this.globalValueConverters = ['authFilterValueConverter'];\n    this.defaultHeadersForTokenRequests = {\n      'Content-Type': 'application/json'\n    };\n    this.providers = {\n      facebook: {\n        name: 'facebook',\n        url: '/auth/facebook',\n        authorizationEndpoint: 'https://www.facebook.com/v2.5/dialog/oauth',\n        redirectUri: _aureliaPal.PLATFORM.location.origin + '/',\n        requiredUrlParams: ['display', 'scope'],\n        scope: ['email'],\n        scopeDelimiter: ',',\n        display: 'popup',\n        oauthType: '2.0',\n        popupOptions: { width: 580, height: 400 }\n      },\n      google: {\n        name: 'google',\n        url: '/auth/google',\n        authorizationEndpoint: 'https://accounts.google.com/o/oauth2/auth',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        requiredUrlParams: ['scope'],\n        optionalUrlParams: ['display', 'state'],\n        scope: ['profile', 'email'],\n        scopePrefix: 'openid',\n        scopeDelimiter: ' ',\n        display: 'popup',\n        oauthType: '2.0',\n        popupOptions: { width: 452, height: 633 },\n        state: randomState\n      },\n      github: {\n        name: 'github',\n        url: '/auth/github',\n        authorizationEndpoint: 'https://github.com/login/oauth/authorize',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        optionalUrlParams: ['scope'],\n        scope: ['user:email'],\n        scopeDelimiter: ' ',\n        oauthType: '2.0',\n        popupOptions: { width: 1020, height: 618 }\n      },\n      instagram: {\n        name: 'instagram',\n        url: '/auth/instagram',\n        authorizationEndpoint: 'https://api.instagram.com/oauth/authorize',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        requiredUrlParams: ['scope'],\n        scope: ['basic'],\n        scopeDelimiter: '+',\n        oauthType: '2.0'\n      },\n      linkedin: {\n        name: 'linkedin',\n        url: '/auth/linkedin',\n        authorizationEndpoint: 'https://www.linkedin.com/uas/oauth2/authorization',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        requiredUrlParams: ['state'],\n        scope: ['r_emailaddress'],\n        scopeDelimiter: ' ',\n        state: 'STATE',\n        oauthType: '2.0',\n        popupOptions: { width: 527, height: 582 }\n      },\n      twitter: {\n        name: 'twitter',\n        url: '/auth/twitter',\n        authorizationEndpoint: 'https://api.twitter.com/oauth/authenticate',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        oauthType: '1.0',\n        popupOptions: { width: 495, height: 645 }\n      },\n      twitch: {\n        name: 'twitch',\n        url: '/auth/twitch',\n        authorizationEndpoint: 'https://api.twitch.tv/kraken/oauth2/authorize',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        requiredUrlParams: ['scope'],\n        scope: ['user_read'],\n        scopeDelimiter: ' ',\n        display: 'popup',\n        oauthType: '2.0',\n        popupOptions: { width: 500, height: 560 }\n      },\n      live: {\n        name: 'live',\n        url: '/auth/live',\n        authorizationEndpoint: 'https://login.live.com/oauth20_authorize.srf',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        requiredUrlParams: ['display', 'scope'],\n        scope: ['wl.emails'],\n        scopeDelimiter: ' ',\n        display: 'popup',\n        oauthType: '2.0',\n        popupOptions: { width: 500, height: 560 }\n      },\n      yahoo: {\n        name: 'yahoo',\n        url: '/auth/yahoo',\n        authorizationEndpoint: 'https://api.login.yahoo.com/oauth2/request_auth',\n        redirectUri: _aureliaPal.PLATFORM.location.origin,\n        scope: [],\n        scopeDelimiter: ',',\n        oauthType: '2.0',\n        popupOptions: { width: 559, height: 519 }\n      },\n      bitbucket: {\n        name: 'bitbucket',\n        url: '/auth/bitbucket',\n        authorizationEndpoint: 'https://bitbucket.org/site/oauth2/authorize',\n        redirectUri: _aureliaPal.PLATFORM.location.origin + '/',\n        requiredUrlParams: ['scope'],\n        scope: ['email'],\n        scopeDelimiter: ' ',\n        oauthType: '2.0',\n        popupOptions: { width: 1028, height: 529 }\n      },\n      azure_ad: {\n        name: 'azure_ad',\n        url: '/auth/azure_ad',\n        authorizationEndpoint: 'https://login.microsoftonline.com/common/oauth2/v2.0/authorize',\n        redirectUri: window.location.origin,\n        logoutEndpoint: 'https://login.microsoftonline.com/common/oauth2/v2.0/logout',\n        postLogoutRedirectUri: window.location.origin,\n        requiredUrlParams: ['scope'],\n        scope: ['user.read'],\n        scopeDelimiter: ' ',\n        oauthType: '2.0'\n      },\n      auth0: {\n        name: 'auth0',\n        oauthType: 'auth0-lock',\n        clientId: 'your_client_id',\n        clientDomain: 'your_domain_url',\n        display: 'popup',\n        lockOptions: {},\n        responseType: 'token',\n        state: randomState\n      }\n    };\n    this._authToken = 'Bearer';\n    this._responseTokenProp = 'access_token';\n    this._tokenName = 'token';\n    this._tokenRoot = false;\n    this._tokenPrefix = 'aurelia';\n    this._logoutOnInvalidtoken = false;\n  }\n\n  BaseConfig.prototype.joinBase = function joinBase(url) {\n    return (0, _aureliaPath.join)(this.baseUrl, url);\n  };\n\n  BaseConfig.prototype.configure = function configure(incoming) {\n    for (var key in incoming) {\n      if (incoming.hasOwnProperty(key)) {\n        var value = incoming[key];\n\n        if (value !== undefined) {\n          if (Array.isArray(value) || (typeof value === 'undefined' ? 'undefined' : _typeof(value)) !== 'object' || value === null) {\n            this[key] = value;\n          } else {\n            (0, _extend2.default)(true, this[key], value);\n          }\n        }\n      }\n    }\n  };\n\n  BaseConfig.prototype.getOptionsForTokenRequests = function getOptionsForTokenRequests() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    return (0, _extend2.default)(true, {}, { headers: this.defaultHeadersForTokenRequests }, options);\n  };\n\n  _createClass(BaseConfig, [{\n    key: 'authToken',\n    set: function set(authToken) {\n      logger.warn('BaseConfig.authToken is deprecated. Use BaseConfig.authTokenType instead.');\n      this._authTokenType = authToken;\n      this.authTokenType = authToken;\n\n      return authToken;\n    },\n    get: function get() {\n      return this._authTokenType;\n    }\n  }, {\n    key: 'responseTokenProp',\n    set: function set(responseTokenProp) {\n      logger.warn('BaseConfig.responseTokenProp is deprecated. Use BaseConfig.accessTokenProp instead.');\n      this._responseTokenProp = responseTokenProp;\n      this.accessTokenProp = responseTokenProp;\n\n      return responseTokenProp;\n    },\n    get: function get() {\n      return this._responseTokenProp;\n    }\n  }, {\n    key: 'tokenRoot',\n    set: function set(tokenRoot) {\n      logger.warn('BaseConfig.tokenRoot is deprecated. Use BaseConfig.accessTokenRoot instead.');\n      this._tokenRoot = tokenRoot;\n      this.accessTokenRoot = tokenRoot;\n\n      return tokenRoot;\n    },\n    get: function get() {\n      return this._tokenRoot;\n    }\n  }, {\n    key: 'tokenName',\n    set: function set(tokenName) {\n      logger.warn('BaseConfig.tokenName is deprecated. Use BaseConfig.accessTokenName instead.');\n      this._tokenName = tokenName;\n      this.accessTokenName = tokenName;\n\n      return tokenName;\n    },\n    get: function get() {\n      return this._tokenName;\n    }\n  }, {\n    key: 'tokenPrefix',\n    set: function set(tokenPrefix) {\n      logger.warn('BaseConfig.tokenPrefix is obsolete. Use BaseConfig.storageKey instead.');\n      this._tokenPrefix = tokenPrefix;\n\n      return tokenPrefix;\n    },\n    get: function get() {\n      return this._tokenPrefix || 'aurelia';\n    }\n  }, {\n    key: 'current',\n    get: function get() {\n      logger.warn('Getter BaseConfig.current is deprecated. Use BaseConfig directly instead.');\n\n      return this;\n    },\n    set: function set(_) {\n      throw new Error('Setter BaseConfig.current has been removed. Use BaseConfig directly instead.');\n    }\n  }, {\n    key: '_current',\n    get: function get() {\n      logger.warn('Getter BaseConfig._current is deprecated. Use BaseConfig directly instead.');\n\n      return this;\n    },\n    set: function set(_) {\n      throw new Error('Setter BaseConfig._current has been removed. Use BaseConfig directly instead.');\n    }\n  }, {\n    key: 'logoutOnInvalidtoken',\n    set: function set(logoutOnInvalidtoken) {\n      logger.warn('BaseConfig.logoutOnInvalidtoken is obsolete. Use BaseConfig.logoutOnInvalidToken instead.');\n      this._logoutOnInvalidtoken = logoutOnInvalidtoken;\n      this.logoutOnInvalidToken = logoutOnInvalidtoken;\n\n      return logoutOnInvalidtoken;\n    },\n    get: function get() {\n      return this._logoutOnInvalidtoken;\n    }\n  }]);\n\n  return BaseConfig;\n}();\n\nfunction randomState() {\n  var rand = Math.random().toString(36).substr(2);\n\n  return encodeURIComponent(rand);\n}\n\nvar Storage = exports.Storage = (_dec = (0, _aureliaDependencyInjection.inject)(BaseConfig), _dec(_class2 = function () {\n  function Storage(config) {\n    \n\n    this.config = config;\n  }\n\n  Storage.prototype.get = function get(key) {\n    return _aureliaPal.PLATFORM.global[this.config.storage].getItem(key);\n  };\n\n  Storage.prototype.set = function set(key, value) {\n    _aureliaPal.PLATFORM.global[this.config.storage].setItem(key, value);\n  };\n\n  Storage.prototype.remove = function remove(key) {\n    _aureliaPal.PLATFORM.global[this.config.storage].removeItem(key);\n  };\n\n  return Storage;\n}()) || _class2);\nvar AuthLock = exports.AuthLock = (_dec2 = (0, _aureliaDependencyInjection.inject)(Storage, BaseConfig), _dec2(_class3 = function () {\n  function AuthLock(storage, config) {\n    \n\n    this.storage = storage;\n    this.config = config;\n    this.defaults = {\n      name: null,\n      state: null,\n      scope: null,\n      scopeDelimiter: ' ',\n      redirectUri: null,\n      clientId: null,\n      clientDomain: null,\n      display: 'popup',\n      lockOptions: {},\n      popupOptions: null,\n      responseType: 'token'\n    };\n  }\n\n  AuthLock.prototype.open = function open(options, userData) {\n    var _this3 = this;\n\n    if (typeof _aureliaPal.PLATFORM.global.Auth0Lock !== 'function') {\n      throw new Error('Auth0Lock was not found in global scope. Please load it before using this provider.');\n    }\n    var provider = (0, _extend2.default)(true, {}, this.defaults, options);\n    var stateName = provider.name + '_state';\n\n    if (typeof provider.state === 'function') {\n      this.storage.set(stateName, provider.state());\n    } else if (typeof provider.state === 'string') {\n      this.storage.set(stateName, provider.state);\n    }\n\n    var opts = {\n      auth: {\n        params: {}\n      }\n    };\n\n    if (Array.isArray(provider.scope) && provider.scope.length) {\n      opts.auth.params.scope = provider.scope.join(provider.scopeDelimiter);\n    }\n    if (provider.state) {\n      opts.auth.params.state = this.storage.get(provider.name + '_state');\n    }\n    if (provider.display === 'popup') {\n      opts.auth.redirect = false;\n    } else if (typeof provider.redirectUri === 'string') {\n      opts.auth.redirect = true;\n      opts.auth.redirectUrl = provider.redirectUri;\n    }\n    if (_typeof(provider.popupOptions) === 'object') {\n      opts.popupOptions = provider.popupOptions;\n    }\n    if (typeof provider.responseType === 'string') {\n      opts.auth.responseType = provider.responseType;\n    }\n    var lockOptions = (0, _extend2.default)(true, {}, provider.lockOptions, opts);\n\n    this.lock = this.lock || new _aureliaPal.PLATFORM.global.Auth0Lock(provider.clientId, provider.clientDomain, lockOptions);\n\n    var openPopup = new Promise(function (resolve, reject) {\n      _this3.lock.on('authenticated', function (authResponse) {\n        if (!lockOptions.auth.redirect) {\n          _this3.lock.hide();\n        }\n        resolve({\n          access_token: authResponse.accessToken,\n          id_token: authResponse.idToken\n        });\n      });\n      _this3.lock.on('unrecoverable_error', function (err) {\n        if (!lockOptions.auth.redirect) {\n          _this3.lock.hide();\n        }\n        reject(err);\n      });\n      _this3.lock.show();\n    });\n\n    return openPopup.then(function (lockResponse) {\n      if (provider.responseType === 'token' || provider.responseType === 'id_token%20token' || provider.responseType === 'token%20id_token' || provider.responseType === 'token id_token') {\n        return lockResponse;\n      }\n\n      throw new Error('Only `token` responseType is supported');\n    });\n  };\n\n  return AuthLock;\n}()) || _class3);\nvar OAuth1 = exports.OAuth1 = (_dec3 = (0, _aureliaDependencyInjection.inject)(Storage, Popup, BaseConfig), _dec3(_class4 = function () {\n  function OAuth1(storage, popup, config) {\n    \n\n    this.storage = storage;\n    this.config = config;\n    this.popup = popup;\n    this.defaults = {\n      url: null,\n      name: null,\n      popupOptions: null,\n      redirectUri: null,\n      authorizationEndpoint: null\n    };\n  }\n\n  OAuth1.prototype.open = function open(options, userData) {\n    var _this4 = this;\n\n    var provider = (0, _extend2.default)(true, {}, this.defaults, options);\n    var serverUrl = this.config.joinBase(provider.url);\n\n    if (this.config.platform !== 'mobile') {\n      this.popup = this.popup.open('', provider.name, provider.popupOptions);\n    }\n\n    return this.config.client.post(serverUrl).then(function (response) {\n      var url = provider.authorizationEndpoint + '?' + (0, _aureliaPath.buildQueryString)(response);\n\n      if (_this4.config.platform === 'mobile') {\n        _this4.popup = _this4.popup.open(url, provider.name, provider.popupOptions);\n      } else {\n        _this4.popup.popupWindow.location = url;\n      }\n\n      var popupListener = _this4.config.platform === 'mobile' ? _this4.popup.eventListener(provider.redirectUri) : _this4.popup.pollPopup();\n\n      return popupListener.then(function (result) {\n        return _this4.exchangeForToken(result, userData, provider);\n      });\n    });\n  };\n\n  OAuth1.prototype.exchangeForToken = function exchangeForToken(oauthData, userData, provider) {\n    var data = (0, _extend2.default)(true, {}, userData, oauthData);\n    var serverUrl = this.config.joinBase(provider.url);\n    var credentials = this.config.withCredentials ? 'include' : 'same-origin';\n\n    return this.config.client.post(serverUrl, data, { credentials: credentials });\n  };\n\n  return OAuth1;\n}()) || _class4);\nvar OAuth2 = exports.OAuth2 = (_dec4 = (0, _aureliaDependencyInjection.inject)(Storage, Popup, BaseConfig), _dec4(_class5 = function () {\n  function OAuth2(storage, popup, config) {\n    \n\n    this.storage = storage;\n    this.config = config;\n    this.popup = popup;\n    this.defaults = {\n      url: null,\n      name: null,\n      state: null,\n      scope: null,\n      scopeDelimiter: null,\n      redirectUri: null,\n      popupOptions: null,\n      authorizationEndpoint: null,\n      responseParams: null,\n      requiredUrlParams: null,\n      optionalUrlParams: null,\n      defaultUrlParams: ['response_type', 'client_id', 'redirect_uri'],\n      responseType: 'code'\n    };\n  }\n\n  OAuth2.prototype.open = function open(options, userData) {\n    var _this5 = this;\n\n    var provider = (0, _extend2.default)(true, {}, this.defaults, options);\n    var stateName = provider.name + '_state';\n\n    if (typeof provider.state === 'function') {\n      this.storage.set(stateName, provider.state());\n    } else if (typeof provider.state === 'string') {\n      this.storage.set(stateName, provider.state);\n    }\n\n    var url = provider.authorizationEndpoint + '?' + (0, _aureliaPath.buildQueryString)(this.buildQuery(provider));\n    var popup = this.popup.open(url, provider.name, provider.popupOptions);\n    var openPopup = this.config.platform === 'mobile' ? popup.eventListener(provider.redirectUri) : popup.pollPopup();\n\n    return openPopup.then(function (oauthData) {\n      if (provider.responseType === 'token' || provider.responseType === 'id_token token' || provider.responseType === 'token id_token') {\n        return oauthData;\n      }\n      if (oauthData.state && oauthData.state !== _this5.storage.get(stateName)) {\n        return Promise.reject('OAuth 2.0 state parameter mismatch.');\n      }\n\n      return _this5.exchangeForToken(oauthData, userData, provider);\n    });\n  };\n\n  OAuth2.prototype.exchangeForToken = function exchangeForToken(oauthData, userData, provider) {\n    var data = (0, _extend2.default)(true, {}, userData, {\n      clientId: provider.clientId,\n      redirectUri: provider.redirectUri\n    }, oauthData);\n\n    var serverUrl = this.config.joinBase(provider.url);\n    var credentials = this.config.withCredentials ? 'include' : 'same-origin';\n\n    return this.config.client.post(serverUrl, data, { credentials: credentials });\n  };\n\n  OAuth2.prototype.buildQuery = function buildQuery(provider) {\n    var _this6 = this;\n\n    var query = {};\n    var urlParams = ['defaultUrlParams', 'requiredUrlParams', 'optionalUrlParams'];\n\n    urlParams.forEach(function (params) {\n      (provider[params] || []).forEach(function (paramName) {\n        var camelizedName = camelCase(paramName);\n        var paramValue = typeof provider[paramName] === 'function' ? provider[paramName]() : provider[camelizedName];\n\n        if (paramName === 'state') {\n          paramValue = encodeURIComponent(_this6.storage.get(provider.name + '_state'));\n        }\n\n        if (paramName === 'scope' && Array.isArray(paramValue)) {\n          paramValue = paramValue.join(provider.scopeDelimiter);\n\n          if (provider.scopePrefix) {\n            paramValue = provider.scopePrefix + provider.scopeDelimiter + paramValue;\n          }\n        }\n\n        query[paramName] = paramValue;\n      });\n    });\n\n    return query;\n  };\n\n  OAuth2.prototype.close = function close(options) {\n    var provider = (0, _extend2.default)(true, {}, this.defaults, options);\n    var url = provider.logoutEndpoint + '?' + (0, _aureliaPath.buildQueryString)(this.buildLogoutQuery(provider));\n    var popup = this.popup.open(url, provider.name, provider.popupOptions);\n    var openPopup = this.config.platform === 'mobile' ? popup.eventListener(provider.postLogoutRedirectUri) : popup.pollPopup();\n\n    return openPopup;\n  };\n\n  OAuth2.prototype.buildLogoutQuery = function buildLogoutQuery(provider) {\n    var query = {};\n    var authResponse = this.storage.get(this.config.storageKey);\n\n    if (provider.postLogoutRedirectUri) {\n      query.post_logout_redirect_uri = provider.postLogoutRedirectUri;\n    }\n    if (this.storage.get(provider.name + '_state')) {\n      query.state = this.storage.get(provider.name + '_state');\n    }\n    if (JSON.parse(authResponse).id_token) {\n      query.id_token_hint = JSON.parse(authResponse).id_token;\n    }\n\n    return query;\n  };\n\n  return OAuth2;\n}()) || _class5);\n\nfunction camelCase(name) {\n  return name.replace(/([:\\-_]+(.))/g, function (_, separator, letter, offset) {\n    return offset ? letter.toUpperCase() : letter;\n  });\n}\n\nvar Authentication = exports.Authentication = (_dec5 = (0, _aureliaDependencyInjection.inject)(Storage, BaseConfig, OAuth1, OAuth2, AuthLock), _dec6 = (0, _aureliaMetadata.deprecated)({ message: 'Use baseConfig.loginRoute instead.' }), _dec7 = (0, _aureliaMetadata.deprecated)({ message: 'Use baseConfig.loginRedirect instead.' }), _dec8 = (0, _aureliaMetadata.deprecated)({ message: 'Use baseConfig.joinBase(baseConfig.loginUrl) instead.' }), _dec9 = (0, _aureliaMetadata.deprecated)({ message: 'Use baseConfig.joinBase(baseConfig.signupUrl) instead.' }), _dec10 = (0, _aureliaMetadata.deprecated)({ message: 'Use baseConfig.joinBase(baseConfig.profileUrl) instead.' }), _dec11 = (0, _aureliaMetadata.deprecated)({ message: 'Use .getAccessToken() instead.' }), _dec5(_class6 = (_class7 = function () {\n  function Authentication(storage, config, oAuth1, oAuth2, auth0Lock) {\n    \n\n    this.storage = storage;\n    this.config = config;\n    this.oAuth1 = oAuth1;\n    this.oAuth2 = oAuth2;\n    this.auth0Lock = auth0Lock;\n    this.updateTokenCallstack = [];\n    this.accessToken = null;\n    this.refreshToken = null;\n    this.idToken = null;\n    this.payload = null;\n    this.exp = null;\n    this.responseAnalyzed = false;\n  }\n\n  Authentication.prototype.getLoginRoute = function getLoginRoute() {\n    return this.config.loginRoute;\n  };\n\n  Authentication.prototype.getLoginRedirect = function getLoginRedirect() {\n    return this.config.loginRedirect;\n  };\n\n  Authentication.prototype.getLoginUrl = function getLoginUrl() {\n    return this.Config.joinBase(this.config.loginUrl);\n  };\n\n  Authentication.prototype.getSignupUrl = function getSignupUrl() {\n    return this.Config.joinBase(this.config.signupUrl);\n  };\n\n  Authentication.prototype.getProfileUrl = function getProfileUrl() {\n    return this.Config.joinBase(this.config.profileUrl);\n  };\n\n  Authentication.prototype.getToken = function getToken() {\n    return this.getAccessToken();\n  };\n\n  Authentication.prototype.getResponseObject = function getResponseObject() {\n    return JSON.parse(this.storage.get(this.config.storageKey));\n  };\n\n  Authentication.prototype.setResponseObject = function setResponseObject(response) {\n    if (response) {\n      if (this.config.keepOldResponseProperties) {\n        var oldResponse = this.getResponseObject();\n\n        response = Object.assign({}, oldResponse, response);\n      }\n      this.getDataFromResponse(response);\n      this.storage.set(this.config.storageKey, JSON.stringify(response));\n\n      return;\n    }\n    this.accessToken = null;\n    this.refreshToken = null;\n    this.idToken = null;\n    this.payload = null;\n    this.exp = null;\n    this.responseAnalyzed = false;\n\n    this.storage.remove(this.config.storageKey);\n  };\n\n  Authentication.prototype.getAccessToken = function getAccessToken() {\n    if (!this.responseAnalyzed) this.getDataFromResponse(this.getResponseObject());\n\n    return this.accessToken;\n  };\n\n  Authentication.prototype.getRefreshToken = function getRefreshToken() {\n    if (!this.responseAnalyzed) this.getDataFromResponse(this.getResponseObject());\n\n    return this.refreshToken;\n  };\n\n  Authentication.prototype.getIdToken = function getIdToken() {\n    if (!this.responseAnalyzed) this.getDataFromResponse(this.getResponseObject());\n\n    return this.idToken;\n  };\n\n  Authentication.prototype.getPayload = function getPayload() {\n    if (!this.responseAnalyzed) this.getDataFromResponse(this.getResponseObject());\n\n    return this.payload;\n  };\n\n  Authentication.prototype.getIdPayload = function getIdPayload() {\n    if (!this.responseAnalyzed) this.getDataFromResponse(this.getResponseObject());\n\n    return this.idPayload;\n  };\n\n  Authentication.prototype.getExp = function getExp() {\n    if (!this.responseAnalyzed) this.getDataFromResponse(this.getResponseObject());\n\n    return this.exp;\n  };\n\n  Authentication.prototype.getTtl = function getTtl() {\n    var exp = this.getExp();\n\n    return Number.isNaN(exp) ? NaN : exp - Math.round(new Date().getTime() / 1000);\n  };\n\n  Authentication.prototype.isTokenExpired = function isTokenExpired() {\n    var timeLeft = this.getTtl();\n\n    return Number.isNaN(timeLeft) ? undefined : timeLeft < 0;\n  };\n\n  Authentication.prototype.isAuthenticated = function isAuthenticated() {\n    return !!this.getAccessToken() && !this.isTokenExpired();\n  };\n\n  Authentication.prototype.getDataFromResponse = function getDataFromResponse(response) {\n    var config = this.config;\n\n    this.accessToken = typeof this.config.getAccessTokenFromResponse === 'function' ? this.config.getAccessTokenFromResponse(response) : this.getTokenFromResponse(response, config.accessTokenProp, config.accessTokenName, config.accessTokenRoot);\n\n    this.refreshToken = null;\n    if (config.useRefreshToken) {\n      try {\n        this.refreshToken = typeof this.config.getRefreshTokenFromResponse === 'function' ? this.config.getRefreshTokenFromResponse(response) : this.getTokenFromResponse(response, config.refreshTokenProp, config.refreshTokenName, config.refreshTokenRoot);\n      } catch (e) {\n        this.refreshToken = null;\n\n        logger.warn('useRefreshToken is set, but could not extract a refresh token');\n      }\n    }\n\n    this.idToken = null;\n    try {\n      this.idToken = this.getTokenFromResponse(response, config.idTokenProp, config.idTokenName, config.idTokenRoot);\n    } catch (e) {\n      this.idToken = null;\n    }\n\n    this.payload = getPayload(this.accessToken);\n    this.idPayload = getPayload(this.idToken);\n\n    this.exp = parseInt(typeof this.config.getExpirationDateFromResponse === 'function' ? this.config.getExpirationDateFromResponse(response) : this.payload && this.payload.exp, 10) || NaN;\n\n    this.responseAnalyzed = true;\n\n    return {\n      accessToken: this.accessToken,\n      refreshToken: this.refreshToken,\n      idToken: this.idToken,\n      payload: this.payload,\n      exp: this.exp\n    };\n  };\n\n  Authentication.prototype.getTokenFromResponse = function getTokenFromResponse(response, tokenProp, tokenName, tokenRoot) {\n    if (!response) return undefined;\n\n    var responseTokenProp = tokenProp.split('.').reduce(function (o, x) {\n      return o[x];\n    }, response);\n\n    if (typeof responseTokenProp === 'string') {\n      return responseTokenProp;\n    }\n\n    if ((typeof responseTokenProp === 'undefined' ? 'undefined' : _typeof(responseTokenProp)) === 'object') {\n      var tokenRootData = tokenRoot && tokenRoot.split('.').reduce(function (o, x) {\n        return o[x];\n      }, responseTokenProp);\n      var _token = tokenRootData ? tokenRootData[tokenName] : responseTokenProp[tokenName];\n\n      if (!_token) {\n        var error = new Error('Token not found in response');\n\n        error.responseObject = response;\n        throw error;\n      }\n\n      return _token;\n    }\n\n    var token = response[tokenName] === undefined ? null : response[tokenName];\n\n    if (!token) {\n      var _error = new Error('Token not found in response');\n\n      _error.responseObject = response;\n      throw _error;\n    }\n\n    return token;\n  };\n\n  Authentication.prototype.toUpdateTokenCallstack = function toUpdateTokenCallstack() {\n    var _this7 = this;\n\n    return new Promise(function (resolve) {\n      return _this7.updateTokenCallstack.push(resolve);\n    });\n  };\n\n  Authentication.prototype.resolveUpdateTokenCallstack = function resolveUpdateTokenCallstack(response) {\n    this.updateTokenCallstack.map(function (resolve) {\n      return resolve(response);\n    });\n    this.updateTokenCallstack = [];\n  };\n\n  Authentication.prototype.authenticate = function authenticate(name) {\n    var userData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var oauthType = this.config.providers[name].type;\n\n    if (oauthType) {\n      logger.warn('DEPRECATED: Setting provider.type is deprecated and replaced by provider.oauthType');\n    } else {\n      oauthType = this.config.providers[name].oauthType;\n    }\n\n    var providerLogin = void 0;\n\n    if (oauthType === 'auth0-lock') {\n      providerLogin = this.auth0Lock;\n    } else {\n      providerLogin = oauthType === '1.0' ? this.oAuth1 : this.oAuth2;\n    }\n\n    return providerLogin.open(this.config.providers[name], userData);\n  };\n\n  Authentication.prototype.logout = function logout(name) {\n    var rtnValue = Promise.resolve('Not Applicable');\n\n    if (this.config.providers[name].oauthType !== '2.0' || !this.config.providers[name].logoutEndpoint) {\n      return rtnValue;\n    }\n\n    return this.oAuth2.close(this.config.providers[name]);\n  };\n\n  Authentication.prototype.redirect = function redirect(redirectUrl, defaultRedirectUrl, query) {\n    if (redirectUrl === true) {\n      logger.warn('DEPRECATED: Setting redirectUrl === true to actually *not redirect* is deprecated. Set redirectUrl === \\'\\' instead.');\n\n      return;\n    }\n\n    if (redirectUrl === false) {\n      logger.warn('BREAKING CHANGE: Setting redirectUrl === false to actually *do redirect* is deprecated. Set redirectUrl to undefined or null to use the defaultRedirectUrl if so desired.');\n    }\n\n    if (redirectUrl === 0) {\n      logger.warn('BREAKING CHANGE: Setting redirectUrl === 0 is deprecated. Set redirectUrl to \\'\\' instead.');\n\n      return;\n    }\n\n    if (redirectUrl === '') {\n      return;\n    }\n\n    if (typeof redirectUrl === 'string') {\n      _aureliaPal.PLATFORM.location.href = encodeURI(redirectUrl + (query ? '?' + (0, _aureliaPath.buildQueryString)(query) : ''));\n    } else if (defaultRedirectUrl) {\n      _aureliaPal.PLATFORM.location.href = defaultRedirectUrl + (query ? '?' + (0, _aureliaPath.buildQueryString)(query) : '');\n    }\n  };\n\n  _createClass(Authentication, [{\n    key: 'responseObject',\n    get: function get() {\n      logger.warn('Getter Authentication.responseObject is deprecated. Use Authentication.getResponseObject() instead.');\n\n      return this.getResponseObject();\n    },\n    set: function set(response) {\n      logger.warn('Setter Authentication.responseObject is deprecated. Use AuthServive.setResponseObject(response) instead.');\n      this.setResponseObject(response);\n    }\n  }, {\n    key: 'hasDataStored',\n    get: function get() {\n      logger.warn('Authentication.hasDataStored is deprecated. Use Authentication.responseAnalyzed instead.');\n\n      return this.responseAnalyzed;\n    }\n  }]);\n\n  return Authentication;\n}(), (_applyDecoratedDescriptor(_class7.prototype, 'getLoginRoute', [_dec6], Object.getOwnPropertyDescriptor(_class7.prototype, 'getLoginRoute'), _class7.prototype), _applyDecoratedDescriptor(_class7.prototype, 'getLoginRedirect', [_dec7], Object.getOwnPropertyDescriptor(_class7.prototype, 'getLoginRedirect'), _class7.prototype), _applyDecoratedDescriptor(_class7.prototype, 'getLoginUrl', [_dec8], Object.getOwnPropertyDescriptor(_class7.prototype, 'getLoginUrl'), _class7.prototype), _applyDecoratedDescriptor(_class7.prototype, 'getSignupUrl', [_dec9], Object.getOwnPropertyDescriptor(_class7.prototype, 'getSignupUrl'), _class7.prototype), _applyDecoratedDescriptor(_class7.prototype, 'getProfileUrl', [_dec10], Object.getOwnPropertyDescriptor(_class7.prototype, 'getProfileUrl'), _class7.prototype), _applyDecoratedDescriptor(_class7.prototype, 'getToken', [_dec11], Object.getOwnPropertyDescriptor(_class7.prototype, 'getToken'), _class7.prototype)), _class7)) || _class6);\n\nfunction getPayload(token) {\n  var payload = null;\n\n  try {\n    payload = token ? (0, _jwtDecode2.default)(token) : null;\n  } catch (_) {}\n\n  return payload;\n}\n\nvar AuthService = exports.AuthService = (_dec12 = (0, _aureliaDependencyInjection.inject)(Authentication, BaseConfig, _aureliaTemplatingResources.BindingSignaler, _aureliaEventAggregator.EventAggregator), _dec13 = (0, _aureliaMetadata.deprecated)({ message: 'Use .getAccessToken() instead.' }), _dec12(_class8 = (_class9 = function () {\n  function AuthService(authentication, config, bindingSignaler, eventAggregator) {\n    var _this8 = this;\n\n    \n\n    this.authenticated = false;\n    this.timeoutID = 0;\n\n    this.storageEventHandler = function (event) {\n      if (event.key !== _this8.config.storageKey || event.newValue === event.oldValue) {\n        return;\n      }\n\n      if (event.newValue) {\n        _this8.authentication.storage.set(_this8.config.storageKey, event.newValue);\n      } else {\n        _this8.authentication.storage.remove(_this8.config.storageKey);\n      }\n\n      if (event.newValue && _this8.config.autoUpdateToken && _this8.authentication.getAccessToken() && _this8.authentication.getRefreshToken()) {\n        _this8.setResponseObject(_this8.authentication.getResponseObject());\n\n        return;\n      }\n\n      logger.info('Stored token changed event');\n\n      var wasAuthenticated = _this8.authenticated;\n\n      _this8.authentication.responseAnalyzed = false;\n      _this8.updateAuthenticated();\n\n      if (wasAuthenticated === _this8.authenticated) {\n        return;\n      }\n\n      if (_this8.config.storageChangedRedirect) {\n        _aureliaPal.PLATFORM.location.href = _this8.config.storageChangedRedirect;\n      }\n\n      if (_this8.config.storageChangedReload) {\n        _aureliaPal.PLATFORM.location.reload();\n      }\n    };\n\n    this.authentication = authentication;\n    this.config = config;\n    this.bindingSignaler = bindingSignaler;\n    this.eventAggregator = eventAggregator;\n\n    var oldStorageKey = config.tokenPrefix ? config.tokenPrefix + '_' + config.tokenName : config.tokenName;\n    var oldToken = authentication.storage.get(oldStorageKey);\n\n    if (oldToken) {\n      logger.info('Found token with deprecated format in storage. Converting it to new format. No further action required.');\n      var fakeOldResponse = {};\n\n      fakeOldResponse[config.accessTokenProp] = oldToken;\n      this.setResponseObject(fakeOldResponse);\n      authentication.storage.remove(oldStorageKey);\n    }\n\n    this.setResponseObject(this.authentication.getResponseObject());\n\n    _aureliaPal.PLATFORM.addEventListener('storage', this.storageEventHandler);\n  }\n\n  AuthService.prototype.setTimeout = function setTimeout(ttl) {\n    var _this9 = this;\n\n    var maxTimeout = 2147483647;\n    if (ttl > maxTimeout) {\n      ttl = maxTimeout;\n      logger.warn('Token timeout limited to ', maxTimeout, ' ms (ca 24.85d).');\n    }\n\n    this.clearTimeout();\n\n    var expiredTokenHandler = function expiredTokenHandler() {\n      if (_this9.config.autoUpdateToken && _this9.authentication.getAccessToken() && _this9.authentication.getRefreshToken()) {\n        _this9.updateToken().catch(function (error) {\n          return logger.warn(error.message);\n        });\n\n        return;\n      }\n\n      _this9.setResponseObject(null);\n\n      if (_this9.config.expiredRedirect) {\n        _aureliaPal.PLATFORM.location.assign(_this9.config.expiredRedirect);\n      }\n    };\n\n    this.timeoutID = _aureliaPal.PLATFORM.global.setTimeout(expiredTokenHandler, ttl);\n    _aureliaPal.PLATFORM.addEventListener('focus', function () {\n      if (_this9.isTokenExpired()) {\n        expiredTokenHandler();\n      }\n    });\n  };\n\n  AuthService.prototype.clearTimeout = function clearTimeout() {\n    if (this.timeoutID) {\n      _aureliaPal.PLATFORM.global.clearTimeout(this.timeoutID);\n    }\n    this.timeoutID = 0;\n  };\n\n  AuthService.prototype.setResponseObject = function setResponseObject(response) {\n    this.authentication.setResponseObject(response);\n\n    this.updateAuthenticated();\n  };\n\n  AuthService.prototype.updateAuthenticated = function updateAuthenticated() {\n    this.clearTimeout();\n\n    var wasAuthenticated = this.authenticated;\n\n    this.authenticated = this.authentication.isAuthenticated();\n\n    if (this.authenticated && !Number.isNaN(this.authentication.exp)) {\n      this.setTimeout(this.getTtl() * 1000);\n    }\n\n    if (wasAuthenticated !== this.authenticated) {\n      this.bindingSignaler.signal('authentication-change');\n      this.eventAggregator.publish('authentication-change', this.authenticated);\n\n      logger.info('Authorization changed to: ' + this.authenticated);\n    }\n  };\n\n  AuthService.prototype.getMe = function getMe(criteriaOrId) {\n    if (typeof criteriaOrId === 'string' || typeof criteriaOrId === 'number') {\n      criteriaOrId = { id: criteriaOrId };\n    }\n\n    return this.client.find(this.config.joinBase(this.config.profileUrl), criteriaOrId);\n  };\n\n  AuthService.prototype.updateMe = function updateMe(body, criteriaOrId) {\n    if (typeof criteriaOrId === 'string' || typeof criteriaOrId === 'number') {\n      criteriaOrId = { id: criteriaOrId };\n    }\n    if (this.config.profileMethod === 'put') {\n      return this.client.update(this.config.joinBase(this.config.profileUrl), criteriaOrId, body);\n    }\n\n    return this.client.patch(this.config.joinBase(this.config.profileUrl), criteriaOrId, body);\n  };\n\n  AuthService.prototype.getAccessToken = function getAccessToken() {\n    return this.authentication.getAccessToken();\n  };\n\n  AuthService.prototype.getCurrentToken = function getCurrentToken() {\n    return this.getAccessToken();\n  };\n\n  AuthService.prototype.getRefreshToken = function getRefreshToken() {\n    return this.authentication.getRefreshToken();\n  };\n\n  AuthService.prototype.getIdToken = function getIdToken() {\n    return this.authentication.getIdToken();\n  };\n\n  AuthService.prototype.isAuthenticated = function isAuthenticated(callback) {\n    var _this10 = this;\n\n    this.authentication.responseAnalyzed = false;\n\n    var authenticated = this.authentication.isAuthenticated();\n\n    if (!authenticated && this.config.autoUpdateToken && this.authentication.getAccessToken() && this.authentication.getRefreshToken()) {\n      this.updateToken().then(function () {\n        if (typeof callback === 'function') {\n          callback(_this10.authenticated);\n        }\n      }).catch(function (error) {\n        return logger.warn(error.message);\n      });\n\n      authenticated = true;\n    } else if (typeof callback === 'function') {\n      _aureliaPal.PLATFORM.global.setTimeout(function () {\n        try {\n          callback(authenticated);\n        } catch (error) {\n          logger.warn(error.message);\n        }\n      }, 1);\n    }\n\n    return authenticated;\n  };\n\n  AuthService.prototype.getExp = function getExp() {\n    return this.authentication.getExp();\n  };\n\n  AuthService.prototype.getTtl = function getTtl() {\n    return this.authentication.getTtl();\n  };\n\n  AuthService.prototype.isTokenExpired = function isTokenExpired() {\n    return this.authentication.isTokenExpired();\n  };\n\n  AuthService.prototype.getTokenPayload = function getTokenPayload() {\n    return this.authentication.getPayload();\n  };\n\n  AuthService.prototype.getIdTokenPayload = function getIdTokenPayload() {\n    return this.authentication.getIdPayload();\n  };\n\n  AuthService.prototype.updateToken = function updateToken() {\n    var _this11 = this;\n\n    if (!this.authentication.getRefreshToken()) {\n      return Promise.reject(new Error('refreshToken not set'));\n    }\n\n    if (this.authentication.updateTokenCallstack.length === 0) {\n      var content = {\n        grant_type: 'refresh_token'\n      };\n\n      if (this.config.clientId) {\n        content.client_id = this.config.clientId;\n      }\n      if (this.config.clientSecret) {\n        content.client_secret = this.config.clientSecret;\n      }\n\n      content[this.config.refreshTokenSubmitProp] = this.authentication.getRefreshToken();\n\n      this.client.post(this.config.joinBase(this.config.refreshTokenUrl ? this.config.refreshTokenUrl : this.config.loginUrl), content, this.config.getOptionsForTokenRequests()).then(function (response) {\n        _this11.setResponseObject(response);\n        if (_this11.getAccessToken()) {\n          _this11.authentication.resolveUpdateTokenCallstack(_this11.isAuthenticated());\n        } else {\n          _this11.setResponseObject(null);\n\n          if (_this11.config.expiredRedirect) {\n            _aureliaPal.PLATFORM.location.assign(_this11.config.expiredRedirect);\n          }\n          _this11.authentication.resolveUpdateTokenCallstack(Promise.reject(new Error('accessToken not found in refreshToken response')));\n        }\n      }).catch(function (error) {\n        _this11.setResponseObject(null);\n\n        if (_this11.config.expiredRedirect) {\n          _aureliaPal.PLATFORM.location.assign(_this11.config.expiredRedirect);\n        }\n        _this11.authentication.resolveUpdateTokenCallstack(Promise.reject(error));\n      });\n    }\n\n    return this.authentication.toUpdateTokenCallstack();\n  };\n\n  AuthService.prototype.signup = function signup(displayNameOrCredentials, emailOrOptions, passwordOrRedirectUri, options, redirectUri) {\n    var _this12 = this;\n\n    var normalized = {};\n\n    if ((typeof displayNameOrCredentials === 'undefined' ? 'undefined' : _typeof(displayNameOrCredentials)) === 'object') {\n      normalized.credentials = displayNameOrCredentials;\n      normalized.options = emailOrOptions;\n      normalized.redirectUri = passwordOrRedirectUri;\n    } else {\n      normalized.credentials = {\n        'displayName': displayNameOrCredentials,\n        'email': emailOrOptions,\n        'password': passwordOrRedirectUri\n      };\n      normalized.options = options;\n      normalized.redirectUri = redirectUri;\n    }\n\n    return this.client.post(this.config.joinBase(this.config.signupUrl), normalized.credentials, normalized.options).then(function (response) {\n      if (_this12.config.loginOnSignup) {\n        _this12.setResponseObject(response);\n      }\n      _this12.authentication.redirect(normalized.redirectUri, _this12.config.signupRedirect);\n\n      return response;\n    });\n  };\n\n  AuthService.prototype.login = function login(emailOrCredentials, passwordOrOptions, optionsOrRedirectUri, redirectUri) {\n    var _this13 = this;\n\n    var normalized = {};\n\n    if ((typeof emailOrCredentials === 'undefined' ? 'undefined' : _typeof(emailOrCredentials)) === 'object') {\n      normalized.credentials = emailOrCredentials;\n      normalized.options = this.config.getOptionsForTokenRequests(passwordOrOptions);\n      normalized.redirectUri = optionsOrRedirectUri;\n    } else if (typeof emailOrCredentials === 'string') {\n      normalized.credentials = {\n        'email': emailOrCredentials,\n        'password': passwordOrOptions\n      };\n      normalized.options = this.config.getOptionsForTokenRequests(optionsOrRedirectUri);\n      normalized.redirectUri = redirectUri;\n    }\n\n    if (this.config.clientId) {\n      normalized.credentials.client_id = this.config.clientId;\n    }\n\n    if (this.config.clientSecret) {\n      normalized.credentials.client_secret = this.config.clientSecret;\n    }\n\n    return this.client.post(this.config.joinBase(this.config.loginUrl), normalized.credentials, normalized.options).then(function (response) {\n      _this13.setResponseObject(response);\n\n      _this13.authentication.redirect(normalized.redirectUri, _this13.config.loginRedirect);\n\n      return response;\n    });\n  };\n\n  AuthService.prototype.logout = function logout(redirectUri, query, name) {\n    var _this14 = this;\n\n    var localLogout = function localLogout(response) {\n      return new Promise(function (resolve) {\n        _this14.setResponseObject(null);\n\n        _this14.authentication.redirect(redirectUri, _this14.config.logoutRedirect, query);\n\n        if (typeof _this14.onLogout === 'function') {\n          _this14.onLogout(response);\n        }\n        resolve(response);\n      });\n    };\n\n    if (name) {\n      if (this.config.providers[name].logoutEndpoint) {\n        return this.authentication.logout(name).then(function (logoutResponse) {\n          var stateValue = _this14.authentication.storage.get(name + '_state');\n\n          if (logoutResponse.state !== stateValue) {\n            return Promise.reject('OAuth2 response state value differs');\n          }\n\n          return localLogout(logoutResponse);\n        });\n      }\n    } else {\n      return this.config.logoutUrl ? this.client.request(this.config.logoutMethod, this.config.joinBase(this.config.logoutUrl)).then(localLogout).catch(localLogout) : localLogout();\n    }\n  };\n\n  AuthService.prototype.authenticate = function authenticate(name, redirectUri, userData) {\n    var _this15 = this;\n\n    return this.authentication.authenticate(name, userData).then(function (response) {\n      _this15.setResponseObject(response);\n\n      _this15.authentication.redirect(redirectUri, _this15.config.loginRedirect);\n\n      return response;\n    });\n  };\n\n  AuthService.prototype.unlink = function unlink(name, redirectUri) {\n    var _this16 = this;\n\n    var unlinkUrl = this.config.joinBase(this.config.unlinkUrl) + name;\n\n    return this.client.request(this.config.unlinkMethod, unlinkUrl).then(function (response) {\n      _this16.authentication.redirect(redirectUri);\n\n      return response;\n    });\n  };\n\n  _createClass(AuthService, [{\n    key: 'client',\n    get: function get() {\n      return this.config.client;\n    }\n  }, {\n    key: 'auth',\n    get: function get() {\n      logger.warn('AuthService.auth is deprecated. Use .authentication instead.');\n\n      return this.authentication;\n    }\n  }]);\n\n  return AuthService;\n}(), (_applyDecoratedDescriptor(_class9.prototype, 'getCurrentToken', [_dec13], Object.getOwnPropertyDescriptor(_class9.prototype, 'getCurrentToken'), _class9.prototype)), _class9)) || _class8);\nvar AuthenticateStep = exports.AuthenticateStep = (_dec14 = (0, _aureliaDependencyInjection.inject)(AuthService), _dec14(_class11 = function () {\n  function AuthenticateStep(authService) {\n    \n\n    this.authService = authService;\n  }\n\n  AuthenticateStep.prototype.run = function run(routingContext, next) {\n    var isLoggedIn = this.authService.authenticated;\n    var loginRoute = this.authService.config.loginRoute;\n\n    if (routingContext.getAllInstructions().some(function (route) {\n      return route.config.auth === true;\n    })) {\n      if (!isLoggedIn) {\n        return next.cancel(new _aureliaRouter.Redirect(loginRoute));\n      }\n    } else if (isLoggedIn && routingContext.getAllInstructions().some(function (route) {\n      return route.fragment === loginRoute;\n    })) {\n      return next.cancel(new _aureliaRouter.Redirect(this.authService.config.loginRedirect));\n    }\n\n    return next();\n  };\n\n  return AuthenticateStep;\n}()) || _class11);\nvar AuthorizeStep = exports.AuthorizeStep = (_dec15 = (0, _aureliaDependencyInjection.inject)(AuthService), _dec15(_class12 = function () {\n  function AuthorizeStep(authService) {\n    \n\n    logger.warn('AuthorizeStep is deprecated. Use AuthenticateStep instead.');\n\n    this.authService = authService;\n  }\n\n  AuthorizeStep.prototype.run = function run(routingContext, next) {\n    var isLoggedIn = this.authService.isAuthenticated();\n    var loginRoute = this.authService.config.loginRoute;\n\n    if (routingContext.getAllInstructions().some(function (route) {\n      return route.config.auth;\n    })) {\n      if (!isLoggedIn) {\n        return next.cancel(new _aureliaRouter.Redirect(loginRoute));\n      }\n    } else if (isLoggedIn && routingContext.getAllInstructions().some(function (route) {\n      return route.fragment === loginRoute;\n    })) {\n      return next.cancel(new _aureliaRouter.Redirect(this.authService.config.loginRedirect));\n    }\n\n    return next();\n  };\n\n  return AuthorizeStep;\n}()) || _class12);\nvar FetchConfig = exports.FetchConfig = (_dec16 = (0, _aureliaDependencyInjection.inject)(_aureliaFetchClient.HttpClient, _aureliaApi.Config, AuthService, BaseConfig), _dec16(_class13 = function () {\n  function FetchConfig(httpClient, clientConfig, authService, config) {\n    \n\n    this.httpClient = httpClient;\n    this.clientConfig = clientConfig;\n    this.authService = authService;\n    this.config = config;\n  }\n\n  FetchConfig.prototype.configure = function configure(client) {\n    var _this17 = this;\n\n    if (Array.isArray(client)) {\n      var configuredClients = [];\n\n      client.forEach(function (toConfigure) {\n        configuredClients.push(_this17.configure(toConfigure));\n      });\n\n      return configuredClients;\n    }\n\n    if (typeof client === 'string') {\n      var endpoint = this.clientConfig.getEndpoint(client);\n\n      if (!endpoint) {\n        throw new Error('There is no \\'' + (client || 'default') + '\\' endpoint registered.');\n      }\n      client = endpoint.client;\n    } else if (client instanceof _aureliaApi.Rest) {\n      client = client.client;\n    } else if (!(client instanceof _aureliaFetchClient.HttpClient)) {\n      client = this.httpClient;\n    }\n\n    client.interceptors.push(this.interceptor);\n\n    return client;\n  };\n\n  _createClass(FetchConfig, [{\n    key: 'interceptor',\n    get: function get() {\n      var _this18 = this;\n\n      return {\n        request: function (_request) {\n          function request(_x3) {\n            return _request.apply(this, arguments);\n          }\n\n          request.toString = function () {\n            return _request.toString();\n          };\n\n          return request;\n        }(function (request) {\n          if (!_this18.config.httpInterceptor || !_this18.authService.isAuthenticated()) {\n            return request;\n          }\n          var token = _this18.authService.getAccessToken();\n\n          if (_this18.config.authTokenType) {\n            token = _this18.config.authTokenType + ' ' + token;\n          }\n\n          request.headers.set(_this18.config.authHeader, token);\n\n          return request;\n        }),\n        response: function (_response) {\n          function response(_x4, _x5) {\n            return _response.apply(this, arguments);\n          }\n\n          response.toString = function () {\n            return _response.toString();\n          };\n\n          return response;\n        }(function (response, request) {\n          return new Promise(function (resolve, reject) {\n            if (response.ok) {\n              return resolve(response);\n            }\n\n            if (response.status !== 401) {\n              return resolve(response);\n            }\n\n            if (!_this18.authService.authenticated) {\n              return reject(response);\n            }\n\n            if (_this18.config.httpInterceptor && _this18.config.logoutOnInvalidToken && !_this18.authService.isTokenExpired()) {\n              return reject(_this18.authService.logout());\n            }\n\n            if (!_this18.config.httpInterceptor || !_this18.authService.isTokenExpired()) {\n              return resolve(response);\n            }\n\n            if (!_this18.config.useRefreshToken || !_this18.authService.getRefreshToken()) {\n              return resolve(response);\n            }\n\n            resolve(_this18.authService.updateToken().then(function () {\n              var token = _this18.authService.getAccessToken();\n\n              if (_this18.config.authTokenType) {\n                token = _this18.config.authTokenType + ' ' + token;\n              }\n\n              request.headers.set(_this18.config.authHeader, token);\n\n              return _this18.httpClient.fetch(request).then(resolve);\n            }));\n          });\n        })\n      };\n    }\n  }]);\n\n  return FetchConfig;\n}()) || _class13);\nfunction configure(frameworkConfig, config) {\n  if (!_aureliaPal.PLATFORM.location.origin) {\n    _aureliaPal.PLATFORM.location.origin = _aureliaPal.PLATFORM.location.protocol + '//' + _aureliaPal.PLATFORM.location.hostname + (_aureliaPal.PLATFORM.location.port ? ':' + _aureliaPal.PLATFORM.location.port : '');\n  }\n\n  var baseConfig = frameworkConfig.container.get(BaseConfig);\n\n  if (typeof config === 'function') {\n    config(baseConfig);\n  } else if ((typeof config === 'undefined' ? 'undefined' : _typeof(config)) === 'object') {\n    baseConfig.configure(config);\n  }\n\n  for (var _iterator = baseConfig.globalValueConverters, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n    var _ref;\n\n    if (_isArray) {\n      if (_i >= _iterator.length) break;\n      _ref = _iterator[_i++];\n    } else {\n      _i = _iterator.next();\n      if (_i.done) break;\n      _ref = _i.value;\n    }\n\n    var converter = _ref;\n\n    frameworkConfig.globalResources(_aureliaPal.PLATFORM.moduleName('./' + converter));\n    logger.info('Add globalResources value-converter: ' + converter);\n  }\n  var fetchConfig = frameworkConfig.container.get(FetchConfig);\n  var clientConfig = frameworkConfig.container.get(_aureliaApi.Config);\n\n  if (Array.isArray(baseConfig.configureEndpoints)) {\n    baseConfig.configureEndpoints.forEach(function (endpointToPatch) {\n      fetchConfig.configure(endpointToPatch);\n    });\n  }\n\n  var client = void 0;\n\n  if (baseConfig.endpoint !== null) {\n    if (typeof baseConfig.endpoint === 'string') {\n      var endpoint = clientConfig.getEndpoint(baseConfig.endpoint);\n\n      if (!endpoint) {\n        throw new Error('There is no \\'' + (baseConfig.endpoint || 'default') + '\\' endpoint registered.');\n      }\n      client = endpoint;\n    } else if (baseConfig.endpoint instanceof _aureliaFetchClient.HttpClient) {\n      client = new _aureliaApi.Rest(baseConfig.endpoint);\n    }\n  }\n\n  if (!(client instanceof _aureliaApi.Rest)) {\n    client = new _aureliaApi.Rest(frameworkConfig.container.get(_aureliaFetchClient.HttpClient));\n  }\n\n  baseConfig.client = client;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyZWxpYS1hdXRoZW50aWNhdGlvbi5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9hdXJlbGlhLWF1dGhlbnRpY2F0aW9uL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1hdXRoZW50aWNhdGlvbi5qcz82ZDVlIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuRmV0Y2hDb25maWcgPSBleHBvcnRzLkF1dGhvcml6ZVN0ZXAgPSBleHBvcnRzLkF1dGhlbnRpY2F0ZVN0ZXAgPSBleHBvcnRzLkF1dGhTZXJ2aWNlID0gZXhwb3J0cy5BdXRoZW50aWNhdGlvbiA9IGV4cG9ydHMuT0F1dGgyID0gZXhwb3J0cy5PQXV0aDEgPSBleHBvcnRzLkF1dGhMb2NrID0gZXhwb3J0cy5TdG9yYWdlID0gZXhwb3J0cy5CYXNlQ29uZmlnID0gZXhwb3J0cy5sb2dnZXIgPSBleHBvcnRzLlBvcHVwID0gdW5kZWZpbmVkO1xuXG52YXIgX2RlYywgX2NsYXNzMiwgX2RlYzIsIF9jbGFzczMsIF9kZWMzLCBfY2xhc3M0LCBfZGVjNCwgX2NsYXNzNSwgX2RlYzUsIF9kZWM2LCBfZGVjNywgX2RlYzgsIF9kZWM5LCBfZGVjMTAsIF9kZWMxMSwgX2NsYXNzNiwgX2Rlc2MsIF92YWx1ZSwgX2NsYXNzNywgX2RlYzEyLCBfZGVjMTMsIF9jbGFzczgsIF9kZXNjMiwgX3ZhbHVlMiwgX2NsYXNzOSwgX2RlYzE0LCBfY2xhc3MxMSwgX2RlYzE1LCBfY2xhc3MxMiwgX2RlYzE2LCBfY2xhc3MxMztcblxudmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpO1xuXG5leHBvcnRzLmNvbmZpZ3VyZSA9IGNvbmZpZ3VyZTtcblxudmFyIF9leHRlbmQgPSByZXF1aXJlKCdleHRlbmQnKTtcblxudmFyIF9leHRlbmQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZXh0ZW5kKTtcblxudmFyIF9qd3REZWNvZGUgPSByZXF1aXJlKCdqd3QtZGVjb2RlJyk7XG5cbnZhciBfand0RGVjb2RlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2p3dERlY29kZSk7XG5cbnZhciBfYXVyZWxpYVBhbCA9IHJlcXVpcmUoJ2F1cmVsaWEtcGFsJyk7XG5cbnZhciBfYXVyZWxpYVBhdGggPSByZXF1aXJlKCdhdXJlbGlhLXBhdGgnKTtcblxudmFyIF9hdXJlbGlhTG9nZ2luZyA9IHJlcXVpcmUoJ2F1cmVsaWEtbG9nZ2luZycpO1xuXG52YXIgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uID0gcmVxdWlyZSgnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbicpO1xuXG52YXIgX2F1cmVsaWFNZXRhZGF0YSA9IHJlcXVpcmUoJ2F1cmVsaWEtbWV0YWRhdGEnKTtcblxudmFyIF9hdXJlbGlhRXZlbnRBZ2dyZWdhdG9yID0gcmVxdWlyZSgnYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yJyk7XG5cbnZhciBfYXVyZWxpYVRlbXBsYXRpbmdSZXNvdXJjZXMgPSByZXF1aXJlKCdhdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzJyk7XG5cbnZhciBfYXVyZWxpYUFwaSA9IHJlcXVpcmUoJ2F1cmVsaWEtYXBpJyk7XG5cbnZhciBfYXVyZWxpYVJvdXRlciA9IHJlcXVpcmUoJ2F1cmVsaWEtcm91dGVyJyk7XG5cbnZhciBfYXVyZWxpYUZldGNoQ2xpZW50ID0gcmVxdWlyZSgnYXVyZWxpYS1mZXRjaC1jbGllbnQnKTtcblxudmFyIF9hdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIgPSByZXF1aXJlKCcuL2F1dGhGaWx0ZXJWYWx1ZUNvbnZlcnRlcicpO1xuXG52YXIgX2F1dGhlbnRpY2F0ZWRWYWx1ZUNvbnZlcnRlciA9IHJlcXVpcmUoJy4vYXV0aGVudGljYXRlZFZhbHVlQ29udmVydGVyJyk7XG5cbnZhciBfYXV0aGVudGljYXRlZEZpbHRlclZhbHVlQ29udmVydGVyID0gcmVxdWlyZSgnLi9hdXRoZW50aWNhdGVkRmlsdGVyVmFsdWVDb252ZXJ0ZXInKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcih0YXJnZXQsIHByb3BlcnR5LCBkZWNvcmF0b3JzLCBkZXNjcmlwdG9yLCBjb250ZXh0KSB7XG4gIHZhciBkZXNjID0ge307XG4gIE9iamVjdFsna2UnICsgJ3lzJ10oZGVzY3JpcHRvcikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgZGVzY1trZXldID0gZGVzY3JpcHRvcltrZXldO1xuICB9KTtcbiAgZGVzYy5lbnVtZXJhYmxlID0gISFkZXNjLmVudW1lcmFibGU7XG4gIGRlc2MuY29uZmlndXJhYmxlID0gISFkZXNjLmNvbmZpZ3VyYWJsZTtcblxuICBpZiAoJ3ZhbHVlJyBpbiBkZXNjIHx8IGRlc2MuaW5pdGlhbGl6ZXIpIHtcbiAgICBkZXNjLndyaXRhYmxlID0gdHJ1ZTtcbiAgfVxuXG4gIGRlc2MgPSBkZWNvcmF0b3JzLnNsaWNlKCkucmV2ZXJzZSgpLnJlZHVjZShmdW5jdGlvbiAoZGVzYywgZGVjb3JhdG9yKSB7XG4gICAgcmV0dXJuIGRlY29yYXRvcih0YXJnZXQsIHByb3BlcnR5LCBkZXNjKSB8fCBkZXNjO1xuICB9LCBkZXNjKTtcblxuICBpZiAoY29udGV4dCAmJiBkZXNjLmluaXRpYWxpemVyICE9PSB2b2lkIDApIHtcbiAgICBkZXNjLnZhbHVlID0gZGVzYy5pbml0aWFsaXplciA/IGRlc2MuaW5pdGlhbGl6ZXIuY2FsbChjb250ZXh0KSA6IHZvaWQgMDtcbiAgICBkZXNjLmluaXRpYWxpemVyID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKGRlc2MuaW5pdGlhbGl6ZXIgPT09IHZvaWQgMCkge1xuICAgIE9iamVjdFsnZGVmaW5lJyArICdQcm9wZXJ0eSddKHRhcmdldCwgcHJvcGVydHksIGRlc2MpO1xuICAgIGRlc2MgPSBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGRlc2M7XG59XG5cblxuXG52YXIgUG9wdXAgPSBleHBvcnRzLlBvcHVwID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQb3B1cCgpIHtcbiAgICBcblxuICAgIHRoaXMucG9wdXBXaW5kb3cgPSBudWxsO1xuICAgIHRoaXMucG9sbGluZyA9IG51bGw7XG4gICAgdGhpcy51cmwgPSAnJztcbiAgfVxuXG4gIFBvcHVwLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gb3Blbih1cmwsIHdpbmRvd05hbWUsIG9wdGlvbnMpIHtcbiAgICB0aGlzLnVybCA9IHVybDtcbiAgICB2YXIgb3B0aW9uc1N0cmluZyA9IGJ1aWxkUG9wdXBXaW5kb3dPcHRpb25zKG9wdGlvbnMgfHwge30pO1xuXG4gICAgdGhpcy5wb3B1cFdpbmRvdyA9IF9hdXJlbGlhUGFsLlBMQVRGT1JNLmdsb2JhbC5vcGVuKHVybCwgd2luZG93TmFtZSwgb3B0aW9uc1N0cmluZyk7XG5cbiAgICBpZiAodGhpcy5wb3B1cFdpbmRvdyAmJiB0aGlzLnBvcHVwV2luZG93LmZvY3VzKSB7XG4gICAgICB0aGlzLnBvcHVwV2luZG93LmZvY3VzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgUG9wdXAucHJvdG90eXBlLmV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiBldmVudExpc3RlbmVyKHJlZGlyZWN0VXJpKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBfdGhpcy5wb3B1cFdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LnVybC5pbmRleE9mKHJlZGlyZWN0VXJpKSAhPT0gMCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwYXJzZXIgPSBfYXVyZWxpYVBhbC5ET00uY3JlYXRlRWxlbWVudCgnYScpO1xuXG4gICAgICAgIHBhcnNlci5ocmVmID0gZXZlbnQudXJsO1xuXG4gICAgICAgIGlmIChwYXJzZXIuc2VhcmNoIHx8IHBhcnNlci5oYXNoKSB7XG4gICAgICAgICAgdmFyIHFzID0gcGFyc2VVcmwocGFyc2VyKTtcblxuICAgICAgICAgIGlmIChxcy5lcnJvcikge1xuICAgICAgICAgICAgcmVqZWN0KHsgZXJyb3I6IHFzLmVycm9yIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKHFzKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBfdGhpcy5wb3B1cFdpbmRvdy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgX3RoaXMucG9wdXBXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZXhpdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KHsgZGF0YTogJ1Byb3ZpZGVyIFBvcHVwIHdhcyBjbG9zZWQnIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIF90aGlzLnBvcHVwV2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlcnJvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVqZWN0KHsgZGF0YTogJ0F1dGhvcml6YXRpb24gRmFpbGVkJyB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIFBvcHVwLnByb3RvdHlwZS5wb2xsUG9wdXAgPSBmdW5jdGlvbiBwb2xsUG9wdXAoKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgX3RoaXMyLnBvbGxpbmcgPSBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZXJyb3JEYXRhID0gdm9pZCAwO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKF90aGlzMi5wb3B1cFdpbmRvdy5sb2NhdGlvbi5ob3N0ID09PSBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuZG9jdW1lbnQubG9jYXRpb24uaG9zdCAmJiAoX3RoaXMyLnBvcHVwV2luZG93LmxvY2F0aW9uLnNlYXJjaCB8fCBfdGhpczIucG9wdXBXaW5kb3cubG9jYXRpb24uaGFzaCkpIHtcbiAgICAgICAgICAgIHZhciBxcyA9IHBhcnNlVXJsKF90aGlzMi5wb3B1cFdpbmRvdy5sb2NhdGlvbik7XG5cbiAgICAgICAgICAgIGlmIChxcy5lcnJvcikge1xuICAgICAgICAgICAgICByZWplY3QoeyBlcnJvcjogcXMuZXJyb3IgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKHFzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX3RoaXMyLnBvcHVwV2luZG93LmNsb3NlKCk7XG4gICAgICAgICAgICBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuY2xlYXJJbnRlcnZhbChfdGhpczIucG9sbGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGVycm9yRGF0YSA9IGVycm9yO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFfdGhpczIucG9wdXBXaW5kb3cpIHtcbiAgICAgICAgICBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuY2xlYXJJbnRlcnZhbChfdGhpczIucG9sbGluZyk7XG4gICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgIGVycm9yOiBlcnJvckRhdGEsXG4gICAgICAgICAgICBkYXRhOiAnUHJvdmlkZXIgUG9wdXAgQmxvY2tlZCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChfdGhpczIucG9wdXBXaW5kb3cuY2xvc2VkKSB7XG4gICAgICAgICAgX2F1cmVsaWFQYWwuUExBVEZPUk0uZ2xvYmFsLmNsZWFySW50ZXJ2YWwoX3RoaXMyLnBvbGxpbmcpO1xuICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICBlcnJvcjogZXJyb3JEYXRhLFxuICAgICAgICAgICAgZGF0YTogJ1Byb2JsZW0gcG9sbCBwb3B1cCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSwgMzUpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBQb3B1cDtcbn0oKTtcblxudmFyIGJ1aWxkUG9wdXBXaW5kb3dPcHRpb25zID0gZnVuY3Rpb24gYnVpbGRQb3B1cFdpbmRvd09wdGlvbnMob3B0aW9ucykge1xuICB2YXIgd2lkdGggPSBvcHRpb25zLndpZHRoIHx8IDUwMDtcbiAgdmFyIGhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDUwMDtcblxuICB2YXIgZXh0ZW5kZWQgPSAoMCwgX2V4dGVuZDIuZGVmYXVsdCkoe1xuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICBsZWZ0OiBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuc2NyZWVuWCArIChfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwub3V0ZXJXaWR0aCAtIHdpZHRoKSAvIDIsXG4gICAgdG9wOiBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuc2NyZWVuWSArIChfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwub3V0ZXJIZWlnaHQgLSBoZWlnaHQpIC8gMi41XG4gIH0sIG9wdGlvbnMpO1xuXG4gIHZhciBwYXJ0cyA9IFtdO1xuXG4gIE9iamVjdC5rZXlzKGV4dGVuZGVkKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBwYXJ0cy5wdXNoKGtleSArICc9JyArIGV4dGVuZGVkW2tleV0pO1xuICB9KTtcblxuICByZXR1cm4gcGFydHMuam9pbignLCcpO1xufTtcblxudmFyIHBhcnNlVXJsID0gZnVuY3Rpb24gcGFyc2VVcmwodXJsKSB7XG4gIHZhciBoYXNoID0gdXJsLmhhc2guY2hhckF0KDApID09PSAnIycgPyB1cmwuaGFzaC5zdWJzdHIoMSkgOiB1cmwuaGFzaDtcblxuICByZXR1cm4gKDAsIF9leHRlbmQyLmRlZmF1bHQpKHRydWUsIHt9LCAoMCwgX2F1cmVsaWFQYXRoLnBhcnNlUXVlcnlTdHJpbmcpKHVybC5zZWFyY2gpLCAoMCwgX2F1cmVsaWFQYXRoLnBhcnNlUXVlcnlTdHJpbmcpKGhhc2gpKTtcbn07XG5cbnZhciBsb2dnZXIgPSBleHBvcnRzLmxvZ2dlciA9ICgwLCBfYXVyZWxpYUxvZ2dpbmcuZ2V0TG9nZ2VyKSgnYXVyZWxpYS1hdXRoZW50aWNhdGlvbicpO1xuXG52YXIgQmFzZUNvbmZpZyA9IGV4cG9ydHMuQmFzZUNvbmZpZyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQmFzZUNvbmZpZygpIHtcbiAgICBcblxuICAgIHRoaXMuY2xpZW50ID0gbnVsbDtcbiAgICB0aGlzLmVuZHBvaW50ID0gbnVsbDtcbiAgICB0aGlzLmNvbmZpZ3VyZUVuZHBvaW50cyA9IG51bGw7XG4gICAgdGhpcy5sb2dpblJlZGlyZWN0ID0gJyMvJztcbiAgICB0aGlzLmxvZ291dFJlZGlyZWN0ID0gJyMvJztcbiAgICB0aGlzLmxvZ2luUm91dGUgPSAnL2xvZ2luJztcbiAgICB0aGlzLmxvZ2luT25TaWdudXAgPSB0cnVlO1xuICAgIHRoaXMuc2lnbnVwUmVkaXJlY3QgPSAnIy9sb2dpbic7XG4gICAgdGhpcy5leHBpcmVkUmVkaXJlY3QgPSAnIy8nO1xuICAgIHRoaXMuc3RvcmFnZUNoYW5nZWRSZWRpcmVjdCA9ICcjLyc7XG4gICAgdGhpcy5iYXNlVXJsID0gJyc7XG4gICAgdGhpcy5sb2dpblVybCA9ICcvYXV0aC9sb2dpbic7XG4gICAgdGhpcy5sb2dvdXRVcmwgPSBudWxsO1xuICAgIHRoaXMubG9nb3V0TWV0aG9kID0gJ2dldCc7XG4gICAgdGhpcy5zaWdudXBVcmwgPSAnL2F1dGgvc2lnbnVwJztcbiAgICB0aGlzLnByb2ZpbGVVcmwgPSAnL2F1dGgvbWUnO1xuICAgIHRoaXMucHJvZmlsZU1ldGhvZCA9ICdwdXQnO1xuICAgIHRoaXMudW5saW5rVXJsID0gJy9hdXRoL3VubGluay8nO1xuICAgIHRoaXMudW5saW5rTWV0aG9kID0gJ2dldCc7XG4gICAgdGhpcy5yZWZyZXNoVG9rZW5VcmwgPSBudWxsO1xuICAgIHRoaXMuYXV0aEhlYWRlciA9ICdBdXRob3JpemF0aW9uJztcbiAgICB0aGlzLmF1dGhUb2tlblR5cGUgPSAnQmVhcmVyJztcbiAgICB0aGlzLmxvZ291dE9uSW52YWxpZFRva2VuID0gZmFsc2U7XG4gICAgdGhpcy5hY2Nlc3NUb2tlblByb3AgPSAnYWNjZXNzX3Rva2VuJztcbiAgICB0aGlzLmFjY2Vzc1Rva2VuTmFtZSA9ICd0b2tlbic7XG4gICAgdGhpcy5hY2Nlc3NUb2tlblJvb3QgPSBmYWxzZTtcbiAgICB0aGlzLnVzZVJlZnJlc2hUb2tlbiA9IGZhbHNlO1xuICAgIHRoaXMuYXV0b1VwZGF0ZVRva2VuID0gdHJ1ZTtcbiAgICB0aGlzLmNsaWVudElkID0gZmFsc2U7XG4gICAgdGhpcy5jbGllbnRTZWNyZXQgPSBudWxsO1xuICAgIHRoaXMucmVmcmVzaFRva2VuUHJvcCA9ICdyZWZyZXNoX3Rva2VuJztcbiAgICB0aGlzLnJlZnJlc2hUb2tlblN1Ym1pdFByb3AgPSAncmVmcmVzaF90b2tlbic7XG4gICAgdGhpcy5rZWVwT2xkUmVzcG9uc2VQcm9wZXJ0aWVzID0gZmFsc2U7XG4gICAgdGhpcy5yZWZyZXNoVG9rZW5OYW1lID0gJ3Rva2VuJztcbiAgICB0aGlzLnJlZnJlc2hUb2tlblJvb3QgPSBmYWxzZTtcbiAgICB0aGlzLmlkVG9rZW5Qcm9wID0gJ2lkX3Rva2VuJztcbiAgICB0aGlzLmlkVG9rZW5OYW1lID0gJ3Rva2VuJztcbiAgICB0aGlzLmlkVG9rZW5Sb290ID0gZmFsc2U7XG4gICAgdGhpcy5odHRwSW50ZXJjZXB0b3IgPSB0cnVlO1xuICAgIHRoaXMud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTtcbiAgICB0aGlzLnBsYXRmb3JtID0gJ2Jyb3dzZXInO1xuICAgIHRoaXMuc3RvcmFnZSA9ICdsb2NhbFN0b3JhZ2UnO1xuICAgIHRoaXMuc3RvcmFnZUtleSA9ICdhdXJlbGlhX2F1dGhlbnRpY2F0aW9uJztcbiAgICB0aGlzLnN0b3JhZ2VDaGFuZ2VkUmVsb2FkID0gZmFsc2U7XG4gICAgdGhpcy5nZXRFeHBpcmF0aW9uRGF0ZUZyb21SZXNwb25zZSA9IG51bGw7XG4gICAgdGhpcy5nZXRBY2Nlc3NUb2tlbkZyb21SZXNwb25zZSA9IG51bGw7XG4gICAgdGhpcy5nZXRSZWZyZXNoVG9rZW5Gcm9tUmVzcG9uc2UgPSBudWxsO1xuICAgIHRoaXMuZ2xvYmFsVmFsdWVDb252ZXJ0ZXJzID0gWydhdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXInXTtcbiAgICB0aGlzLmRlZmF1bHRIZWFkZXJzRm9yVG9rZW5SZXF1ZXN0cyA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICB9O1xuICAgIHRoaXMucHJvdmlkZXJzID0ge1xuICAgICAgZmFjZWJvb2s6IHtcbiAgICAgICAgbmFtZTogJ2ZhY2Vib29rJyxcbiAgICAgICAgdXJsOiAnL2F1dGgvZmFjZWJvb2snLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vdjIuNS9kaWFsb2cvb2F1dGgnLFxuICAgICAgICByZWRpcmVjdFVyaTogX2F1cmVsaWFQYWwuUExBVEZPUk0ubG9jYXRpb24ub3JpZ2luICsgJy8nLFxuICAgICAgICByZXF1aXJlZFVybFBhcmFtczogWydkaXNwbGF5JywgJ3Njb3BlJ10sXG4gICAgICAgIHNjb3BlOiBbJ2VtYWlsJ10sXG4gICAgICAgIHNjb3BlRGVsaW1pdGVyOiAnLCcsXG4gICAgICAgIGRpc3BsYXk6ICdwb3B1cCcsXG4gICAgICAgIG9hdXRoVHlwZTogJzIuMCcsXG4gICAgICAgIHBvcHVwT3B0aW9uczogeyB3aWR0aDogNTgwLCBoZWlnaHQ6IDQwMCB9XG4gICAgICB9LFxuICAgICAgZ29vZ2xlOiB7XG4gICAgICAgIG5hbWU6ICdnb29nbGUnLFxuICAgICAgICB1cmw6ICcvYXV0aC9nb29nbGUnLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCcsXG4gICAgICAgIHJlZGlyZWN0VXJpOiBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBbJ3Njb3BlJ10sXG4gICAgICAgIG9wdGlvbmFsVXJsUGFyYW1zOiBbJ2Rpc3BsYXknLCAnc3RhdGUnXSxcbiAgICAgICAgc2NvcGU6IFsncHJvZmlsZScsICdlbWFpbCddLFxuICAgICAgICBzY29wZVByZWZpeDogJ29wZW5pZCcsXG4gICAgICAgIHNjb3BlRGVsaW1pdGVyOiAnICcsXG4gICAgICAgIGRpc3BsYXk6ICdwb3B1cCcsXG4gICAgICAgIG9hdXRoVHlwZTogJzIuMCcsXG4gICAgICAgIHBvcHVwT3B0aW9uczogeyB3aWR0aDogNDUyLCBoZWlnaHQ6IDYzMyB9LFxuICAgICAgICBzdGF0ZTogcmFuZG9tU3RhdGVcbiAgICAgIH0sXG4gICAgICBnaXRodWI6IHtcbiAgICAgICAgbmFtZTogJ2dpdGh1YicsXG4gICAgICAgIHVybDogJy9hdXRoL2dpdGh1YicsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9sb2dpbi9vYXV0aC9hdXRob3JpemUnLFxuICAgICAgICByZWRpcmVjdFVyaTogX2F1cmVsaWFQYWwuUExBVEZPUk0ubG9jYXRpb24ub3JpZ2luLFxuICAgICAgICBvcHRpb25hbFVybFBhcmFtczogWydzY29wZSddLFxuICAgICAgICBzY29wZTogWyd1c2VyOmVtYWlsJ10sXG4gICAgICAgIHNjb3BlRGVsaW1pdGVyOiAnICcsXG4gICAgICAgIG9hdXRoVHlwZTogJzIuMCcsXG4gICAgICAgIHBvcHVwT3B0aW9uczogeyB3aWR0aDogMTAyMCwgaGVpZ2h0OiA2MTggfVxuICAgICAgfSxcbiAgICAgIGluc3RhZ3JhbToge1xuICAgICAgICBuYW1lOiAnaW5zdGFncmFtJyxcbiAgICAgICAgdXJsOiAnL2F1dGgvaW5zdGFncmFtJyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiAnaHR0cHM6Ly9hcGkuaW5zdGFncmFtLmNvbS9vYXV0aC9hdXRob3JpemUnLFxuICAgICAgICByZWRpcmVjdFVyaTogX2F1cmVsaWFQYWwuUExBVEZPUk0ubG9jYXRpb24ub3JpZ2luLFxuICAgICAgICByZXF1aXJlZFVybFBhcmFtczogWydzY29wZSddLFxuICAgICAgICBzY29wZTogWydiYXNpYyddLFxuICAgICAgICBzY29wZURlbGltaXRlcjogJysnLFxuICAgICAgICBvYXV0aFR5cGU6ICcyLjAnXG4gICAgICB9LFxuICAgICAgbGlua2VkaW46IHtcbiAgICAgICAgbmFtZTogJ2xpbmtlZGluJyxcbiAgICAgICAgdXJsOiAnL2F1dGgvbGlua2VkaW4nLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL3d3dy5saW5rZWRpbi5jb20vdWFzL29hdXRoMi9hdXRob3JpemF0aW9uJyxcbiAgICAgICAgcmVkaXJlY3RVcmk6IF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLm9yaWdpbixcbiAgICAgICAgcmVxdWlyZWRVcmxQYXJhbXM6IFsnc3RhdGUnXSxcbiAgICAgICAgc2NvcGU6IFsncl9lbWFpbGFkZHJlc3MnXSxcbiAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcgJyxcbiAgICAgICAgc3RhdGU6ICdTVEFURScsXG4gICAgICAgIG9hdXRoVHlwZTogJzIuMCcsXG4gICAgICAgIHBvcHVwT3B0aW9uczogeyB3aWR0aDogNTI3LCBoZWlnaHQ6IDU4MiB9XG4gICAgICB9LFxuICAgICAgdHdpdHRlcjoge1xuICAgICAgICBuYW1lOiAndHdpdHRlcicsXG4gICAgICAgIHVybDogJy9hdXRoL3R3aXR0ZXInLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2FwaS50d2l0dGVyLmNvbS9vYXV0aC9hdXRoZW50aWNhdGUnLFxuICAgICAgICByZWRpcmVjdFVyaTogX2F1cmVsaWFQYWwuUExBVEZPUk0ubG9jYXRpb24ub3JpZ2luLFxuICAgICAgICBvYXV0aFR5cGU6ICcxLjAnLFxuICAgICAgICBwb3B1cE9wdGlvbnM6IHsgd2lkdGg6IDQ5NSwgaGVpZ2h0OiA2NDUgfVxuICAgICAgfSxcbiAgICAgIHR3aXRjaDoge1xuICAgICAgICBuYW1lOiAndHdpdGNoJyxcbiAgICAgICAgdXJsOiAnL2F1dGgvdHdpdGNoJyxcbiAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiAnaHR0cHM6Ly9hcGkudHdpdGNoLnR2L2tyYWtlbi9vYXV0aDIvYXV0aG9yaXplJyxcbiAgICAgICAgcmVkaXJlY3RVcmk6IF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLm9yaWdpbixcbiAgICAgICAgcmVxdWlyZWRVcmxQYXJhbXM6IFsnc2NvcGUnXSxcbiAgICAgICAgc2NvcGU6IFsndXNlcl9yZWFkJ10sXG4gICAgICAgIHNjb3BlRGVsaW1pdGVyOiAnICcsXG4gICAgICAgIGRpc3BsYXk6ICdwb3B1cCcsXG4gICAgICAgIG9hdXRoVHlwZTogJzIuMCcsXG4gICAgICAgIHBvcHVwT3B0aW9uczogeyB3aWR0aDogNTAwLCBoZWlnaHQ6IDU2MCB9XG4gICAgICB9LFxuICAgICAgbGl2ZToge1xuICAgICAgICBuYW1lOiAnbGl2ZScsXG4gICAgICAgIHVybDogJy9hdXRoL2xpdmUnLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2xvZ2luLmxpdmUuY29tL29hdXRoMjBfYXV0aG9yaXplLnNyZicsXG4gICAgICAgIHJlZGlyZWN0VXJpOiBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBbJ2Rpc3BsYXknLCAnc2NvcGUnXSxcbiAgICAgICAgc2NvcGU6IFsnd2wuZW1haWxzJ10sXG4gICAgICAgIHNjb3BlRGVsaW1pdGVyOiAnICcsXG4gICAgICAgIGRpc3BsYXk6ICdwb3B1cCcsXG4gICAgICAgIG9hdXRoVHlwZTogJzIuMCcsXG4gICAgICAgIHBvcHVwT3B0aW9uczogeyB3aWR0aDogNTAwLCBoZWlnaHQ6IDU2MCB9XG4gICAgICB9LFxuICAgICAgeWFob286IHtcbiAgICAgICAgbmFtZTogJ3lhaG9vJyxcbiAgICAgICAgdXJsOiAnL2F1dGgveWFob28nLFxuICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQ6ICdodHRwczovL2FwaS5sb2dpbi55YWhvby5jb20vb2F1dGgyL3JlcXVlc3RfYXV0aCcsXG4gICAgICAgIHJlZGlyZWN0VXJpOiBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgIHNjb3BlOiBbXSxcbiAgICAgICAgc2NvcGVEZWxpbWl0ZXI6ICcsJyxcbiAgICAgICAgb2F1dGhUeXBlOiAnMi4wJyxcbiAgICAgICAgcG9wdXBPcHRpb25zOiB7IHdpZHRoOiA1NTksIGhlaWdodDogNTE5IH1cbiAgICAgIH0sXG4gICAgICBiaXRidWNrZXQ6IHtcbiAgICAgICAgbmFtZTogJ2JpdGJ1Y2tldCcsXG4gICAgICAgIHVybDogJy9hdXRoL2JpdGJ1Y2tldCcsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogJ2h0dHBzOi8vYml0YnVja2V0Lm9yZy9zaXRlL29hdXRoMi9hdXRob3JpemUnLFxuICAgICAgICByZWRpcmVjdFVyaTogX2F1cmVsaWFQYWwuUExBVEZPUk0ubG9jYXRpb24ub3JpZ2luICsgJy8nLFxuICAgICAgICByZXF1aXJlZFVybFBhcmFtczogWydzY29wZSddLFxuICAgICAgICBzY29wZTogWydlbWFpbCddLFxuICAgICAgICBzY29wZURlbGltaXRlcjogJyAnLFxuICAgICAgICBvYXV0aFR5cGU6ICcyLjAnLFxuICAgICAgICBwb3B1cE9wdGlvbnM6IHsgd2lkdGg6IDEwMjgsIGhlaWdodDogNTI5IH1cbiAgICAgIH0sXG4gICAgICBhenVyZV9hZDoge1xuICAgICAgICBuYW1lOiAnYXp1cmVfYWQnLFxuICAgICAgICB1cmw6ICcvYXV0aC9henVyZV9hZCcsXG4gICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogJ2h0dHBzOi8vbG9naW4ubWljcm9zb2Z0b25saW5lLmNvbS9jb21tb24vb2F1dGgyL3YyLjAvYXV0aG9yaXplJyxcbiAgICAgICAgcmVkaXJlY3RVcmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgIGxvZ291dEVuZHBvaW50OiAnaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tL2NvbW1vbi9vYXV0aDIvdjIuMC9sb2dvdXQnLFxuICAgICAgICBwb3N0TG9nb3V0UmVkaXJlY3RVcmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4sXG4gICAgICAgIHJlcXVpcmVkVXJsUGFyYW1zOiBbJ3Njb3BlJ10sXG4gICAgICAgIHNjb3BlOiBbJ3VzZXIucmVhZCddLFxuICAgICAgICBzY29wZURlbGltaXRlcjogJyAnLFxuICAgICAgICBvYXV0aFR5cGU6ICcyLjAnXG4gICAgICB9LFxuICAgICAgYXV0aDA6IHtcbiAgICAgICAgbmFtZTogJ2F1dGgwJyxcbiAgICAgICAgb2F1dGhUeXBlOiAnYXV0aDAtbG9jaycsXG4gICAgICAgIGNsaWVudElkOiAneW91cl9jbGllbnRfaWQnLFxuICAgICAgICBjbGllbnREb21haW46ICd5b3VyX2RvbWFpbl91cmwnLFxuICAgICAgICBkaXNwbGF5OiAncG9wdXAnLFxuICAgICAgICBsb2NrT3B0aW9uczoge30sXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ3Rva2VuJyxcbiAgICAgICAgc3RhdGU6IHJhbmRvbVN0YXRlXG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLl9hdXRoVG9rZW4gPSAnQmVhcmVyJztcbiAgICB0aGlzLl9yZXNwb25zZVRva2VuUHJvcCA9ICdhY2Nlc3NfdG9rZW4nO1xuICAgIHRoaXMuX3Rva2VuTmFtZSA9ICd0b2tlbic7XG4gICAgdGhpcy5fdG9rZW5Sb290ID0gZmFsc2U7XG4gICAgdGhpcy5fdG9rZW5QcmVmaXggPSAnYXVyZWxpYSc7XG4gICAgdGhpcy5fbG9nb3V0T25JbnZhbGlkdG9rZW4gPSBmYWxzZTtcbiAgfVxuXG4gIEJhc2VDb25maWcucHJvdG90eXBlLmpvaW5CYXNlID0gZnVuY3Rpb24gam9pbkJhc2UodXJsKSB7XG4gICAgcmV0dXJuICgwLCBfYXVyZWxpYVBhdGguam9pbikodGhpcy5iYXNlVXJsLCB1cmwpO1xuICB9O1xuXG4gIEJhc2VDb25maWcucHJvdG90eXBlLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uIGNvbmZpZ3VyZShpbmNvbWluZykge1xuICAgIGZvciAodmFyIGtleSBpbiBpbmNvbWluZykge1xuICAgICAgaWYgKGluY29taW5nLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gaW5jb21pbmdba2V5XTtcblxuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih2YWx1ZSkpICE9PSAnb2JqZWN0JyB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpc1trZXldID0gdmFsdWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICgwLCBfZXh0ZW5kMi5kZWZhdWx0KSh0cnVlLCB0aGlzW2tleV0sIHZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgQmFzZUNvbmZpZy5wcm90b3R5cGUuZ2V0T3B0aW9uc0ZvclRva2VuUmVxdWVzdHMgPSBmdW5jdGlvbiBnZXRPcHRpb25zRm9yVG9rZW5SZXF1ZXN0cygpIHtcbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG5cbiAgICByZXR1cm4gKDAsIF9leHRlbmQyLmRlZmF1bHQpKHRydWUsIHt9LCB7IGhlYWRlcnM6IHRoaXMuZGVmYXVsdEhlYWRlcnNGb3JUb2tlblJlcXVlc3RzIH0sIG9wdGlvbnMpO1xuICB9O1xuXG4gIF9jcmVhdGVDbGFzcyhCYXNlQ29uZmlnLCBbe1xuICAgIGtleTogJ2F1dGhUb2tlbicsXG4gICAgc2V0OiBmdW5jdGlvbiBzZXQoYXV0aFRva2VuKSB7XG4gICAgICBsb2dnZXIud2FybignQmFzZUNvbmZpZy5hdXRoVG9rZW4gaXMgZGVwcmVjYXRlZC4gVXNlIEJhc2VDb25maWcuYXV0aFRva2VuVHlwZSBpbnN0ZWFkLicpO1xuICAgICAgdGhpcy5fYXV0aFRva2VuVHlwZSA9IGF1dGhUb2tlbjtcbiAgICAgIHRoaXMuYXV0aFRva2VuVHlwZSA9IGF1dGhUb2tlbjtcblxuICAgICAgcmV0dXJuIGF1dGhUb2tlbjtcbiAgICB9LFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2F1dGhUb2tlblR5cGU7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAncmVzcG9uc2VUb2tlblByb3AnLFxuICAgIHNldDogZnVuY3Rpb24gc2V0KHJlc3BvbnNlVG9rZW5Qcm9wKSB7XG4gICAgICBsb2dnZXIud2FybignQmFzZUNvbmZpZy5yZXNwb25zZVRva2VuUHJvcCBpcyBkZXByZWNhdGVkLiBVc2UgQmFzZUNvbmZpZy5hY2Nlc3NUb2tlblByb3AgaW5zdGVhZC4nKTtcbiAgICAgIHRoaXMuX3Jlc3BvbnNlVG9rZW5Qcm9wID0gcmVzcG9uc2VUb2tlblByb3A7XG4gICAgICB0aGlzLmFjY2Vzc1Rva2VuUHJvcCA9IHJlc3BvbnNlVG9rZW5Qcm9wO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2VUb2tlblByb3A7XG4gICAgfSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9yZXNwb25zZVRva2VuUHJvcDtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICd0b2tlblJvb3QnLFxuICAgIHNldDogZnVuY3Rpb24gc2V0KHRva2VuUm9vdCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Jhc2VDb25maWcudG9rZW5Sb290IGlzIGRlcHJlY2F0ZWQuIFVzZSBCYXNlQ29uZmlnLmFjY2Vzc1Rva2VuUm9vdCBpbnN0ZWFkLicpO1xuICAgICAgdGhpcy5fdG9rZW5Sb290ID0gdG9rZW5Sb290O1xuICAgICAgdGhpcy5hY2Nlc3NUb2tlblJvb3QgPSB0b2tlblJvb3Q7XG5cbiAgICAgIHJldHVybiB0b2tlblJvb3Q7XG4gICAgfSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLl90b2tlblJvb3Q7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAndG9rZW5OYW1lJyxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh0b2tlbk5hbWUpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdCYXNlQ29uZmlnLnRva2VuTmFtZSBpcyBkZXByZWNhdGVkLiBVc2UgQmFzZUNvbmZpZy5hY2Nlc3NUb2tlbk5hbWUgaW5zdGVhZC4nKTtcbiAgICAgIHRoaXMuX3Rva2VuTmFtZSA9IHRva2VuTmFtZTtcbiAgICAgIHRoaXMuYWNjZXNzVG9rZW5OYW1lID0gdG9rZW5OYW1lO1xuXG4gICAgICByZXR1cm4gdG9rZW5OYW1lO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdG9rZW5OYW1lO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3Rva2VuUHJlZml4JyxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh0b2tlblByZWZpeCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Jhc2VDb25maWcudG9rZW5QcmVmaXggaXMgb2Jzb2xldGUuIFVzZSBCYXNlQ29uZmlnLnN0b3JhZ2VLZXkgaW5zdGVhZC4nKTtcbiAgICAgIHRoaXMuX3Rva2VuUHJlZml4ID0gdG9rZW5QcmVmaXg7XG5cbiAgICAgIHJldHVybiB0b2tlblByZWZpeDtcbiAgICB9LFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Rva2VuUHJlZml4IHx8ICdhdXJlbGlhJztcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdjdXJyZW50JyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdHZXR0ZXIgQmFzZUNvbmZpZy5jdXJyZW50IGlzIGRlcHJlY2F0ZWQuIFVzZSBCYXNlQ29uZmlnIGRpcmVjdGx5IGluc3RlYWQuJyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiBzZXQoXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTZXR0ZXIgQmFzZUNvbmZpZy5jdXJyZW50IGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBCYXNlQ29uZmlnIGRpcmVjdGx5IGluc3RlYWQuJyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnX2N1cnJlbnQnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ0dldHRlciBCYXNlQ29uZmlnLl9jdXJyZW50IGlzIGRlcHJlY2F0ZWQuIFVzZSBCYXNlQ29uZmlnIGRpcmVjdGx5IGluc3RlYWQuJyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiBzZXQoXykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdTZXR0ZXIgQmFzZUNvbmZpZy5fY3VycmVudCBoYXMgYmVlbiByZW1vdmVkLiBVc2UgQmFzZUNvbmZpZyBkaXJlY3RseSBpbnN0ZWFkLicpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2xvZ291dE9uSW52YWxpZHRva2VuJyxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldChsb2dvdXRPbkludmFsaWR0b2tlbikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Jhc2VDb25maWcubG9nb3V0T25JbnZhbGlkdG9rZW4gaXMgb2Jzb2xldGUuIFVzZSBCYXNlQ29uZmlnLmxvZ291dE9uSW52YWxpZFRva2VuIGluc3RlYWQuJyk7XG4gICAgICB0aGlzLl9sb2dvdXRPbkludmFsaWR0b2tlbiA9IGxvZ291dE9uSW52YWxpZHRva2VuO1xuICAgICAgdGhpcy5sb2dvdXRPbkludmFsaWRUb2tlbiA9IGxvZ291dE9uSW52YWxpZHRva2VuO1xuXG4gICAgICByZXR1cm4gbG9nb3V0T25JbnZhbGlkdG9rZW47XG4gICAgfSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9sb2dvdXRPbkludmFsaWR0b2tlbjtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQmFzZUNvbmZpZztcbn0oKTtcblxuZnVuY3Rpb24gcmFuZG9tU3RhdGUoKSB7XG4gIHZhciByYW5kID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpO1xuXG4gIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQocmFuZCk7XG59XG5cbnZhciBTdG9yYWdlID0gZXhwb3J0cy5TdG9yYWdlID0gKF9kZWMgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoQmFzZUNvbmZpZyksIF9kZWMoX2NsYXNzMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gU3RvcmFnZShjb25maWcpIHtcbiAgICBcblxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgU3RvcmFnZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgIHJldHVybiBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWxbdGhpcy5jb25maWcuc3RvcmFnZV0uZ2V0SXRlbShrZXkpO1xuICB9O1xuXG4gIFN0b3JhZ2UucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7XG4gICAgX2F1cmVsaWFQYWwuUExBVEZPUk0uZ2xvYmFsW3RoaXMuY29uZmlnLnN0b3JhZ2VdLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XG4gIH07XG5cbiAgU3RvcmFnZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gcmVtb3ZlKGtleSkge1xuICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmdsb2JhbFt0aGlzLmNvbmZpZy5zdG9yYWdlXS5yZW1vdmVJdGVtKGtleSk7XG4gIH07XG5cbiAgcmV0dXJuIFN0b3JhZ2U7XG59KCkpIHx8IF9jbGFzczIpO1xudmFyIEF1dGhMb2NrID0gZXhwb3J0cy5BdXRoTG9jayA9IChfZGVjMiA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShTdG9yYWdlLCBCYXNlQ29uZmlnKSwgX2RlYzIoX2NsYXNzMyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQXV0aExvY2soc3RvcmFnZSwgY29uZmlnKSB7XG4gICAgXG5cbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuZGVmYXVsdHMgPSB7XG4gICAgICBuYW1lOiBudWxsLFxuICAgICAgc3RhdGU6IG51bGwsXG4gICAgICBzY29wZTogbnVsbCxcbiAgICAgIHNjb3BlRGVsaW1pdGVyOiAnICcsXG4gICAgICByZWRpcmVjdFVyaTogbnVsbCxcbiAgICAgIGNsaWVudElkOiBudWxsLFxuICAgICAgY2xpZW50RG9tYWluOiBudWxsLFxuICAgICAgZGlzcGxheTogJ3BvcHVwJyxcbiAgICAgIGxvY2tPcHRpb25zOiB7fSxcbiAgICAgIHBvcHVwT3B0aW9uczogbnVsbCxcbiAgICAgIHJlc3BvbnNlVHlwZTogJ3Rva2VuJ1xuICAgIH07XG4gIH1cblxuICBBdXRoTG9jay5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIG9wZW4ob3B0aW9ucywgdXNlckRhdGEpIHtcbiAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgIGlmICh0eXBlb2YgX2F1cmVsaWFQYWwuUExBVEZPUk0uZ2xvYmFsLkF1dGgwTG9jayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoMExvY2sgd2FzIG5vdCBmb3VuZCBpbiBnbG9iYWwgc2NvcGUuIFBsZWFzZSBsb2FkIGl0IGJlZm9yZSB1c2luZyB0aGlzIHByb3ZpZGVyLicpO1xuICAgIH1cbiAgICB2YXIgcHJvdmlkZXIgPSAoMCwgX2V4dGVuZDIuZGVmYXVsdCkodHJ1ZSwge30sIHRoaXMuZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgIHZhciBzdGF0ZU5hbWUgPSBwcm92aWRlci5uYW1lICsgJ19zdGF0ZSc7XG5cbiAgICBpZiAodHlwZW9mIHByb3ZpZGVyLnN0YXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHN0YXRlTmFtZSwgcHJvdmlkZXIuc3RhdGUoKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcHJvdmlkZXIuc3RhdGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHN0YXRlTmFtZSwgcHJvdmlkZXIuc3RhdGUpO1xuICAgIH1cblxuICAgIHZhciBvcHRzID0ge1xuICAgICAgYXV0aDoge1xuICAgICAgICBwYXJhbXM6IHt9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KHByb3ZpZGVyLnNjb3BlKSAmJiBwcm92aWRlci5zY29wZS5sZW5ndGgpIHtcbiAgICAgIG9wdHMuYXV0aC5wYXJhbXMuc2NvcGUgPSBwcm92aWRlci5zY29wZS5qb2luKHByb3ZpZGVyLnNjb3BlRGVsaW1pdGVyKTtcbiAgICB9XG4gICAgaWYgKHByb3ZpZGVyLnN0YXRlKSB7XG4gICAgICBvcHRzLmF1dGgucGFyYW1zLnN0YXRlID0gdGhpcy5zdG9yYWdlLmdldChwcm92aWRlci5uYW1lICsgJ19zdGF0ZScpO1xuICAgIH1cbiAgICBpZiAocHJvdmlkZXIuZGlzcGxheSA9PT0gJ3BvcHVwJykge1xuICAgICAgb3B0cy5hdXRoLnJlZGlyZWN0ID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcHJvdmlkZXIucmVkaXJlY3RVcmkgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRzLmF1dGgucmVkaXJlY3QgPSB0cnVlO1xuICAgICAgb3B0cy5hdXRoLnJlZGlyZWN0VXJsID0gcHJvdmlkZXIucmVkaXJlY3RVcmk7XG4gICAgfVxuICAgIGlmIChfdHlwZW9mKHByb3ZpZGVyLnBvcHVwT3B0aW9ucykgPT09ICdvYmplY3QnKSB7XG4gICAgICBvcHRzLnBvcHVwT3B0aW9ucyA9IHByb3ZpZGVyLnBvcHVwT3B0aW9ucztcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwcm92aWRlci5yZXNwb25zZVR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRzLmF1dGgucmVzcG9uc2VUeXBlID0gcHJvdmlkZXIucmVzcG9uc2VUeXBlO1xuICAgIH1cbiAgICB2YXIgbG9ja09wdGlvbnMgPSAoMCwgX2V4dGVuZDIuZGVmYXVsdCkodHJ1ZSwge30sIHByb3ZpZGVyLmxvY2tPcHRpb25zLCBvcHRzKTtcblxuICAgIHRoaXMubG9jayA9IHRoaXMubG9jayB8fCBuZXcgX2F1cmVsaWFQYWwuUExBVEZPUk0uZ2xvYmFsLkF1dGgwTG9jayhwcm92aWRlci5jbGllbnRJZCwgcHJvdmlkZXIuY2xpZW50RG9tYWluLCBsb2NrT3B0aW9ucyk7XG5cbiAgICB2YXIgb3BlblBvcHVwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgX3RoaXMzLmxvY2sub24oJ2F1dGhlbnRpY2F0ZWQnLCBmdW5jdGlvbiAoYXV0aFJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghbG9ja09wdGlvbnMuYXV0aC5yZWRpcmVjdCkge1xuICAgICAgICAgIF90aGlzMy5sb2NrLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICBhY2Nlc3NfdG9rZW46IGF1dGhSZXNwb25zZS5hY2Nlc3NUb2tlbixcbiAgICAgICAgICBpZF90b2tlbjogYXV0aFJlc3BvbnNlLmlkVG9rZW5cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIF90aGlzMy5sb2NrLm9uKCd1bnJlY292ZXJhYmxlX2Vycm9yJywgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBpZiAoIWxvY2tPcHRpb25zLmF1dGgucmVkaXJlY3QpIHtcbiAgICAgICAgICBfdGhpczMubG9jay5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9KTtcbiAgICAgIF90aGlzMy5sb2NrLnNob3coKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBvcGVuUG9wdXAudGhlbihmdW5jdGlvbiAobG9ja1Jlc3BvbnNlKSB7XG4gICAgICBpZiAocHJvdmlkZXIucmVzcG9uc2VUeXBlID09PSAndG9rZW4nIHx8IHByb3ZpZGVyLnJlc3BvbnNlVHlwZSA9PT0gJ2lkX3Rva2VuJTIwdG9rZW4nIHx8IHByb3ZpZGVyLnJlc3BvbnNlVHlwZSA9PT0gJ3Rva2VuJTIwaWRfdG9rZW4nIHx8IHByb3ZpZGVyLnJlc3BvbnNlVHlwZSA9PT0gJ3Rva2VuIGlkX3Rva2VuJykge1xuICAgICAgICByZXR1cm4gbG9ja1Jlc3BvbnNlO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgYHRva2VuYCByZXNwb25zZVR5cGUgaXMgc3VwcG9ydGVkJyk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIEF1dGhMb2NrO1xufSgpKSB8fCBfY2xhc3MzKTtcbnZhciBPQXV0aDEgPSBleHBvcnRzLk9BdXRoMSA9IChfZGVjMyA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShTdG9yYWdlLCBQb3B1cCwgQmFzZUNvbmZpZyksIF9kZWMzKF9jbGFzczQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9BdXRoMShzdG9yYWdlLCBwb3B1cCwgY29uZmlnKSB7XG4gICAgXG5cbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMucG9wdXAgPSBwb3B1cDtcbiAgICB0aGlzLmRlZmF1bHRzID0ge1xuICAgICAgdXJsOiBudWxsLFxuICAgICAgbmFtZTogbnVsbCxcbiAgICAgIHBvcHVwT3B0aW9uczogbnVsbCxcbiAgICAgIHJlZGlyZWN0VXJpOiBudWxsLFxuICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50OiBudWxsXG4gICAgfTtcbiAgfVxuXG4gIE9BdXRoMS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIG9wZW4ob3B0aW9ucywgdXNlckRhdGEpIHtcbiAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgIHZhciBwcm92aWRlciA9ICgwLCBfZXh0ZW5kMi5kZWZhdWx0KSh0cnVlLCB7fSwgdGhpcy5kZWZhdWx0cywgb3B0aW9ucyk7XG4gICAgdmFyIHNlcnZlclVybCA9IHRoaXMuY29uZmlnLmpvaW5CYXNlKHByb3ZpZGVyLnVybCk7XG5cbiAgICBpZiAodGhpcy5jb25maWcucGxhdGZvcm0gIT09ICdtb2JpbGUnKSB7XG4gICAgICB0aGlzLnBvcHVwID0gdGhpcy5wb3B1cC5vcGVuKCcnLCBwcm92aWRlci5uYW1lLCBwcm92aWRlci5wb3B1cE9wdGlvbnMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNvbmZpZy5jbGllbnQucG9zdChzZXJ2ZXJVcmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICB2YXIgdXJsID0gcHJvdmlkZXIuYXV0aG9yaXphdGlvbkVuZHBvaW50ICsgJz8nICsgKDAsIF9hdXJlbGlhUGF0aC5idWlsZFF1ZXJ5U3RyaW5nKShyZXNwb25zZSk7XG5cbiAgICAgIGlmIChfdGhpczQuY29uZmlnLnBsYXRmb3JtID09PSAnbW9iaWxlJykge1xuICAgICAgICBfdGhpczQucG9wdXAgPSBfdGhpczQucG9wdXAub3Blbih1cmwsIHByb3ZpZGVyLm5hbWUsIHByb3ZpZGVyLnBvcHVwT3B0aW9ucyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfdGhpczQucG9wdXAucG9wdXBXaW5kb3cubG9jYXRpb24gPSB1cmw7XG4gICAgICB9XG5cbiAgICAgIHZhciBwb3B1cExpc3RlbmVyID0gX3RoaXM0LmNvbmZpZy5wbGF0Zm9ybSA9PT0gJ21vYmlsZScgPyBfdGhpczQucG9wdXAuZXZlbnRMaXN0ZW5lcihwcm92aWRlci5yZWRpcmVjdFVyaSkgOiBfdGhpczQucG9wdXAucG9sbFBvcHVwKCk7XG5cbiAgICAgIHJldHVybiBwb3B1cExpc3RlbmVyLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICByZXR1cm4gX3RoaXM0LmV4Y2hhbmdlRm9yVG9rZW4ocmVzdWx0LCB1c2VyRGF0YSwgcHJvdmlkZXIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgT0F1dGgxLnByb3RvdHlwZS5leGNoYW5nZUZvclRva2VuID0gZnVuY3Rpb24gZXhjaGFuZ2VGb3JUb2tlbihvYXV0aERhdGEsIHVzZXJEYXRhLCBwcm92aWRlcikge1xuICAgIHZhciBkYXRhID0gKDAsIF9leHRlbmQyLmRlZmF1bHQpKHRydWUsIHt9LCB1c2VyRGF0YSwgb2F1dGhEYXRhKTtcbiAgICB2YXIgc2VydmVyVXJsID0gdGhpcy5jb25maWcuam9pbkJhc2UocHJvdmlkZXIudXJsKTtcbiAgICB2YXIgY3JlZGVudGlhbHMgPSB0aGlzLmNvbmZpZy53aXRoQ3JlZGVudGlhbHMgPyAnaW5jbHVkZScgOiAnc2FtZS1vcmlnaW4nO1xuXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmNsaWVudC5wb3N0KHNlcnZlclVybCwgZGF0YSwgeyBjcmVkZW50aWFsczogY3JlZGVudGlhbHMgfSk7XG4gIH07XG5cbiAgcmV0dXJuIE9BdXRoMTtcbn0oKSkgfHwgX2NsYXNzNCk7XG52YXIgT0F1dGgyID0gZXhwb3J0cy5PQXV0aDIgPSAoX2RlYzQgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoU3RvcmFnZSwgUG9wdXAsIEJhc2VDb25maWcpLCBfZGVjNChfY2xhc3M1ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBPQXV0aDIoc3RvcmFnZSwgcG9wdXAsIGNvbmZpZykge1xuICAgIFxuXG4gICAgdGhpcy5zdG9yYWdlID0gc3RvcmFnZTtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnBvcHVwID0gcG9wdXA7XG4gICAgdGhpcy5kZWZhdWx0cyA9IHtcbiAgICAgIHVybDogbnVsbCxcbiAgICAgIG5hbWU6IG51bGwsXG4gICAgICBzdGF0ZTogbnVsbCxcbiAgICAgIHNjb3BlOiBudWxsLFxuICAgICAgc2NvcGVEZWxpbWl0ZXI6IG51bGwsXG4gICAgICByZWRpcmVjdFVyaTogbnVsbCxcbiAgICAgIHBvcHVwT3B0aW9uczogbnVsbCxcbiAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludDogbnVsbCxcbiAgICAgIHJlc3BvbnNlUGFyYW1zOiBudWxsLFxuICAgICAgcmVxdWlyZWRVcmxQYXJhbXM6IG51bGwsXG4gICAgICBvcHRpb25hbFVybFBhcmFtczogbnVsbCxcbiAgICAgIGRlZmF1bHRVcmxQYXJhbXM6IFsncmVzcG9uc2VfdHlwZScsICdjbGllbnRfaWQnLCAncmVkaXJlY3RfdXJpJ10sXG4gICAgICByZXNwb25zZVR5cGU6ICdjb2RlJ1xuICAgIH07XG4gIH1cblxuICBPQXV0aDIucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiBvcGVuKG9wdGlvbnMsIHVzZXJEYXRhKSB7XG4gICAgdmFyIF90aGlzNSA9IHRoaXM7XG5cbiAgICB2YXIgcHJvdmlkZXIgPSAoMCwgX2V4dGVuZDIuZGVmYXVsdCkodHJ1ZSwge30sIHRoaXMuZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgIHZhciBzdGF0ZU5hbWUgPSBwcm92aWRlci5uYW1lICsgJ19zdGF0ZSc7XG5cbiAgICBpZiAodHlwZW9mIHByb3ZpZGVyLnN0YXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHN0YXRlTmFtZSwgcHJvdmlkZXIuc3RhdGUoKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgcHJvdmlkZXIuc3RhdGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHN0YXRlTmFtZSwgcHJvdmlkZXIuc3RhdGUpO1xuICAgIH1cblxuICAgIHZhciB1cmwgPSBwcm92aWRlci5hdXRob3JpemF0aW9uRW5kcG9pbnQgKyAnPycgKyAoMCwgX2F1cmVsaWFQYXRoLmJ1aWxkUXVlcnlTdHJpbmcpKHRoaXMuYnVpbGRRdWVyeShwcm92aWRlcikpO1xuICAgIHZhciBwb3B1cCA9IHRoaXMucG9wdXAub3Blbih1cmwsIHByb3ZpZGVyLm5hbWUsIHByb3ZpZGVyLnBvcHVwT3B0aW9ucyk7XG4gICAgdmFyIG9wZW5Qb3B1cCA9IHRoaXMuY29uZmlnLnBsYXRmb3JtID09PSAnbW9iaWxlJyA/IHBvcHVwLmV2ZW50TGlzdGVuZXIocHJvdmlkZXIucmVkaXJlY3RVcmkpIDogcG9wdXAucG9sbFBvcHVwKCk7XG5cbiAgICByZXR1cm4gb3BlblBvcHVwLnRoZW4oZnVuY3Rpb24gKG9hdXRoRGF0YSkge1xuICAgICAgaWYgKHByb3ZpZGVyLnJlc3BvbnNlVHlwZSA9PT0gJ3Rva2VuJyB8fCBwcm92aWRlci5yZXNwb25zZVR5cGUgPT09ICdpZF90b2tlbiB0b2tlbicgfHwgcHJvdmlkZXIucmVzcG9uc2VUeXBlID09PSAndG9rZW4gaWRfdG9rZW4nKSB7XG4gICAgICAgIHJldHVybiBvYXV0aERhdGE7XG4gICAgICB9XG4gICAgICBpZiAob2F1dGhEYXRhLnN0YXRlICYmIG9hdXRoRGF0YS5zdGF0ZSAhPT0gX3RoaXM1LnN0b3JhZ2UuZ2V0KHN0YXRlTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdPQXV0aCAyLjAgc3RhdGUgcGFyYW1ldGVyIG1pc21hdGNoLicpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gX3RoaXM1LmV4Y2hhbmdlRm9yVG9rZW4ob2F1dGhEYXRhLCB1c2VyRGF0YSwgcHJvdmlkZXIpO1xuICAgIH0pO1xuICB9O1xuXG4gIE9BdXRoMi5wcm90b3R5cGUuZXhjaGFuZ2VGb3JUb2tlbiA9IGZ1bmN0aW9uIGV4Y2hhbmdlRm9yVG9rZW4ob2F1dGhEYXRhLCB1c2VyRGF0YSwgcHJvdmlkZXIpIHtcbiAgICB2YXIgZGF0YSA9ICgwLCBfZXh0ZW5kMi5kZWZhdWx0KSh0cnVlLCB7fSwgdXNlckRhdGEsIHtcbiAgICAgIGNsaWVudElkOiBwcm92aWRlci5jbGllbnRJZCxcbiAgICAgIHJlZGlyZWN0VXJpOiBwcm92aWRlci5yZWRpcmVjdFVyaVxuICAgIH0sIG9hdXRoRGF0YSk7XG5cbiAgICB2YXIgc2VydmVyVXJsID0gdGhpcy5jb25maWcuam9pbkJhc2UocHJvdmlkZXIudXJsKTtcbiAgICB2YXIgY3JlZGVudGlhbHMgPSB0aGlzLmNvbmZpZy53aXRoQ3JlZGVudGlhbHMgPyAnaW5jbHVkZScgOiAnc2FtZS1vcmlnaW4nO1xuXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmNsaWVudC5wb3N0KHNlcnZlclVybCwgZGF0YSwgeyBjcmVkZW50aWFsczogY3JlZGVudGlhbHMgfSk7XG4gIH07XG5cbiAgT0F1dGgyLnByb3RvdHlwZS5idWlsZFF1ZXJ5ID0gZnVuY3Rpb24gYnVpbGRRdWVyeShwcm92aWRlcikge1xuICAgIHZhciBfdGhpczYgPSB0aGlzO1xuXG4gICAgdmFyIHF1ZXJ5ID0ge307XG4gICAgdmFyIHVybFBhcmFtcyA9IFsnZGVmYXVsdFVybFBhcmFtcycsICdyZXF1aXJlZFVybFBhcmFtcycsICdvcHRpb25hbFVybFBhcmFtcyddO1xuXG4gICAgdXJsUGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgKHByb3ZpZGVyW3BhcmFtc10gfHwgW10pLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtTmFtZSkge1xuICAgICAgICB2YXIgY2FtZWxpemVkTmFtZSA9IGNhbWVsQ2FzZShwYXJhbU5hbWUpO1xuICAgICAgICB2YXIgcGFyYW1WYWx1ZSA9IHR5cGVvZiBwcm92aWRlcltwYXJhbU5hbWVdID09PSAnZnVuY3Rpb24nID8gcHJvdmlkZXJbcGFyYW1OYW1lXSgpIDogcHJvdmlkZXJbY2FtZWxpemVkTmFtZV07XG5cbiAgICAgICAgaWYgKHBhcmFtTmFtZSA9PT0gJ3N0YXRlJykge1xuICAgICAgICAgIHBhcmFtVmFsdWUgPSBlbmNvZGVVUklDb21wb25lbnQoX3RoaXM2LnN0b3JhZ2UuZ2V0KHByb3ZpZGVyLm5hbWUgKyAnX3N0YXRlJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmFtTmFtZSA9PT0gJ3Njb3BlJyAmJiBBcnJheS5pc0FycmF5KHBhcmFtVmFsdWUpKSB7XG4gICAgICAgICAgcGFyYW1WYWx1ZSA9IHBhcmFtVmFsdWUuam9pbihwcm92aWRlci5zY29wZURlbGltaXRlcik7XG5cbiAgICAgICAgICBpZiAocHJvdmlkZXIuc2NvcGVQcmVmaXgpIHtcbiAgICAgICAgICAgIHBhcmFtVmFsdWUgPSBwcm92aWRlci5zY29wZVByZWZpeCArIHByb3ZpZGVyLnNjb3BlRGVsaW1pdGVyICsgcGFyYW1WYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBxdWVyeVtwYXJhbU5hbWVdID0gcGFyYW1WYWx1ZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9O1xuXG4gIE9BdXRoMi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiBjbG9zZShvcHRpb25zKSB7XG4gICAgdmFyIHByb3ZpZGVyID0gKDAsIF9leHRlbmQyLmRlZmF1bHQpKHRydWUsIHt9LCB0aGlzLmRlZmF1bHRzLCBvcHRpb25zKTtcbiAgICB2YXIgdXJsID0gcHJvdmlkZXIubG9nb3V0RW5kcG9pbnQgKyAnPycgKyAoMCwgX2F1cmVsaWFQYXRoLmJ1aWxkUXVlcnlTdHJpbmcpKHRoaXMuYnVpbGRMb2dvdXRRdWVyeShwcm92aWRlcikpO1xuICAgIHZhciBwb3B1cCA9IHRoaXMucG9wdXAub3Blbih1cmwsIHByb3ZpZGVyLm5hbWUsIHByb3ZpZGVyLnBvcHVwT3B0aW9ucyk7XG4gICAgdmFyIG9wZW5Qb3B1cCA9IHRoaXMuY29uZmlnLnBsYXRmb3JtID09PSAnbW9iaWxlJyA/IHBvcHVwLmV2ZW50TGlzdGVuZXIocHJvdmlkZXIucG9zdExvZ291dFJlZGlyZWN0VXJpKSA6IHBvcHVwLnBvbGxQb3B1cCgpO1xuXG4gICAgcmV0dXJuIG9wZW5Qb3B1cDtcbiAgfTtcblxuICBPQXV0aDIucHJvdG90eXBlLmJ1aWxkTG9nb3V0UXVlcnkgPSBmdW5jdGlvbiBidWlsZExvZ291dFF1ZXJ5KHByb3ZpZGVyKSB7XG4gICAgdmFyIHF1ZXJ5ID0ge307XG4gICAgdmFyIGF1dGhSZXNwb25zZSA9IHRoaXMuc3RvcmFnZS5nZXQodGhpcy5jb25maWcuc3RvcmFnZUtleSk7XG5cbiAgICBpZiAocHJvdmlkZXIucG9zdExvZ291dFJlZGlyZWN0VXJpKSB7XG4gICAgICBxdWVyeS5wb3N0X2xvZ291dF9yZWRpcmVjdF91cmkgPSBwcm92aWRlci5wb3N0TG9nb3V0UmVkaXJlY3RVcmk7XG4gICAgfVxuICAgIGlmICh0aGlzLnN0b3JhZ2UuZ2V0KHByb3ZpZGVyLm5hbWUgKyAnX3N0YXRlJykpIHtcbiAgICAgIHF1ZXJ5LnN0YXRlID0gdGhpcy5zdG9yYWdlLmdldChwcm92aWRlci5uYW1lICsgJ19zdGF0ZScpO1xuICAgIH1cbiAgICBpZiAoSlNPTi5wYXJzZShhdXRoUmVzcG9uc2UpLmlkX3Rva2VuKSB7XG4gICAgICBxdWVyeS5pZF90b2tlbl9oaW50ID0gSlNPTi5wYXJzZShhdXRoUmVzcG9uc2UpLmlkX3Rva2VuO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeTtcbiAgfTtcblxuICByZXR1cm4gT0F1dGgyO1xufSgpKSB8fCBfY2xhc3M1KTtcblxuZnVuY3Rpb24gY2FtZWxDYXNlKG5hbWUpIHtcbiAgcmV0dXJuIG5hbWUucmVwbGFjZSgvKFs6XFwtX10rKC4pKS9nLCBmdW5jdGlvbiAoXywgc2VwYXJhdG9yLCBsZXR0ZXIsIG9mZnNldCkge1xuICAgIHJldHVybiBvZmZzZXQgPyBsZXR0ZXIudG9VcHBlckNhc2UoKSA6IGxldHRlcjtcbiAgfSk7XG59XG5cbnZhciBBdXRoZW50aWNhdGlvbiA9IGV4cG9ydHMuQXV0aGVudGljYXRpb24gPSAoX2RlYzUgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoU3RvcmFnZSwgQmFzZUNvbmZpZywgT0F1dGgxLCBPQXV0aDIsIEF1dGhMb2NrKSwgX2RlYzYgPSAoMCwgX2F1cmVsaWFNZXRhZGF0YS5kZXByZWNhdGVkKSh7IG1lc3NhZ2U6ICdVc2UgYmFzZUNvbmZpZy5sb2dpblJvdXRlIGluc3RlYWQuJyB9KSwgX2RlYzcgPSAoMCwgX2F1cmVsaWFNZXRhZGF0YS5kZXByZWNhdGVkKSh7IG1lc3NhZ2U6ICdVc2UgYmFzZUNvbmZpZy5sb2dpblJlZGlyZWN0IGluc3RlYWQuJyB9KSwgX2RlYzggPSAoMCwgX2F1cmVsaWFNZXRhZGF0YS5kZXByZWNhdGVkKSh7IG1lc3NhZ2U6ICdVc2UgYmFzZUNvbmZpZy5qb2luQmFzZShiYXNlQ29uZmlnLmxvZ2luVXJsKSBpbnN0ZWFkLicgfSksIF9kZWM5ID0gKDAsIF9hdXJlbGlhTWV0YWRhdGEuZGVwcmVjYXRlZCkoeyBtZXNzYWdlOiAnVXNlIGJhc2VDb25maWcuam9pbkJhc2UoYmFzZUNvbmZpZy5zaWdudXBVcmwpIGluc3RlYWQuJyB9KSwgX2RlYzEwID0gKDAsIF9hdXJlbGlhTWV0YWRhdGEuZGVwcmVjYXRlZCkoeyBtZXNzYWdlOiAnVXNlIGJhc2VDb25maWcuam9pbkJhc2UoYmFzZUNvbmZpZy5wcm9maWxlVXJsKSBpbnN0ZWFkLicgfSksIF9kZWMxMSA9ICgwLCBfYXVyZWxpYU1ldGFkYXRhLmRlcHJlY2F0ZWQpKHsgbWVzc2FnZTogJ1VzZSAuZ2V0QWNjZXNzVG9rZW4oKSBpbnN0ZWFkLicgfSksIF9kZWM1KF9jbGFzczYgPSAoX2NsYXNzNyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQXV0aGVudGljYXRpb24oc3RvcmFnZSwgY29uZmlnLCBvQXV0aDEsIG9BdXRoMiwgYXV0aDBMb2NrKSB7XG4gICAgXG5cbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMub0F1dGgxID0gb0F1dGgxO1xuICAgIHRoaXMub0F1dGgyID0gb0F1dGgyO1xuICAgIHRoaXMuYXV0aDBMb2NrID0gYXV0aDBMb2NrO1xuICAgIHRoaXMudXBkYXRlVG9rZW5DYWxsc3RhY2sgPSBbXTtcbiAgICB0aGlzLmFjY2Vzc1Rva2VuID0gbnVsbDtcbiAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IG51bGw7XG4gICAgdGhpcy5pZFRva2VuID0gbnVsbDtcbiAgICB0aGlzLnBheWxvYWQgPSBudWxsO1xuICAgIHRoaXMuZXhwID0gbnVsbDtcbiAgICB0aGlzLnJlc3BvbnNlQW5hbHl6ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRMb2dpblJvdXRlID0gZnVuY3Rpb24gZ2V0TG9naW5Sb3V0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcubG9naW5Sb3V0ZTtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuZ2V0TG9naW5SZWRpcmVjdCA9IGZ1bmN0aW9uIGdldExvZ2luUmVkaXJlY3QoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmxvZ2luUmVkaXJlY3Q7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLmdldExvZ2luVXJsID0gZnVuY3Rpb24gZ2V0TG9naW5VcmwoKSB7XG4gICAgcmV0dXJuIHRoaXMuQ29uZmlnLmpvaW5CYXNlKHRoaXMuY29uZmlnLmxvZ2luVXJsKTtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuZ2V0U2lnbnVwVXJsID0gZnVuY3Rpb24gZ2V0U2lnbnVwVXJsKCkge1xuICAgIHJldHVybiB0aGlzLkNvbmZpZy5qb2luQmFzZSh0aGlzLmNvbmZpZy5zaWdudXBVcmwpO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRQcm9maWxlVXJsID0gZnVuY3Rpb24gZ2V0UHJvZmlsZVVybCgpIHtcbiAgICByZXR1cm4gdGhpcy5Db25maWcuam9pbkJhc2UodGhpcy5jb25maWcucHJvZmlsZVVybCk7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLmdldFRva2VuID0gZnVuY3Rpb24gZ2V0VG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWNjZXNzVG9rZW4oKTtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuZ2V0UmVzcG9uc2VPYmplY3QgPSBmdW5jdGlvbiBnZXRSZXNwb25zZU9iamVjdCgpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLnN0b3JhZ2UuZ2V0KHRoaXMuY29uZmlnLnN0b3JhZ2VLZXkpKTtcbiAgfTtcblxuICBBdXRoZW50aWNhdGlvbi5wcm90b3R5cGUuc2V0UmVzcG9uc2VPYmplY3QgPSBmdW5jdGlvbiBzZXRSZXNwb25zZU9iamVjdChyZXNwb25zZSkge1xuICAgIGlmIChyZXNwb25zZSkge1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmtlZXBPbGRSZXNwb25zZVByb3BlcnRpZXMpIHtcbiAgICAgICAgdmFyIG9sZFJlc3BvbnNlID0gdGhpcy5nZXRSZXNwb25zZU9iamVjdCgpO1xuXG4gICAgICAgIHJlc3BvbnNlID0gT2JqZWN0LmFzc2lnbih7fSwgb2xkUmVzcG9uc2UsIHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2V0RGF0YUZyb21SZXNwb25zZShyZXNwb25zZSk7XG4gICAgICB0aGlzLnN0b3JhZ2Uuc2V0KHRoaXMuY29uZmlnLnN0b3JhZ2VLZXksIEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5hY2Nlc3NUb2tlbiA9IG51bGw7XG4gICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsO1xuICAgIHRoaXMuaWRUb2tlbiA9IG51bGw7XG4gICAgdGhpcy5wYXlsb2FkID0gbnVsbDtcbiAgICB0aGlzLmV4cCA9IG51bGw7XG4gICAgdGhpcy5yZXNwb25zZUFuYWx5emVkID0gZmFsc2U7XG5cbiAgICB0aGlzLnN0b3JhZ2UucmVtb3ZlKHRoaXMuY29uZmlnLnN0b3JhZ2VLZXkpO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRBY2Nlc3NUb2tlbiA9IGZ1bmN0aW9uIGdldEFjY2Vzc1Rva2VuKCkge1xuICAgIGlmICghdGhpcy5yZXNwb25zZUFuYWx5emVkKSB0aGlzLmdldERhdGFGcm9tUmVzcG9uc2UodGhpcy5nZXRSZXNwb25zZU9iamVjdCgpKTtcblxuICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRSZWZyZXNoVG9rZW4gPSBmdW5jdGlvbiBnZXRSZWZyZXNoVG9rZW4oKSB7XG4gICAgaWYgKCF0aGlzLnJlc3BvbnNlQW5hbHl6ZWQpIHRoaXMuZ2V0RGF0YUZyb21SZXNwb25zZSh0aGlzLmdldFJlc3BvbnNlT2JqZWN0KCkpO1xuXG4gICAgcmV0dXJuIHRoaXMucmVmcmVzaFRva2VuO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRJZFRva2VuID0gZnVuY3Rpb24gZ2V0SWRUb2tlbigpIHtcbiAgICBpZiAoIXRoaXMucmVzcG9uc2VBbmFseXplZCkgdGhpcy5nZXREYXRhRnJvbVJlc3BvbnNlKHRoaXMuZ2V0UmVzcG9uc2VPYmplY3QoKSk7XG5cbiAgICByZXR1cm4gdGhpcy5pZFRva2VuO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRQYXlsb2FkID0gZnVuY3Rpb24gZ2V0UGF5bG9hZCgpIHtcbiAgICBpZiAoIXRoaXMucmVzcG9uc2VBbmFseXplZCkgdGhpcy5nZXREYXRhRnJvbVJlc3BvbnNlKHRoaXMuZ2V0UmVzcG9uc2VPYmplY3QoKSk7XG5cbiAgICByZXR1cm4gdGhpcy5wYXlsb2FkO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRJZFBheWxvYWQgPSBmdW5jdGlvbiBnZXRJZFBheWxvYWQoKSB7XG4gICAgaWYgKCF0aGlzLnJlc3BvbnNlQW5hbHl6ZWQpIHRoaXMuZ2V0RGF0YUZyb21SZXNwb25zZSh0aGlzLmdldFJlc3BvbnNlT2JqZWN0KCkpO1xuXG4gICAgcmV0dXJuIHRoaXMuaWRQYXlsb2FkO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRFeHAgPSBmdW5jdGlvbiBnZXRFeHAoKSB7XG4gICAgaWYgKCF0aGlzLnJlc3BvbnNlQW5hbHl6ZWQpIHRoaXMuZ2V0RGF0YUZyb21SZXNwb25zZSh0aGlzLmdldFJlc3BvbnNlT2JqZWN0KCkpO1xuXG4gICAgcmV0dXJuIHRoaXMuZXhwO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRUdGwgPSBmdW5jdGlvbiBnZXRUdGwoKSB7XG4gICAgdmFyIGV4cCA9IHRoaXMuZ2V0RXhwKCk7XG5cbiAgICByZXR1cm4gTnVtYmVyLmlzTmFOKGV4cCkgPyBOYU4gOiBleHAgLSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLmlzVG9rZW5FeHBpcmVkID0gZnVuY3Rpb24gaXNUb2tlbkV4cGlyZWQoKSB7XG4gICAgdmFyIHRpbWVMZWZ0ID0gdGhpcy5nZXRUdGwoKTtcblxuICAgIHJldHVybiBOdW1iZXIuaXNOYU4odGltZUxlZnQpID8gdW5kZWZpbmVkIDogdGltZUxlZnQgPCAwO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5pc0F1dGhlbnRpY2F0ZWQgPSBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5nZXRBY2Nlc3NUb2tlbigpICYmICF0aGlzLmlzVG9rZW5FeHBpcmVkKCk7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLmdldERhdGFGcm9tUmVzcG9uc2UgPSBmdW5jdGlvbiBnZXREYXRhRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnO1xuXG4gICAgdGhpcy5hY2Nlc3NUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZy5nZXRBY2Nlc3NUb2tlbkZyb21SZXNwb25zZSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuY29uZmlnLmdldEFjY2Vzc1Rva2VuRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSA6IHRoaXMuZ2V0VG9rZW5Gcm9tUmVzcG9uc2UocmVzcG9uc2UsIGNvbmZpZy5hY2Nlc3NUb2tlblByb3AsIGNvbmZpZy5hY2Nlc3NUb2tlbk5hbWUsIGNvbmZpZy5hY2Nlc3NUb2tlblJvb3QpO1xuXG4gICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsO1xuICAgIGlmIChjb25maWcudXNlUmVmcmVzaFRva2VuKSB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IHR5cGVvZiB0aGlzLmNvbmZpZy5nZXRSZWZyZXNoVG9rZW5Gcm9tUmVzcG9uc2UgPT09ICdmdW5jdGlvbicgPyB0aGlzLmNvbmZpZy5nZXRSZWZyZXNoVG9rZW5Gcm9tUmVzcG9uc2UocmVzcG9uc2UpIDogdGhpcy5nZXRUb2tlbkZyb21SZXNwb25zZShyZXNwb25zZSwgY29uZmlnLnJlZnJlc2hUb2tlblByb3AsIGNvbmZpZy5yZWZyZXNoVG9rZW5OYW1lLCBjb25maWcucmVmcmVzaFRva2VuUm9vdCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gbnVsbDtcblxuICAgICAgICBsb2dnZXIud2FybigndXNlUmVmcmVzaFRva2VuIGlzIHNldCwgYnV0IGNvdWxkIG5vdCBleHRyYWN0IGEgcmVmcmVzaCB0b2tlbicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaWRUb2tlbiA9IG51bGw7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuaWRUb2tlbiA9IHRoaXMuZ2V0VG9rZW5Gcm9tUmVzcG9uc2UocmVzcG9uc2UsIGNvbmZpZy5pZFRva2VuUHJvcCwgY29uZmlnLmlkVG9rZW5OYW1lLCBjb25maWcuaWRUb2tlblJvb3QpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuaWRUb2tlbiA9IG51bGw7XG4gICAgfVxuXG4gICAgdGhpcy5wYXlsb2FkID0gZ2V0UGF5bG9hZCh0aGlzLmFjY2Vzc1Rva2VuKTtcbiAgICB0aGlzLmlkUGF5bG9hZCA9IGdldFBheWxvYWQodGhpcy5pZFRva2VuKTtcblxuICAgIHRoaXMuZXhwID0gcGFyc2VJbnQodHlwZW9mIHRoaXMuY29uZmlnLmdldEV4cGlyYXRpb25EYXRlRnJvbVJlc3BvbnNlID09PSAnZnVuY3Rpb24nID8gdGhpcy5jb25maWcuZ2V0RXhwaXJhdGlvbkRhdGVGcm9tUmVzcG9uc2UocmVzcG9uc2UpIDogdGhpcy5wYXlsb2FkICYmIHRoaXMucGF5bG9hZC5leHAsIDEwKSB8fCBOYU47XG5cbiAgICB0aGlzLnJlc3BvbnNlQW5hbHl6ZWQgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLFxuICAgICAgcmVmcmVzaFRva2VuOiB0aGlzLnJlZnJlc2hUb2tlbixcbiAgICAgIGlkVG9rZW46IHRoaXMuaWRUb2tlbixcbiAgICAgIHBheWxvYWQ6IHRoaXMucGF5bG9hZCxcbiAgICAgIGV4cDogdGhpcy5leHBcbiAgICB9O1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5nZXRUb2tlbkZyb21SZXNwb25zZSA9IGZ1bmN0aW9uIGdldFRva2VuRnJvbVJlc3BvbnNlKHJlc3BvbnNlLCB0b2tlblByb3AsIHRva2VuTmFtZSwgdG9rZW5Sb290KSB7XG4gICAgaWYgKCFyZXNwb25zZSkgcmV0dXJuIHVuZGVmaW5lZDtcblxuICAgIHZhciByZXNwb25zZVRva2VuUHJvcCA9IHRva2VuUHJvcC5zcGxpdCgnLicpLnJlZHVjZShmdW5jdGlvbiAobywgeCkge1xuICAgICAgcmV0dXJuIG9beF07XG4gICAgfSwgcmVzcG9uc2UpO1xuXG4gICAgaWYgKHR5cGVvZiByZXNwb25zZVRva2VuUHJvcCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiByZXNwb25zZVRva2VuUHJvcDtcbiAgICB9XG5cbiAgICBpZiAoKHR5cGVvZiByZXNwb25zZVRva2VuUHJvcCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YocmVzcG9uc2VUb2tlblByb3ApKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHZhciB0b2tlblJvb3REYXRhID0gdG9rZW5Sb290ICYmIHRva2VuUm9vdC5zcGxpdCgnLicpLnJlZHVjZShmdW5jdGlvbiAobywgeCkge1xuICAgICAgICByZXR1cm4gb1t4XTtcbiAgICAgIH0sIHJlc3BvbnNlVG9rZW5Qcm9wKTtcbiAgICAgIHZhciBfdG9rZW4gPSB0b2tlblJvb3REYXRhID8gdG9rZW5Sb290RGF0YVt0b2tlbk5hbWVdIDogcmVzcG9uc2VUb2tlblByb3BbdG9rZW5OYW1lXTtcblxuICAgICAgaWYgKCFfdG9rZW4pIHtcbiAgICAgICAgdmFyIGVycm9yID0gbmV3IEVycm9yKCdUb2tlbiBub3QgZm91bmQgaW4gcmVzcG9uc2UnKTtcblxuICAgICAgICBlcnJvci5yZXNwb25zZU9iamVjdCA9IHJlc3BvbnNlO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF90b2tlbjtcbiAgICB9XG5cbiAgICB2YXIgdG9rZW4gPSByZXNwb25zZVt0b2tlbk5hbWVdID09PSB1bmRlZmluZWQgPyBudWxsIDogcmVzcG9uc2VbdG9rZW5OYW1lXTtcblxuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHZhciBfZXJyb3IgPSBuZXcgRXJyb3IoJ1Rva2VuIG5vdCBmb3VuZCBpbiByZXNwb25zZScpO1xuXG4gICAgICBfZXJyb3IucmVzcG9uc2VPYmplY3QgPSByZXNwb25zZTtcbiAgICAgIHRocm93IF9lcnJvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gdG9rZW47XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLnRvVXBkYXRlVG9rZW5DYWxsc3RhY2sgPSBmdW5jdGlvbiB0b1VwZGF0ZVRva2VuQ2FsbHN0YWNrKCkge1xuICAgIHZhciBfdGhpczcgPSB0aGlzO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICByZXR1cm4gX3RoaXM3LnVwZGF0ZVRva2VuQ2FsbHN0YWNrLnB1c2gocmVzb2x2ZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLnJlc29sdmVVcGRhdGVUb2tlbkNhbGxzdGFjayA9IGZ1bmN0aW9uIHJlc29sdmVVcGRhdGVUb2tlbkNhbGxzdGFjayhyZXNwb25zZSkge1xuICAgIHRoaXMudXBkYXRlVG9rZW5DYWxsc3RhY2subWFwKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICByZXR1cm4gcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgfSk7XG4gICAgdGhpcy51cGRhdGVUb2tlbkNhbGxzdGFjayA9IFtdO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiBhdXRoZW50aWNhdGUobmFtZSkge1xuICAgIHZhciB1c2VyRGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG5cbiAgICB2YXIgb2F1dGhUeXBlID0gdGhpcy5jb25maWcucHJvdmlkZXJzW25hbWVdLnR5cGU7XG5cbiAgICBpZiAob2F1dGhUeXBlKSB7XG4gICAgICBsb2dnZXIud2FybignREVQUkVDQVRFRDogU2V0dGluZyBwcm92aWRlci50eXBlIGlzIGRlcHJlY2F0ZWQgYW5kIHJlcGxhY2VkIGJ5IHByb3ZpZGVyLm9hdXRoVHlwZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYXV0aFR5cGUgPSB0aGlzLmNvbmZpZy5wcm92aWRlcnNbbmFtZV0ub2F1dGhUeXBlO1xuICAgIH1cblxuICAgIHZhciBwcm92aWRlckxvZ2luID0gdm9pZCAwO1xuXG4gICAgaWYgKG9hdXRoVHlwZSA9PT0gJ2F1dGgwLWxvY2snKSB7XG4gICAgICBwcm92aWRlckxvZ2luID0gdGhpcy5hdXRoMExvY2s7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb3ZpZGVyTG9naW4gPSBvYXV0aFR5cGUgPT09ICcxLjAnID8gdGhpcy5vQXV0aDEgOiB0aGlzLm9BdXRoMjtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvdmlkZXJMb2dpbi5vcGVuKHRoaXMuY29uZmlnLnByb3ZpZGVyc1tuYW1lXSwgdXNlckRhdGEpO1xuICB9O1xuXG4gIEF1dGhlbnRpY2F0aW9uLnByb3RvdHlwZS5sb2dvdXQgPSBmdW5jdGlvbiBsb2dvdXQobmFtZSkge1xuICAgIHZhciBydG5WYWx1ZSA9IFByb21pc2UucmVzb2x2ZSgnTm90IEFwcGxpY2FibGUnKTtcblxuICAgIGlmICh0aGlzLmNvbmZpZy5wcm92aWRlcnNbbmFtZV0ub2F1dGhUeXBlICE9PSAnMi4wJyB8fCAhdGhpcy5jb25maWcucHJvdmlkZXJzW25hbWVdLmxvZ291dEVuZHBvaW50KSB7XG4gICAgICByZXR1cm4gcnRuVmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMub0F1dGgyLmNsb3NlKHRoaXMuY29uZmlnLnByb3ZpZGVyc1tuYW1lXSk7XG4gIH07XG5cbiAgQXV0aGVudGljYXRpb24ucHJvdG90eXBlLnJlZGlyZWN0ID0gZnVuY3Rpb24gcmVkaXJlY3QocmVkaXJlY3RVcmwsIGRlZmF1bHRSZWRpcmVjdFVybCwgcXVlcnkpIHtcbiAgICBpZiAocmVkaXJlY3RVcmwgPT09IHRydWUpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdERVBSRUNBVEVEOiBTZXR0aW5nIHJlZGlyZWN0VXJsID09PSB0cnVlIHRvIGFjdHVhbGx5ICpub3QgcmVkaXJlY3QqIGlzIGRlcHJlY2F0ZWQuIFNldCByZWRpcmVjdFVybCA9PT0gXFwnXFwnIGluc3RlYWQuJyk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAocmVkaXJlY3RVcmwgPT09IGZhbHNlKSB7XG4gICAgICBsb2dnZXIud2FybignQlJFQUtJTkcgQ0hBTkdFOiBTZXR0aW5nIHJlZGlyZWN0VXJsID09PSBmYWxzZSB0byBhY3R1YWxseSAqZG8gcmVkaXJlY3QqIGlzIGRlcHJlY2F0ZWQuIFNldCByZWRpcmVjdFVybCB0byB1bmRlZmluZWQgb3IgbnVsbCB0byB1c2UgdGhlIGRlZmF1bHRSZWRpcmVjdFVybCBpZiBzbyBkZXNpcmVkLicpO1xuICAgIH1cblxuICAgIGlmIChyZWRpcmVjdFVybCA9PT0gMCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ0JSRUFLSU5HIENIQU5HRTogU2V0dGluZyByZWRpcmVjdFVybCA9PT0gMCBpcyBkZXByZWNhdGVkLiBTZXQgcmVkaXJlY3RVcmwgdG8gXFwnXFwnIGluc3RlYWQuJyk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAocmVkaXJlY3RVcmwgPT09ICcnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiByZWRpcmVjdFVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLmhyZWYgPSBlbmNvZGVVUkkocmVkaXJlY3RVcmwgKyAocXVlcnkgPyAnPycgKyAoMCwgX2F1cmVsaWFQYXRoLmJ1aWxkUXVlcnlTdHJpbmcpKHF1ZXJ5KSA6ICcnKSk7XG4gICAgfSBlbHNlIGlmIChkZWZhdWx0UmVkaXJlY3RVcmwpIHtcbiAgICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLmhyZWYgPSBkZWZhdWx0UmVkaXJlY3RVcmwgKyAocXVlcnkgPyAnPycgKyAoMCwgX2F1cmVsaWFQYXRoLmJ1aWxkUXVlcnlTdHJpbmcpKHF1ZXJ5KSA6ICcnKTtcbiAgICB9XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKEF1dGhlbnRpY2F0aW9uLCBbe1xuICAgIGtleTogJ3Jlc3BvbnNlT2JqZWN0JyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdHZXR0ZXIgQXV0aGVudGljYXRpb24ucmVzcG9uc2VPYmplY3QgaXMgZGVwcmVjYXRlZC4gVXNlIEF1dGhlbnRpY2F0aW9uLmdldFJlc3BvbnNlT2JqZWN0KCkgaW5zdGVhZC4nKTtcblxuICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVzcG9uc2VPYmplY3QoKTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24gc2V0KHJlc3BvbnNlKSB7XG4gICAgICBsb2dnZXIud2FybignU2V0dGVyIEF1dGhlbnRpY2F0aW9uLnJlc3BvbnNlT2JqZWN0IGlzIGRlcHJlY2F0ZWQuIFVzZSBBdXRoU2Vydml2ZS5zZXRSZXNwb25zZU9iamVjdChyZXNwb25zZSkgaW5zdGVhZC4nKTtcbiAgICAgIHRoaXMuc2V0UmVzcG9uc2VPYmplY3QocmVzcG9uc2UpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2hhc0RhdGFTdG9yZWQnLFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ0F1dGhlbnRpY2F0aW9uLmhhc0RhdGFTdG9yZWQgaXMgZGVwcmVjYXRlZC4gVXNlIEF1dGhlbnRpY2F0aW9uLnJlc3BvbnNlQW5hbHl6ZWQgaW5zdGVhZC4nKTtcblxuICAgICAgcmV0dXJuIHRoaXMucmVzcG9uc2VBbmFseXplZDtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQXV0aGVudGljYXRpb247XG59KCksIChfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKF9jbGFzczcucHJvdG90eXBlLCAnZ2V0TG9naW5Sb3V0ZScsIFtfZGVjNl0sIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoX2NsYXNzNy5wcm90b3R5cGUsICdnZXRMb2dpblJvdXRlJyksIF9jbGFzczcucHJvdG90eXBlKSwgX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3M3LnByb3RvdHlwZSwgJ2dldExvZ2luUmVkaXJlY3QnLCBbX2RlYzddLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKF9jbGFzczcucHJvdG90eXBlLCAnZ2V0TG9naW5SZWRpcmVjdCcpLCBfY2xhc3M3LnByb3RvdHlwZSksIF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzNy5wcm90b3R5cGUsICdnZXRMb2dpblVybCcsIFtfZGVjOF0sIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoX2NsYXNzNy5wcm90b3R5cGUsICdnZXRMb2dpblVybCcpLCBfY2xhc3M3LnByb3RvdHlwZSksIF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzNy5wcm90b3R5cGUsICdnZXRTaWdudXBVcmwnLCBbX2RlYzldLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKF9jbGFzczcucHJvdG90eXBlLCAnZ2V0U2lnbnVwVXJsJyksIF9jbGFzczcucHJvdG90eXBlKSwgX2FwcGx5RGVjb3JhdGVkRGVzY3JpcHRvcihfY2xhc3M3LnByb3RvdHlwZSwgJ2dldFByb2ZpbGVVcmwnLCBbX2RlYzEwXSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihfY2xhc3M3LnByb3RvdHlwZSwgJ2dldFByb2ZpbGVVcmwnKSwgX2NsYXNzNy5wcm90b3R5cGUpLCBfYXBwbHlEZWNvcmF0ZWREZXNjcmlwdG9yKF9jbGFzczcucHJvdG90eXBlLCAnZ2V0VG9rZW4nLCBbX2RlYzExXSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihfY2xhc3M3LnByb3RvdHlwZSwgJ2dldFRva2VuJyksIF9jbGFzczcucHJvdG90eXBlKSksIF9jbGFzczcpKSB8fCBfY2xhc3M2KTtcblxuZnVuY3Rpb24gZ2V0UGF5bG9hZCh0b2tlbikge1xuICB2YXIgcGF5bG9hZCA9IG51bGw7XG5cbiAgdHJ5IHtcbiAgICBwYXlsb2FkID0gdG9rZW4gPyAoMCwgX2p3dERlY29kZTIuZGVmYXVsdCkodG9rZW4pIDogbnVsbDtcbiAgfSBjYXRjaCAoXykge31cblxuICByZXR1cm4gcGF5bG9hZDtcbn1cblxudmFyIEF1dGhTZXJ2aWNlID0gZXhwb3J0cy5BdXRoU2VydmljZSA9IChfZGVjMTIgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoQXV0aGVudGljYXRpb24sIEJhc2VDb25maWcsIF9hdXJlbGlhVGVtcGxhdGluZ1Jlc291cmNlcy5CaW5kaW5nU2lnbmFsZXIsIF9hdXJlbGlhRXZlbnRBZ2dyZWdhdG9yLkV2ZW50QWdncmVnYXRvciksIF9kZWMxMyA9ICgwLCBfYXVyZWxpYU1ldGFkYXRhLmRlcHJlY2F0ZWQpKHsgbWVzc2FnZTogJ1VzZSAuZ2V0QWNjZXNzVG9rZW4oKSBpbnN0ZWFkLicgfSksIF9kZWMxMihfY2xhc3M4ID0gKF9jbGFzczkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dGhTZXJ2aWNlKGF1dGhlbnRpY2F0aW9uLCBjb25maWcsIGJpbmRpbmdTaWduYWxlciwgZXZlbnRBZ2dyZWdhdG9yKSB7XG4gICAgdmFyIF90aGlzOCA9IHRoaXM7XG5cbiAgICBcblxuICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlO1xuICAgIHRoaXMudGltZW91dElEID0gMDtcblxuICAgIHRoaXMuc3RvcmFnZUV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKGV2ZW50LmtleSAhPT0gX3RoaXM4LmNvbmZpZy5zdG9yYWdlS2V5IHx8IGV2ZW50Lm5ld1ZhbHVlID09PSBldmVudC5vbGRWYWx1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChldmVudC5uZXdWYWx1ZSkge1xuICAgICAgICBfdGhpczguYXV0aGVudGljYXRpb24uc3RvcmFnZS5zZXQoX3RoaXM4LmNvbmZpZy5zdG9yYWdlS2V5LCBldmVudC5uZXdWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfdGhpczguYXV0aGVudGljYXRpb24uc3RvcmFnZS5yZW1vdmUoX3RoaXM4LmNvbmZpZy5zdG9yYWdlS2V5KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50Lm5ld1ZhbHVlICYmIF90aGlzOC5jb25maWcuYXV0b1VwZGF0ZVRva2VuICYmIF90aGlzOC5hdXRoZW50aWNhdGlvbi5nZXRBY2Nlc3NUb2tlbigpICYmIF90aGlzOC5hdXRoZW50aWNhdGlvbi5nZXRSZWZyZXNoVG9rZW4oKSkge1xuICAgICAgICBfdGhpczguc2V0UmVzcG9uc2VPYmplY3QoX3RoaXM4LmF1dGhlbnRpY2F0aW9uLmdldFJlc3BvbnNlT2JqZWN0KCkpO1xuXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbG9nZ2VyLmluZm8oJ1N0b3JlZCB0b2tlbiBjaGFuZ2VkIGV2ZW50Jyk7XG5cbiAgICAgIHZhciB3YXNBdXRoZW50aWNhdGVkID0gX3RoaXM4LmF1dGhlbnRpY2F0ZWQ7XG5cbiAgICAgIF90aGlzOC5hdXRoZW50aWNhdGlvbi5yZXNwb25zZUFuYWx5emVkID0gZmFsc2U7XG4gICAgICBfdGhpczgudXBkYXRlQXV0aGVudGljYXRlZCgpO1xuXG4gICAgICBpZiAod2FzQXV0aGVudGljYXRlZCA9PT0gX3RoaXM4LmF1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoX3RoaXM4LmNvbmZpZy5zdG9yYWdlQ2hhbmdlZFJlZGlyZWN0KSB7XG4gICAgICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLmhyZWYgPSBfdGhpczguY29uZmlnLnN0b3JhZ2VDaGFuZ2VkUmVkaXJlY3Q7XG4gICAgICB9XG5cbiAgICAgIGlmIChfdGhpczguY29uZmlnLnN0b3JhZ2VDaGFuZ2VkUmVsb2FkKSB7XG4gICAgICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmF1dGhlbnRpY2F0aW9uID0gYXV0aGVudGljYXRpb247XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5iaW5kaW5nU2lnbmFsZXIgPSBiaW5kaW5nU2lnbmFsZXI7XG4gICAgdGhpcy5ldmVudEFnZ3JlZ2F0b3IgPSBldmVudEFnZ3JlZ2F0b3I7XG5cbiAgICB2YXIgb2xkU3RvcmFnZUtleSA9IGNvbmZpZy50b2tlblByZWZpeCA/IGNvbmZpZy50b2tlblByZWZpeCArICdfJyArIGNvbmZpZy50b2tlbk5hbWUgOiBjb25maWcudG9rZW5OYW1lO1xuICAgIHZhciBvbGRUb2tlbiA9IGF1dGhlbnRpY2F0aW9uLnN0b3JhZ2UuZ2V0KG9sZFN0b3JhZ2VLZXkpO1xuXG4gICAgaWYgKG9sZFRva2VuKSB7XG4gICAgICBsb2dnZXIuaW5mbygnRm91bmQgdG9rZW4gd2l0aCBkZXByZWNhdGVkIGZvcm1hdCBpbiBzdG9yYWdlLiBDb252ZXJ0aW5nIGl0IHRvIG5ldyBmb3JtYXQuIE5vIGZ1cnRoZXIgYWN0aW9uIHJlcXVpcmVkLicpO1xuICAgICAgdmFyIGZha2VPbGRSZXNwb25zZSA9IHt9O1xuXG4gICAgICBmYWtlT2xkUmVzcG9uc2VbY29uZmlnLmFjY2Vzc1Rva2VuUHJvcF0gPSBvbGRUb2tlbjtcbiAgICAgIHRoaXMuc2V0UmVzcG9uc2VPYmplY3QoZmFrZU9sZFJlc3BvbnNlKTtcbiAgICAgIGF1dGhlbnRpY2F0aW9uLnN0b3JhZ2UucmVtb3ZlKG9sZFN0b3JhZ2VLZXkpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0UmVzcG9uc2VPYmplY3QodGhpcy5hdXRoZW50aWNhdGlvbi5nZXRSZXNwb25zZU9iamVjdCgpKTtcblxuICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCB0aGlzLnN0b3JhZ2VFdmVudEhhbmRsZXIpO1xuICB9XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLnNldFRpbWVvdXQgPSBmdW5jdGlvbiBzZXRUaW1lb3V0KHR0bCkge1xuICAgIHZhciBfdGhpczkgPSB0aGlzO1xuXG4gICAgdmFyIG1heFRpbWVvdXQgPSAyMTQ3NDgzNjQ3O1xuICAgIGlmICh0dGwgPiBtYXhUaW1lb3V0KSB7XG4gICAgICB0dGwgPSBtYXhUaW1lb3V0O1xuICAgICAgbG9nZ2VyLndhcm4oJ1Rva2VuIHRpbWVvdXQgbGltaXRlZCB0byAnLCBtYXhUaW1lb3V0LCAnIG1zIChjYSAyNC44NWQpLicpO1xuICAgIH1cblxuICAgIHRoaXMuY2xlYXJUaW1lb3V0KCk7XG5cbiAgICB2YXIgZXhwaXJlZFRva2VuSGFuZGxlciA9IGZ1bmN0aW9uIGV4cGlyZWRUb2tlbkhhbmRsZXIoKSB7XG4gICAgICBpZiAoX3RoaXM5LmNvbmZpZy5hdXRvVXBkYXRlVG9rZW4gJiYgX3RoaXM5LmF1dGhlbnRpY2F0aW9uLmdldEFjY2Vzc1Rva2VuKCkgJiYgX3RoaXM5LmF1dGhlbnRpY2F0aW9uLmdldFJlZnJlc2hUb2tlbigpKSB7XG4gICAgICAgIF90aGlzOS51cGRhdGVUb2tlbigpLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiBsb2dnZXIud2FybihlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBfdGhpczkuc2V0UmVzcG9uc2VPYmplY3QobnVsbCk7XG5cbiAgICAgIGlmIChfdGhpczkuY29uZmlnLmV4cGlyZWRSZWRpcmVjdCkge1xuICAgICAgICBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbi5hc3NpZ24oX3RoaXM5LmNvbmZpZy5leHBpcmVkUmVkaXJlY3QpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnRpbWVvdXRJRCA9IF9hdXJlbGlhUGFsLlBMQVRGT1JNLmdsb2JhbC5zZXRUaW1lb3V0KGV4cGlyZWRUb2tlbkhhbmRsZXIsIHR0bCk7XG4gICAgX2F1cmVsaWFQYWwuUExBVEZPUk0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoX3RoaXM5LmlzVG9rZW5FeHBpcmVkKCkpIHtcbiAgICAgICAgZXhwaXJlZFRva2VuSGFuZGxlcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5jbGVhclRpbWVvdXQgPSBmdW5jdGlvbiBjbGVhclRpbWVvdXQoKSB7XG4gICAgaWYgKHRoaXMudGltZW91dElEKSB7XG4gICAgICBfYXVyZWxpYVBhbC5QTEFURk9STS5nbG9iYWwuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dElEKTtcbiAgICB9XG4gICAgdGhpcy50aW1lb3V0SUQgPSAwO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5zZXRSZXNwb25zZU9iamVjdCA9IGZ1bmN0aW9uIHNldFJlc3BvbnNlT2JqZWN0KHJlc3BvbnNlKSB7XG4gICAgdGhpcy5hdXRoZW50aWNhdGlvbi5zZXRSZXNwb25zZU9iamVjdChyZXNwb25zZSk7XG5cbiAgICB0aGlzLnVwZGF0ZUF1dGhlbnRpY2F0ZWQoKTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUudXBkYXRlQXV0aGVudGljYXRlZCA9IGZ1bmN0aW9uIHVwZGF0ZUF1dGhlbnRpY2F0ZWQoKSB7XG4gICAgdGhpcy5jbGVhclRpbWVvdXQoKTtcblxuICAgIHZhciB3YXNBdXRoZW50aWNhdGVkID0gdGhpcy5hdXRoZW50aWNhdGVkO1xuXG4gICAgdGhpcy5hdXRoZW50aWNhdGVkID0gdGhpcy5hdXRoZW50aWNhdGlvbi5pc0F1dGhlbnRpY2F0ZWQoKTtcblxuICAgIGlmICh0aGlzLmF1dGhlbnRpY2F0ZWQgJiYgIU51bWJlci5pc05hTih0aGlzLmF1dGhlbnRpY2F0aW9uLmV4cCkpIHtcbiAgICAgIHRoaXMuc2V0VGltZW91dCh0aGlzLmdldFR0bCgpICogMTAwMCk7XG4gICAgfVxuXG4gICAgaWYgKHdhc0F1dGhlbnRpY2F0ZWQgIT09IHRoaXMuYXV0aGVudGljYXRlZCkge1xuICAgICAgdGhpcy5iaW5kaW5nU2lnbmFsZXIuc2lnbmFsKCdhdXRoZW50aWNhdGlvbi1jaGFuZ2UnKTtcbiAgICAgIHRoaXMuZXZlbnRBZ2dyZWdhdG9yLnB1Ymxpc2goJ2F1dGhlbnRpY2F0aW9uLWNoYW5nZScsIHRoaXMuYXV0aGVudGljYXRlZCk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdBdXRob3JpemF0aW9uIGNoYW5nZWQgdG86ICcgKyB0aGlzLmF1dGhlbnRpY2F0ZWQpO1xuICAgIH1cbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUuZ2V0TWUgPSBmdW5jdGlvbiBnZXRNZShjcml0ZXJpYU9ySWQpIHtcbiAgICBpZiAodHlwZW9mIGNyaXRlcmlhT3JJZCA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGNyaXRlcmlhT3JJZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGNyaXRlcmlhT3JJZCA9IHsgaWQ6IGNyaXRlcmlhT3JJZCB9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNsaWVudC5maW5kKHRoaXMuY29uZmlnLmpvaW5CYXNlKHRoaXMuY29uZmlnLnByb2ZpbGVVcmwpLCBjcml0ZXJpYU9ySWQpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS51cGRhdGVNZSA9IGZ1bmN0aW9uIHVwZGF0ZU1lKGJvZHksIGNyaXRlcmlhT3JJZCkge1xuICAgIGlmICh0eXBlb2YgY3JpdGVyaWFPcklkID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgY3JpdGVyaWFPcklkID09PSAnbnVtYmVyJykge1xuICAgICAgY3JpdGVyaWFPcklkID0geyBpZDogY3JpdGVyaWFPcklkIH07XG4gICAgfVxuICAgIGlmICh0aGlzLmNvbmZpZy5wcm9maWxlTWV0aG9kID09PSAncHV0Jykge1xuICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnVwZGF0ZSh0aGlzLmNvbmZpZy5qb2luQmFzZSh0aGlzLmNvbmZpZy5wcm9maWxlVXJsKSwgY3JpdGVyaWFPcklkLCBib2R5KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jbGllbnQucGF0Y2godGhpcy5jb25maWcuam9pbkJhc2UodGhpcy5jb25maWcucHJvZmlsZVVybCksIGNyaXRlcmlhT3JJZCwgYm9keSk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmdldEFjY2Vzc1Rva2VuID0gZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb24uZ2V0QWNjZXNzVG9rZW4oKTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUuZ2V0Q3VycmVudFRva2VuID0gZnVuY3Rpb24gZ2V0Q3VycmVudFRva2VuKCkge1xuICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc1Rva2VuKCk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmdldFJlZnJlc2hUb2tlbiA9IGZ1bmN0aW9uIGdldFJlZnJlc2hUb2tlbigpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvbi5nZXRSZWZyZXNoVG9rZW4oKTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUuZ2V0SWRUb2tlbiA9IGZ1bmN0aW9uIGdldElkVG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb24uZ2V0SWRUb2tlbigpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5pc0F1dGhlbnRpY2F0ZWQgPSBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoY2FsbGJhY2spIHtcbiAgICB2YXIgX3RoaXMxMCA9IHRoaXM7XG5cbiAgICB0aGlzLmF1dGhlbnRpY2F0aW9uLnJlc3BvbnNlQW5hbHl6ZWQgPSBmYWxzZTtcblxuICAgIHZhciBhdXRoZW50aWNhdGVkID0gdGhpcy5hdXRoZW50aWNhdGlvbi5pc0F1dGhlbnRpY2F0ZWQoKTtcblxuICAgIGlmICghYXV0aGVudGljYXRlZCAmJiB0aGlzLmNvbmZpZy5hdXRvVXBkYXRlVG9rZW4gJiYgdGhpcy5hdXRoZW50aWNhdGlvbi5nZXRBY2Nlc3NUb2tlbigpICYmIHRoaXMuYXV0aGVudGljYXRpb24uZ2V0UmVmcmVzaFRva2VuKCkpIHtcbiAgICAgIHRoaXMudXBkYXRlVG9rZW4oKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGNhbGxiYWNrKF90aGlzMTAuYXV0aGVudGljYXRlZCk7XG4gICAgICAgIH1cbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICByZXR1cm4gbG9nZ2VyLndhcm4oZXJyb3IubWVzc2FnZSk7XG4gICAgICB9KTtcblxuICAgICAgYXV0aGVudGljYXRlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjYWxsYmFjayhhdXRoZW50aWNhdGVkKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBsb2dnZXIud2FybihlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfSwgMSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF1dGhlbnRpY2F0ZWQ7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmdldEV4cCA9IGZ1bmN0aW9uIGdldEV4cCgpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvbi5nZXRFeHAoKTtcbiAgfTtcblxuICBBdXRoU2VydmljZS5wcm90b3R5cGUuZ2V0VHRsID0gZnVuY3Rpb24gZ2V0VHRsKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uLmdldFR0bCgpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5pc1Rva2VuRXhwaXJlZCA9IGZ1bmN0aW9uIGlzVG9rZW5FeHBpcmVkKCkge1xuICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uLmlzVG9rZW5FeHBpcmVkKCk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmdldFRva2VuUGF5bG9hZCA9IGZ1bmN0aW9uIGdldFRva2VuUGF5bG9hZCgpIHtcbiAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvbi5nZXRQYXlsb2FkKCk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmdldElkVG9rZW5QYXlsb2FkID0gZnVuY3Rpb24gZ2V0SWRUb2tlblBheWxvYWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb24uZ2V0SWRQYXlsb2FkKCk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLnVwZGF0ZVRva2VuID0gZnVuY3Rpb24gdXBkYXRlVG9rZW4oKSB7XG4gICAgdmFyIF90aGlzMTEgPSB0aGlzO1xuXG4gICAgaWYgKCF0aGlzLmF1dGhlbnRpY2F0aW9uLmdldFJlZnJlc2hUb2tlbigpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdyZWZyZXNoVG9rZW4gbm90IHNldCcpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hdXRoZW50aWNhdGlvbi51cGRhdGVUb2tlbkNhbGxzdGFjay5sZW5ndGggPT09IDApIHtcbiAgICAgIHZhciBjb250ZW50ID0ge1xuICAgICAgICBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbidcbiAgICAgIH07XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5jbGllbnRJZCkge1xuICAgICAgICBjb250ZW50LmNsaWVudF9pZCA9IHRoaXMuY29uZmlnLmNsaWVudElkO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY29uZmlnLmNsaWVudFNlY3JldCkge1xuICAgICAgICBjb250ZW50LmNsaWVudF9zZWNyZXQgPSB0aGlzLmNvbmZpZy5jbGllbnRTZWNyZXQ7XG4gICAgICB9XG5cbiAgICAgIGNvbnRlbnRbdGhpcy5jb25maWcucmVmcmVzaFRva2VuU3VibWl0UHJvcF0gPSB0aGlzLmF1dGhlbnRpY2F0aW9uLmdldFJlZnJlc2hUb2tlbigpO1xuXG4gICAgICB0aGlzLmNsaWVudC5wb3N0KHRoaXMuY29uZmlnLmpvaW5CYXNlKHRoaXMuY29uZmlnLnJlZnJlc2hUb2tlblVybCA/IHRoaXMuY29uZmlnLnJlZnJlc2hUb2tlblVybCA6IHRoaXMuY29uZmlnLmxvZ2luVXJsKSwgY29udGVudCwgdGhpcy5jb25maWcuZ2V0T3B0aW9uc0ZvclRva2VuUmVxdWVzdHMoKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgX3RoaXMxMS5zZXRSZXNwb25zZU9iamVjdChyZXNwb25zZSk7XG4gICAgICAgIGlmIChfdGhpczExLmdldEFjY2Vzc1Rva2VuKCkpIHtcbiAgICAgICAgICBfdGhpczExLmF1dGhlbnRpY2F0aW9uLnJlc29sdmVVcGRhdGVUb2tlbkNhbGxzdGFjayhfdGhpczExLmlzQXV0aGVudGljYXRlZCgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpczExLnNldFJlc3BvbnNlT2JqZWN0KG51bGwpO1xuXG4gICAgICAgICAgaWYgKF90aGlzMTEuY29uZmlnLmV4cGlyZWRSZWRpcmVjdCkge1xuICAgICAgICAgICAgX2F1cmVsaWFQYWwuUExBVEZPUk0ubG9jYXRpb24uYXNzaWduKF90aGlzMTEuY29uZmlnLmV4cGlyZWRSZWRpcmVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF90aGlzMTEuYXV0aGVudGljYXRpb24ucmVzb2x2ZVVwZGF0ZVRva2VuQ2FsbHN0YWNrKFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignYWNjZXNzVG9rZW4gbm90IGZvdW5kIGluIHJlZnJlc2hUb2tlbiByZXNwb25zZScpKSk7XG4gICAgICAgIH1cbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBfdGhpczExLnNldFJlc3BvbnNlT2JqZWN0KG51bGwpO1xuXG4gICAgICAgIGlmIChfdGhpczExLmNvbmZpZy5leHBpcmVkUmVkaXJlY3QpIHtcbiAgICAgICAgICBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbi5hc3NpZ24oX3RoaXMxMS5jb25maWcuZXhwaXJlZFJlZGlyZWN0KTtcbiAgICAgICAgfVxuICAgICAgICBfdGhpczExLmF1dGhlbnRpY2F0aW9uLnJlc29sdmVVcGRhdGVUb2tlbkNhbGxzdGFjayhQcm9taXNlLnJlamVjdChlcnJvcikpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb24udG9VcGRhdGVUb2tlbkNhbGxzdGFjaygpO1xuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5zaWdudXAgPSBmdW5jdGlvbiBzaWdudXAoZGlzcGxheU5hbWVPckNyZWRlbnRpYWxzLCBlbWFpbE9yT3B0aW9ucywgcGFzc3dvcmRPclJlZGlyZWN0VXJpLCBvcHRpb25zLCByZWRpcmVjdFVyaSkge1xuICAgIHZhciBfdGhpczEyID0gdGhpcztcblxuICAgIHZhciBub3JtYWxpemVkID0ge307XG5cbiAgICBpZiAoKHR5cGVvZiBkaXNwbGF5TmFtZU9yQ3JlZGVudGlhbHMgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGRpc3BsYXlOYW1lT3JDcmVkZW50aWFscykpID09PSAnb2JqZWN0Jykge1xuICAgICAgbm9ybWFsaXplZC5jcmVkZW50aWFscyA9IGRpc3BsYXlOYW1lT3JDcmVkZW50aWFscztcbiAgICAgIG5vcm1hbGl6ZWQub3B0aW9ucyA9IGVtYWlsT3JPcHRpb25zO1xuICAgICAgbm9ybWFsaXplZC5yZWRpcmVjdFVyaSA9IHBhc3N3b3JkT3JSZWRpcmVjdFVyaTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9ybWFsaXplZC5jcmVkZW50aWFscyA9IHtcbiAgICAgICAgJ2Rpc3BsYXlOYW1lJzogZGlzcGxheU5hbWVPckNyZWRlbnRpYWxzLFxuICAgICAgICAnZW1haWwnOiBlbWFpbE9yT3B0aW9ucyxcbiAgICAgICAgJ3Bhc3N3b3JkJzogcGFzc3dvcmRPclJlZGlyZWN0VXJpXG4gICAgICB9O1xuICAgICAgbm9ybWFsaXplZC5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgIG5vcm1hbGl6ZWQucmVkaXJlY3RVcmkgPSByZWRpcmVjdFVyaTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jbGllbnQucG9zdCh0aGlzLmNvbmZpZy5qb2luQmFzZSh0aGlzLmNvbmZpZy5zaWdudXBVcmwpLCBub3JtYWxpemVkLmNyZWRlbnRpYWxzLCBub3JtYWxpemVkLm9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAoX3RoaXMxMi5jb25maWcubG9naW5PblNpZ251cCkge1xuICAgICAgICBfdGhpczEyLnNldFJlc3BvbnNlT2JqZWN0KHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIF90aGlzMTIuYXV0aGVudGljYXRpb24ucmVkaXJlY3Qobm9ybWFsaXplZC5yZWRpcmVjdFVyaSwgX3RoaXMxMi5jb25maWcuc2lnbnVwUmVkaXJlY3QpO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmxvZ2luID0gZnVuY3Rpb24gbG9naW4oZW1haWxPckNyZWRlbnRpYWxzLCBwYXNzd29yZE9yT3B0aW9ucywgb3B0aW9uc09yUmVkaXJlY3RVcmksIHJlZGlyZWN0VXJpKSB7XG4gICAgdmFyIF90aGlzMTMgPSB0aGlzO1xuXG4gICAgdmFyIG5vcm1hbGl6ZWQgPSB7fTtcblxuICAgIGlmICgodHlwZW9mIGVtYWlsT3JDcmVkZW50aWFscyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoZW1haWxPckNyZWRlbnRpYWxzKSkgPT09ICdvYmplY3QnKSB7XG4gICAgICBub3JtYWxpemVkLmNyZWRlbnRpYWxzID0gZW1haWxPckNyZWRlbnRpYWxzO1xuICAgICAgbm9ybWFsaXplZC5vcHRpb25zID0gdGhpcy5jb25maWcuZ2V0T3B0aW9uc0ZvclRva2VuUmVxdWVzdHMocGFzc3dvcmRPck9wdGlvbnMpO1xuICAgICAgbm9ybWFsaXplZC5yZWRpcmVjdFVyaSA9IG9wdGlvbnNPclJlZGlyZWN0VXJpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGVtYWlsT3JDcmVkZW50aWFscyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIG5vcm1hbGl6ZWQuY3JlZGVudGlhbHMgPSB7XG4gICAgICAgICdlbWFpbCc6IGVtYWlsT3JDcmVkZW50aWFscyxcbiAgICAgICAgJ3Bhc3N3b3JkJzogcGFzc3dvcmRPck9wdGlvbnNcbiAgICAgIH07XG4gICAgICBub3JtYWxpemVkLm9wdGlvbnMgPSB0aGlzLmNvbmZpZy5nZXRPcHRpb25zRm9yVG9rZW5SZXF1ZXN0cyhvcHRpb25zT3JSZWRpcmVjdFVyaSk7XG4gICAgICBub3JtYWxpemVkLnJlZGlyZWN0VXJpID0gcmVkaXJlY3RVcmk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29uZmlnLmNsaWVudElkKSB7XG4gICAgICBub3JtYWxpemVkLmNyZWRlbnRpYWxzLmNsaWVudF9pZCA9IHRoaXMuY29uZmlnLmNsaWVudElkO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbmZpZy5jbGllbnRTZWNyZXQpIHtcbiAgICAgIG5vcm1hbGl6ZWQuY3JlZGVudGlhbHMuY2xpZW50X3NlY3JldCA9IHRoaXMuY29uZmlnLmNsaWVudFNlY3JldDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jbGllbnQucG9zdCh0aGlzLmNvbmZpZy5qb2luQmFzZSh0aGlzLmNvbmZpZy5sb2dpblVybCksIG5vcm1hbGl6ZWQuY3JlZGVudGlhbHMsIG5vcm1hbGl6ZWQub3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgIF90aGlzMTMuc2V0UmVzcG9uc2VPYmplY3QocmVzcG9uc2UpO1xuXG4gICAgICBfdGhpczEzLmF1dGhlbnRpY2F0aW9uLnJlZGlyZWN0KG5vcm1hbGl6ZWQucmVkaXJlY3RVcmksIF90aGlzMTMuY29uZmlnLmxvZ2luUmVkaXJlY3QpO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uIGxvZ291dChyZWRpcmVjdFVyaSwgcXVlcnksIG5hbWUpIHtcbiAgICB2YXIgX3RoaXMxNCA9IHRoaXM7XG5cbiAgICB2YXIgbG9jYWxMb2dvdXQgPSBmdW5jdGlvbiBsb2NhbExvZ291dChyZXNwb25zZSkge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgICAgIF90aGlzMTQuc2V0UmVzcG9uc2VPYmplY3QobnVsbCk7XG5cbiAgICAgICAgX3RoaXMxNC5hdXRoZW50aWNhdGlvbi5yZWRpcmVjdChyZWRpcmVjdFVyaSwgX3RoaXMxNC5jb25maWcubG9nb3V0UmVkaXJlY3QsIHF1ZXJ5KTtcblxuICAgICAgICBpZiAodHlwZW9mIF90aGlzMTQub25Mb2dvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBfdGhpczE0Lm9uTG9nb3V0KHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBpZiAobmFtZSkge1xuICAgICAgaWYgKHRoaXMuY29uZmlnLnByb3ZpZGVyc1tuYW1lXS5sb2dvdXRFbmRwb2ludCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvbi5sb2dvdXQobmFtZSkudGhlbihmdW5jdGlvbiAobG9nb3V0UmVzcG9uc2UpIHtcbiAgICAgICAgICB2YXIgc3RhdGVWYWx1ZSA9IF90aGlzMTQuYXV0aGVudGljYXRpb24uc3RvcmFnZS5nZXQobmFtZSArICdfc3RhdGUnKTtcblxuICAgICAgICAgIGlmIChsb2dvdXRSZXNwb25zZS5zdGF0ZSAhPT0gc3RhdGVWYWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdPQXV0aDIgcmVzcG9uc2Ugc3RhdGUgdmFsdWUgZGlmZmVycycpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBsb2NhbExvZ291dChsb2dvdXRSZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWcubG9nb3V0VXJsID8gdGhpcy5jbGllbnQucmVxdWVzdCh0aGlzLmNvbmZpZy5sb2dvdXRNZXRob2QsIHRoaXMuY29uZmlnLmpvaW5CYXNlKHRoaXMuY29uZmlnLmxvZ291dFVybCkpLnRoZW4obG9jYWxMb2dvdXQpLmNhdGNoKGxvY2FsTG9nb3V0KSA6IGxvY2FsTG9nb3V0KCk7XG4gICAgfVxuICB9O1xuXG4gIEF1dGhTZXJ2aWNlLnByb3RvdHlwZS5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbiBhdXRoZW50aWNhdGUobmFtZSwgcmVkaXJlY3RVcmksIHVzZXJEYXRhKSB7XG4gICAgdmFyIF90aGlzMTUgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHRoaXMuYXV0aGVudGljYXRpb24uYXV0aGVudGljYXRlKG5hbWUsIHVzZXJEYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgX3RoaXMxNS5zZXRSZXNwb25zZU9iamVjdChyZXNwb25zZSk7XG5cbiAgICAgIF90aGlzMTUuYXV0aGVudGljYXRpb24ucmVkaXJlY3QocmVkaXJlY3RVcmksIF90aGlzMTUuY29uZmlnLmxvZ2luUmVkaXJlY3QpO1xuXG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSk7XG4gIH07XG5cbiAgQXV0aFNlcnZpY2UucHJvdG90eXBlLnVubGluayA9IGZ1bmN0aW9uIHVubGluayhuYW1lLCByZWRpcmVjdFVyaSkge1xuICAgIHZhciBfdGhpczE2ID0gdGhpcztcblxuICAgIHZhciB1bmxpbmtVcmwgPSB0aGlzLmNvbmZpZy5qb2luQmFzZSh0aGlzLmNvbmZpZy51bmxpbmtVcmwpICsgbmFtZTtcblxuICAgIHJldHVybiB0aGlzLmNsaWVudC5yZXF1ZXN0KHRoaXMuY29uZmlnLnVubGlua01ldGhvZCwgdW5saW5rVXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgX3RoaXMxNi5hdXRoZW50aWNhdGlvbi5yZWRpcmVjdChyZWRpcmVjdFVyaSk7XG5cbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KTtcbiAgfTtcblxuICBfY3JlYXRlQ2xhc3MoQXV0aFNlcnZpY2UsIFt7XG4gICAga2V5OiAnY2xpZW50JyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5jbGllbnQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnYXV0aCcsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICBsb2dnZXIud2FybignQXV0aFNlcnZpY2UuYXV0aCBpcyBkZXByZWNhdGVkLiBVc2UgLmF1dGhlbnRpY2F0aW9uIGluc3RlYWQuJyk7XG5cbiAgICAgIHJldHVybiB0aGlzLmF1dGhlbnRpY2F0aW9uO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBBdXRoU2VydmljZTtcbn0oKSwgKF9hcHBseURlY29yYXRlZERlc2NyaXB0b3IoX2NsYXNzOS5wcm90b3R5cGUsICdnZXRDdXJyZW50VG9rZW4nLCBbX2RlYzEzXSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihfY2xhc3M5LnByb3RvdHlwZSwgJ2dldEN1cnJlbnRUb2tlbicpLCBfY2xhc3M5LnByb3RvdHlwZSkpLCBfY2xhc3M5KSkgfHwgX2NsYXNzOCk7XG52YXIgQXV0aGVudGljYXRlU3RlcCA9IGV4cG9ydHMuQXV0aGVudGljYXRlU3RlcCA9IChfZGVjMTQgPSAoMCwgX2F1cmVsaWFEZXBlbmRlbmN5SW5qZWN0aW9uLmluamVjdCkoQXV0aFNlcnZpY2UpLCBfZGVjMTQoX2NsYXNzMTEgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEF1dGhlbnRpY2F0ZVN0ZXAoYXV0aFNlcnZpY2UpIHtcbiAgICBcblxuICAgIHRoaXMuYXV0aFNlcnZpY2UgPSBhdXRoU2VydmljZTtcbiAgfVxuXG4gIEF1dGhlbnRpY2F0ZVN0ZXAucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIHJ1bihyb3V0aW5nQ29udGV4dCwgbmV4dCkge1xuICAgIHZhciBpc0xvZ2dlZEluID0gdGhpcy5hdXRoU2VydmljZS5hdXRoZW50aWNhdGVkO1xuICAgIHZhciBsb2dpblJvdXRlID0gdGhpcy5hdXRoU2VydmljZS5jb25maWcubG9naW5Sb3V0ZTtcblxuICAgIGlmIChyb3V0aW5nQ29udGV4dC5nZXRBbGxJbnN0cnVjdGlvbnMoKS5zb21lKGZ1bmN0aW9uIChyb3V0ZSkge1xuICAgICAgcmV0dXJuIHJvdXRlLmNvbmZpZy5hdXRoID09PSB0cnVlO1xuICAgIH0pKSB7XG4gICAgICBpZiAoIWlzTG9nZ2VkSW4pIHtcbiAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKG5ldyBfYXVyZWxpYVJvdXRlci5SZWRpcmVjdChsb2dpblJvdXRlKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpc0xvZ2dlZEluICYmIHJvdXRpbmdDb250ZXh0LmdldEFsbEluc3RydWN0aW9ucygpLnNvbWUoZnVuY3Rpb24gKHJvdXRlKSB7XG4gICAgICByZXR1cm4gcm91dGUuZnJhZ21lbnQgPT09IGxvZ2luUm91dGU7XG4gICAgfSkpIHtcbiAgICAgIHJldHVybiBuZXh0LmNhbmNlbChuZXcgX2F1cmVsaWFSb3V0ZXIuUmVkaXJlY3QodGhpcy5hdXRoU2VydmljZS5jb25maWcubG9naW5SZWRpcmVjdCkpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXh0KCk7XG4gIH07XG5cbiAgcmV0dXJuIEF1dGhlbnRpY2F0ZVN0ZXA7XG59KCkpIHx8IF9jbGFzczExKTtcbnZhciBBdXRob3JpemVTdGVwID0gZXhwb3J0cy5BdXRob3JpemVTdGVwID0gKF9kZWMxNSA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShBdXRoU2VydmljZSksIF9kZWMxNShfY2xhc3MxMiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQXV0aG9yaXplU3RlcChhdXRoU2VydmljZSkge1xuICAgIFxuXG4gICAgbG9nZ2VyLndhcm4oJ0F1dGhvcml6ZVN0ZXAgaXMgZGVwcmVjYXRlZC4gVXNlIEF1dGhlbnRpY2F0ZVN0ZXAgaW5zdGVhZC4nKTtcblxuICAgIHRoaXMuYXV0aFNlcnZpY2UgPSBhdXRoU2VydmljZTtcbiAgfVxuXG4gIEF1dGhvcml6ZVN0ZXAucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIHJ1bihyb3V0aW5nQ29udGV4dCwgbmV4dCkge1xuICAgIHZhciBpc0xvZ2dlZEluID0gdGhpcy5hdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKTtcbiAgICB2YXIgbG9naW5Sb3V0ZSA9IHRoaXMuYXV0aFNlcnZpY2UuY29uZmlnLmxvZ2luUm91dGU7XG5cbiAgICBpZiAocm91dGluZ0NvbnRleHQuZ2V0QWxsSW5zdHJ1Y3Rpb25zKCkuc29tZShmdW5jdGlvbiAocm91dGUpIHtcbiAgICAgIHJldHVybiByb3V0ZS5jb25maWcuYXV0aDtcbiAgICB9KSkge1xuICAgICAgaWYgKCFpc0xvZ2dlZEluKSB7XG4gICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChuZXcgX2F1cmVsaWFSb3V0ZXIuUmVkaXJlY3QobG9naW5Sb3V0ZSkpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNMb2dnZWRJbiAmJiByb3V0aW5nQ29udGV4dC5nZXRBbGxJbnN0cnVjdGlvbnMoKS5zb21lKGZ1bmN0aW9uIChyb3V0ZSkge1xuICAgICAgcmV0dXJuIHJvdXRlLmZyYWdtZW50ID09PSBsb2dpblJvdXRlO1xuICAgIH0pKSB7XG4gICAgICByZXR1cm4gbmV4dC5jYW5jZWwobmV3IF9hdXJlbGlhUm91dGVyLlJlZGlyZWN0KHRoaXMuYXV0aFNlcnZpY2UuY29uZmlnLmxvZ2luUmVkaXJlY3QpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV4dCgpO1xuICB9O1xuXG4gIHJldHVybiBBdXRob3JpemVTdGVwO1xufSgpKSB8fCBfY2xhc3MxMik7XG52YXIgRmV0Y2hDb25maWcgPSBleHBvcnRzLkZldGNoQ29uZmlnID0gKF9kZWMxNiA9ICgwLCBfYXVyZWxpYURlcGVuZGVuY3lJbmplY3Rpb24uaW5qZWN0KShfYXVyZWxpYUZldGNoQ2xpZW50Lkh0dHBDbGllbnQsIF9hdXJlbGlhQXBpLkNvbmZpZywgQXV0aFNlcnZpY2UsIEJhc2VDb25maWcpLCBfZGVjMTYoX2NsYXNzMTMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEZldGNoQ29uZmlnKGh0dHBDbGllbnQsIGNsaWVudENvbmZpZywgYXV0aFNlcnZpY2UsIGNvbmZpZykge1xuICAgIFxuXG4gICAgdGhpcy5odHRwQ2xpZW50ID0gaHR0cENsaWVudDtcbiAgICB0aGlzLmNsaWVudENvbmZpZyA9IGNsaWVudENvbmZpZztcbiAgICB0aGlzLmF1dGhTZXJ2aWNlID0gYXV0aFNlcnZpY2U7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICBGZXRjaENvbmZpZy5wcm90b3R5cGUuY29uZmlndXJlID0gZnVuY3Rpb24gY29uZmlndXJlKGNsaWVudCkge1xuICAgIHZhciBfdGhpczE3ID0gdGhpcztcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNsaWVudCkpIHtcbiAgICAgIHZhciBjb25maWd1cmVkQ2xpZW50cyA9IFtdO1xuXG4gICAgICBjbGllbnQuZm9yRWFjaChmdW5jdGlvbiAodG9Db25maWd1cmUpIHtcbiAgICAgICAgY29uZmlndXJlZENsaWVudHMucHVzaChfdGhpczE3LmNvbmZpZ3VyZSh0b0NvbmZpZ3VyZSkpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBjb25maWd1cmVkQ2xpZW50cztcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGNsaWVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHZhciBlbmRwb2ludCA9IHRoaXMuY2xpZW50Q29uZmlnLmdldEVuZHBvaW50KGNsaWVudCk7XG5cbiAgICAgIGlmICghZW5kcG9pbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyZSBpcyBubyBcXCcnICsgKGNsaWVudCB8fCAnZGVmYXVsdCcpICsgJ1xcJyBlbmRwb2ludCByZWdpc3RlcmVkLicpO1xuICAgICAgfVxuICAgICAgY2xpZW50ID0gZW5kcG9pbnQuY2xpZW50O1xuICAgIH0gZWxzZSBpZiAoY2xpZW50IGluc3RhbmNlb2YgX2F1cmVsaWFBcGkuUmVzdCkge1xuICAgICAgY2xpZW50ID0gY2xpZW50LmNsaWVudDtcbiAgICB9IGVsc2UgaWYgKCEoY2xpZW50IGluc3RhbmNlb2YgX2F1cmVsaWFGZXRjaENsaWVudC5IdHRwQ2xpZW50KSkge1xuICAgICAgY2xpZW50ID0gdGhpcy5odHRwQ2xpZW50O1xuICAgIH1cblxuICAgIGNsaWVudC5pbnRlcmNlcHRvcnMucHVzaCh0aGlzLmludGVyY2VwdG9yKTtcblxuICAgIHJldHVybiBjbGllbnQ7XG4gIH07XG5cbiAgX2NyZWF0ZUNsYXNzKEZldGNoQ29uZmlnLCBbe1xuICAgIGtleTogJ2ludGVyY2VwdG9yJyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHZhciBfdGhpczE4ID0gdGhpcztcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKF9yZXF1ZXN0KSB7XG4gICAgICAgICAgZnVuY3Rpb24gcmVxdWVzdChfeDMpIHtcbiAgICAgICAgICAgIHJldHVybiBfcmVxdWVzdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcXVlc3QudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3JlcXVlc3QudG9TdHJpbmcoKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XG4gICAgICAgIH0oZnVuY3Rpb24gKHJlcXVlc3QpIHtcbiAgICAgICAgICBpZiAoIV90aGlzMTguY29uZmlnLmh0dHBJbnRlcmNlcHRvciB8fCAhX3RoaXMxOC5hdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciB0b2tlbiA9IF90aGlzMTguYXV0aFNlcnZpY2UuZ2V0QWNjZXNzVG9rZW4oKTtcblxuICAgICAgICAgIGlmIChfdGhpczE4LmNvbmZpZy5hdXRoVG9rZW5UeXBlKSB7XG4gICAgICAgICAgICB0b2tlbiA9IF90aGlzMTguY29uZmlnLmF1dGhUb2tlblR5cGUgKyAnICcgKyB0b2tlbjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXF1ZXN0LmhlYWRlcnMuc2V0KF90aGlzMTguY29uZmlnLmF1dGhIZWFkZXIsIHRva2VuKTtcblxuICAgICAgICAgIHJldHVybiByZXF1ZXN0O1xuICAgICAgICB9KSxcbiAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uIChfcmVzcG9uc2UpIHtcbiAgICAgICAgICBmdW5jdGlvbiByZXNwb25zZShfeDQsIF94NSkge1xuICAgICAgICAgICAgcmV0dXJuIF9yZXNwb25zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlc3BvbnNlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9yZXNwb25zZS50b1N0cmluZygpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0oZnVuY3Rpb24gKHJlc3BvbnNlLCByZXF1ZXN0KSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDQwMSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghX3RoaXMxOC5hdXRoU2VydmljZS5hdXRoZW50aWNhdGVkKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoX3RoaXMxOC5jb25maWcuaHR0cEludGVyY2VwdG9yICYmIF90aGlzMTguY29uZmlnLmxvZ291dE9uSW52YWxpZFRva2VuICYmICFfdGhpczE4LmF1dGhTZXJ2aWNlLmlzVG9rZW5FeHBpcmVkKCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChfdGhpczE4LmF1dGhTZXJ2aWNlLmxvZ291dCgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFfdGhpczE4LmNvbmZpZy5odHRwSW50ZXJjZXB0b3IgfHwgIV90aGlzMTguYXV0aFNlcnZpY2UuaXNUb2tlbkV4cGlyZWQoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghX3RoaXMxOC5jb25maWcudXNlUmVmcmVzaFRva2VuIHx8ICFfdGhpczE4LmF1dGhTZXJ2aWNlLmdldFJlZnJlc2hUb2tlbigpKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzb2x2ZShfdGhpczE4LmF1dGhTZXJ2aWNlLnVwZGF0ZVRva2VuKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHZhciB0b2tlbiA9IF90aGlzMTguYXV0aFNlcnZpY2UuZ2V0QWNjZXNzVG9rZW4oKTtcblxuICAgICAgICAgICAgICBpZiAoX3RoaXMxOC5jb25maWcuYXV0aFRva2VuVHlwZSkge1xuICAgICAgICAgICAgICAgIHRva2VuID0gX3RoaXMxOC5jb25maWcuYXV0aFRva2VuVHlwZSArICcgJyArIHRva2VuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmVxdWVzdC5oZWFkZXJzLnNldChfdGhpczE4LmNvbmZpZy5hdXRoSGVhZGVyLCB0b2tlbik7XG5cbiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTguaHR0cENsaWVudC5mZXRjaChyZXF1ZXN0KS50aGVuKHJlc29sdmUpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgfTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gRmV0Y2hDb25maWc7XG59KCkpIHx8IF9jbGFzczEzKTtcbmZ1bmN0aW9uIGNvbmZpZ3VyZShmcmFtZXdvcmtDb25maWcsIGNvbmZpZykge1xuICBpZiAoIV9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLm9yaWdpbikge1xuICAgIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLm9yaWdpbiA9IF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLmhvc3RuYW1lICsgKF9hdXJlbGlhUGFsLlBMQVRGT1JNLmxvY2F0aW9uLnBvcnQgPyAnOicgKyBfYXVyZWxpYVBhbC5QTEFURk9STS5sb2NhdGlvbi5wb3J0IDogJycpO1xuICB9XG5cbiAgdmFyIGJhc2VDb25maWcgPSBmcmFtZXdvcmtDb25maWcuY29udGFpbmVyLmdldChCYXNlQ29uZmlnKTtcblxuICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbmZpZyhiYXNlQ29uZmlnKTtcbiAgfSBlbHNlIGlmICgodHlwZW9mIGNvbmZpZyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoY29uZmlnKSkgPT09ICdvYmplY3QnKSB7XG4gICAgYmFzZUNvbmZpZy5jb25maWd1cmUoY29uZmlnKTtcbiAgfVxuXG4gIGZvciAodmFyIF9pdGVyYXRvciA9IGJhc2VDb25maWcuZ2xvYmFsVmFsdWVDb252ZXJ0ZXJzLCBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXkoX2l0ZXJhdG9yKSwgX2kgPSAwLCBfaXRlcmF0b3IgPSBfaXNBcnJheSA/IF9pdGVyYXRvciA6IF9pdGVyYXRvcltTeW1ib2wuaXRlcmF0b3JdKCk7Oykge1xuICAgIHZhciBfcmVmO1xuXG4gICAgaWYgKF9pc0FycmF5KSB7XG4gICAgICBpZiAoX2kgPj0gX2l0ZXJhdG9yLmxlbmd0aCkgYnJlYWs7XG4gICAgICBfcmVmID0gX2l0ZXJhdG9yW19pKytdO1xuICAgIH0gZWxzZSB7XG4gICAgICBfaSA9IF9pdGVyYXRvci5uZXh0KCk7XG4gICAgICBpZiAoX2kuZG9uZSkgYnJlYWs7XG4gICAgICBfcmVmID0gX2kudmFsdWU7XG4gICAgfVxuXG4gICAgdmFyIGNvbnZlcnRlciA9IF9yZWY7XG5cbiAgICBmcmFtZXdvcmtDb25maWcuZ2xvYmFsUmVzb3VyY2VzKF9hdXJlbGlhUGFsLlBMQVRGT1JNLm1vZHVsZU5hbWUoJy4vJyArIGNvbnZlcnRlcikpO1xuICAgIGxvZ2dlci5pbmZvKCdBZGQgZ2xvYmFsUmVzb3VyY2VzIHZhbHVlLWNvbnZlcnRlcjogJyArIGNvbnZlcnRlcik7XG4gIH1cbiAgdmFyIGZldGNoQ29uZmlnID0gZnJhbWV3b3JrQ29uZmlnLmNvbnRhaW5lci5nZXQoRmV0Y2hDb25maWcpO1xuICB2YXIgY2xpZW50Q29uZmlnID0gZnJhbWV3b3JrQ29uZmlnLmNvbnRhaW5lci5nZXQoX2F1cmVsaWFBcGkuQ29uZmlnKTtcblxuICBpZiAoQXJyYXkuaXNBcnJheShiYXNlQ29uZmlnLmNvbmZpZ3VyZUVuZHBvaW50cykpIHtcbiAgICBiYXNlQ29uZmlnLmNvbmZpZ3VyZUVuZHBvaW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbmRwb2ludFRvUGF0Y2gpIHtcbiAgICAgIGZldGNoQ29uZmlnLmNvbmZpZ3VyZShlbmRwb2ludFRvUGF0Y2gpO1xuICAgIH0pO1xuICB9XG5cbiAgdmFyIGNsaWVudCA9IHZvaWQgMDtcblxuICBpZiAoYmFzZUNvbmZpZy5lbmRwb2ludCAhPT0gbnVsbCkge1xuICAgIGlmICh0eXBlb2YgYmFzZUNvbmZpZy5lbmRwb2ludCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHZhciBlbmRwb2ludCA9IGNsaWVudENvbmZpZy5nZXRFbmRwb2ludChiYXNlQ29uZmlnLmVuZHBvaW50KTtcblxuICAgICAgaWYgKCFlbmRwb2ludCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZXJlIGlzIG5vIFxcJycgKyAoYmFzZUNvbmZpZy5lbmRwb2ludCB8fCAnZGVmYXVsdCcpICsgJ1xcJyBlbmRwb2ludCByZWdpc3RlcmVkLicpO1xuICAgICAgfVxuICAgICAgY2xpZW50ID0gZW5kcG9pbnQ7XG4gICAgfSBlbHNlIGlmIChiYXNlQ29uZmlnLmVuZHBvaW50IGluc3RhbmNlb2YgX2F1cmVsaWFGZXRjaENsaWVudC5IdHRwQ2xpZW50KSB7XG4gICAgICBjbGllbnQgPSBuZXcgX2F1cmVsaWFBcGkuUmVzdChiYXNlQ29uZmlnLmVuZHBvaW50KTtcbiAgICB9XG4gIH1cblxuICBpZiAoIShjbGllbnQgaW5zdGFuY2VvZiBfYXVyZWxpYUFwaS5SZXN0KSkge1xuICAgIGNsaWVudCA9IG5ldyBfYXVyZWxpYUFwaS5SZXN0KGZyYW1ld29ya0NvbmZpZy5jb250YWluZXIuZ2V0KF9hdXJlbGlhRmV0Y2hDbGllbnQuSHR0cENsaWVudCkpO1xuICB9XG5cbiAgYmFzZUNvbmZpZy5jbGllbnQgPSBjbGllbnQ7XG59Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///aurelia-authentication\n");

/***/ }),

/***/ "aurelia-authentication/authFilterValueConverter":
/*!*********************************************************************************************!*\
  !*** ./node_modules/aurelia-authentication/dist/native-modules/authFilterValueConverter.js ***!
  \*********************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nexports.__esModule = true;\nexports.AuthFilterValueConverter = undefined;\n\nvar _aureliaRouter = __webpack_require__(/*! aurelia-router */ \"4ysu\");\n\n\n\nvar AuthFilterValueConverter = exports.AuthFilterValueConverter = function () {\n  function AuthFilterValueConverter() {\n    \n  }\n\n  AuthFilterValueConverter.prototype.toView = function toView(routes, isAuthenticated) {\n    return routes.filter(function (route) {\n      return typeof route.config.auth !== 'boolean' || route.config.auth === isAuthenticated;\n    });\n  };\n\n  return AuthFilterValueConverter;\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyZWxpYS1hdXRoZW50aWNhdGlvbi9hdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYXVyZWxpYS1hdXRoZW50aWNhdGlvbi9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1dGhGaWx0ZXJWYWx1ZUNvbnZlcnRlci5qcz9lNWJlIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuQXV0aEZpbHRlclZhbHVlQ29udmVydGVyID0gdW5kZWZpbmVkO1xuXG52YXIgX2F1cmVsaWFSb3V0ZXIgPSByZXF1aXJlKCdhdXJlbGlhLXJvdXRlcicpO1xuXG5cblxudmFyIEF1dGhGaWx0ZXJWYWx1ZUNvbnZlcnRlciA9IGV4cG9ydHMuQXV0aEZpbHRlclZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIoKSB7XG4gICAgXG4gIH1cblxuICBBdXRoRmlsdGVyVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLnRvVmlldyA9IGZ1bmN0aW9uIHRvVmlldyhyb3V0ZXMsIGlzQXV0aGVudGljYXRlZCkge1xuICAgIHJldHVybiByb3V0ZXMuZmlsdGVyKGZ1bmN0aW9uIChyb3V0ZSkge1xuICAgICAgcmV0dXJuIHR5cGVvZiByb3V0ZS5jb25maWcuYXV0aCAhPT0gJ2Jvb2xlYW4nIHx8IHJvdXRlLmNvbmZpZy5hdXRoID09PSBpc0F1dGhlbnRpY2F0ZWQ7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIEF1dGhGaWx0ZXJWYWx1ZUNvbnZlcnRlcjtcbn0oKTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///aurelia-authentication/authFilterValueConverter\n");

/***/ })

}]);